!(function(e){if(!e.jalios){e.jalios={}}if(!e.jalios.smartPhone){e.jalios.smartPhone={}}e.jalios.smartPhone.MobileApp={contactInformation:{},config:{postMsgIntervalCheck:200,postMsgTimeoutDelay:5000},saveAction:function(j,i,k){if(e.jalios.smartPhone.isMobileApp()){var l=[];l.push({actionName:j,action:i.toString(),args:typeof k==="string"?k:JSON.stringify(k)});e.jalios.smartPhone.postMessageApp(JSON.stringify({type:"function",status:"success",msg:JSON.stringify(l)}))}}};e.jalios.smartPhone.isMobileApp=function(){return localStorage.getItem("context")==="mobileApp"};e.jalios.smartPhone.postMessageApp=function(l,i){const k=new Date().getTime();let intervalCheck=e.jalios.smartPhone.MobileApp.config.postMsgIntervalCheck||200;let timeoutDelay=e.jalios.smartPhone.MobileApp.config.postMsgTimeoutDelay||5000;let onErrorCallback;let onSuccessCallback;if(typeof i!=="undefined"){intervalCheck=i.intervalCheck||intervalCheck;timeoutDelay=i.timeoutDelay||timeoutDelay;onSuccessCallback=i.onSuccess;onErrorCallback=i.onError}var j=setInterval(function(){if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.cordova_iab){clearInterval(j);webkit.messageHandlers.cordova_iab.postMessage(l);if(typeof onSuccessCallback==="function"){onSuccessCallback(l)}}else{const n=new Date().getTime();const m=n-k;if(m>=timeoutDelay){clearInterval(j);var o=localStorage.getItem("jmobile-postMessageApp");if(o==null||typeof o==="undefined"){o=[]}o[o.length]=l;localStorage.setItem("jmobile-postMessageApp",JSON.stringify(o));if(typeof onErrorCallback==="function"){onErrorCallback(l)}}}},intervalCheck)};e.jalios.smartPhone.openExternalLinks=function(j){if(typeof j!="undefined"&&j!=null){e.jalios.smartPhone.MobileApp.saveAction("OpenInSystemWebBrowser",function i(k){this.openLinkService.openInSystemWebBrowser(k)},{url:j});return false}};e(document).on("update-alert-count",function(j){e.jalios.smartPhone.MobileApp.saveAction("updateJmobileBadge",function i(k){if(this.badgeService!=undefined){this.badgeService.setBadge(k)}},j.badgeValue)});e(document).on("addContext",function(j){localStorage.setItem("context","mobileApp");var i=j.param.token;e.ajaxSetup({headers:{Authorization:"Bearer "+i}})});e(document).on("addNotificationInfo",function(i){localStorage.setItem("jmobileVersion",i.param.jmobileVersion);localStorage.setItem("deviceID",i.param.deviceID);localStorage.setItem("deviceOS",i.param.deviceOS);localStorage.setItem("deviceModel",i.param.deviceModel);localStorage.setItem("notificationPermission",i.param.notificationPermission)});e(document).on("notification",function(i){e.jalios.smartPhone.Alerts.updateAlertCount()});e(document).on("postMessagePlugin",function(n,p){const i=JSON.parse(p);if(i.type==="share-data"&&i.msg!=""){const o=i.msg;if(e(".service-explorer-upload-file, .form-upload-file").length){try{var l=e.jalios.smartPhone.Forms.dataURLtoFile(o.data,"file."+o.extension);const m=new DataTransfer();m.items.add(l);e(".jmobile-upload-file")[0].files=m.files;j=e(".explorer-upload-file-form, .form-upload-file");j.append("documents",l);j.data("jalios-form-file",l,l.name);e(".explorer-upload-file-form, .form-upload-file").append("<p>Attached file: "+l.name+" ["+l.size+" bytes]");console.log("Attached file: "+l.name+" ["+l.size+" bytes]")}catch(k){console.log("Could not attach file: "+JSON.stringify(k))}}else{if(e("#share-image").length){e(".upload-image-action-container").append('<div class="imagepreview"><span class="icon-close ui-input-btn ui-btn delete-image-preview ui-icon-delete ui-btn-icon-notext ui-corner-all"></span><img alt="" src="'+o.data+'" /></div>');var j=e("form.adding-picture-file,.microblogging-form form");j.find(".microBlogging-galery").hide();j.find(".microBlogging-camera").hide();try{var l=e.jalios.smartPhone.Forms.dataURLtoFile(o.data,"image.jpeg");j.data("jalios-form-file",l);console.log("PhotoService - Attached file: "+l.name+" ["+l.size+" bytes]")}catch(k){console.log("PhotoService - Could not attach file: "+JSON.stringify(k))}}}}});e(document).on("pagecontainerbeforeshow",function(l){if(e(".service-jmobileabout-content").length){var j={deviceID:localStorage.getItem("deviceID"),deviceModel:localStorage.getItem("deviceModel"),deviceOS:localStorage.getItem("deviceOS"),jmobileVersion:localStorage.getItem("jmobileVersion")};var k="plugins/SmartPhonePlugin/jsp/action/jmobileActionHandler.jsp";e.ajax({type:"POST",dataType:"json",url:k,data:j,success:function(m){document.getElementById("jmobile-version-message").innerHTML=m.jmobileVersion;if(m.DeviceRegistred=="true"){document.getElementById("registred-deviceId").innerHTML='<span class="jalios-icon icomoon-mobile jmobile-notification-post-icon"></span>'+m.deviceIdSMessage+'<span class="jalios-icon jmobile-config-status-correct icomoon-checkmark4"></span>'}else{document.getElementById("registred-deviceId").innerHTML='<span class="jalios-icon icomoon-mobile jmobile-notification-post-icon"></span>'+m.deviceIdSMessage+'<span class="jalios-icon jmobile-config-status-warning icomoon-warning"></span>'}if(localStorage.getItem("notificationPermission")=="true"){document.getElementById("notification-permission").innerHTML='<span class="jalios-icon icomoon-unlocked2 jmobile-notification-post-icon"></span>'+m.notificationPermission+'</span><span class="jalios-icon jmobile-config-status-correct icomoon-checkmark4"></span>'}else{document.getElementById("notification-permission").innerHTML='<span class="jalios-icon icomoon-lock jmobile-notification-post-icon"></span>'+m.notificationPermission+'<span class="jalios-icon jmobile-config-status-warning icomoon-warning"></span>'}if(m.alertTypeActivated=="true"){document.getElementById("jmobile-alert-type").innerHTML='<span class="jalios-icon icomoon-equalizer2 jmobile-notification-post-icon"></span>'+m.JmobileAlertTypeMessage+'<span class="jalios-icon jmobile-config-status-correct icomoon-checkmark4"></span>'}else{document.getElementById("jmobile-alert-type").innerHTML='<span class="jalios-icon icomoon-equalizer2 jmobile-notification-post-icon"></span>'+m.JmobileAlertTypeMessage+'<span class="jalios-icon jmobile-config-status-warning icomoon-warning"></span>'}},error:function(m){console.dir(m)}})}if(e.jalios.smartPhone.isMobileApp()){e(".logout-link").on("vclick",function(n){n.preventDefault();n.stopImmediatePropagation();e.jalios.smartPhone.MobileApp.saveAction("logout",function m(){this.logout()})});if(e.mobile.activePage.attr("id")==="member-profile"){if(!e.isEmptyObject(e.jalios.smartPhone.MobileApp.contactInformation)){e.jalios.smartPhone.MobileApp.saveAction("existContact",function i(m){this.contactService.checkExistContact(m)},{mobilePhoneNumbers:e.jalios.smartPhone.MobileApp.contactInformation.mobilePhoneNumbers,email:e.jalios.smartPhone.MobileApp.contactInformation.email})}}if(e.mobile.activePage.attr("id")==="share-image"){e(".toggle-microblogging-form").toggleClass("hide");e.jalios.smartPhone.postMessageApp(JSON.stringify({type:"share-data"}))}if(e(".service-explorer-upload-file").length){d(l)}}});var b=function(i){a(i,"gallery",{destinationType:0,encodingType:0,sourceType:0,correctOrientation:true})};var g=function(i){a(i,"camera",{destinationType:0,correctOrientation:true})};var f=function(j,i,l){if(typeof j!="undefined"&&j!=null){e.jalios.smartPhone.MobileApp.saveAction("downloadFile",function k(m){this.fileService.downloadFile(m)},{url:j,filename:i,contentType:l})}};function d(i){if(e.jalios!=null&&e.jalios.smartPhone!=null&&typeof e.jalios.smartPhone.postMessageApp==="function"){e.jalios.smartPhone.postMessageApp(JSON.stringify({type:"share-data"}))}}function a(k,i,m){var l=e(k.target).closest("FORM");l.addClass("adding-picture-file");e.jalios.smartPhone.MobileApp.saveAction(i,function j(n){this.photoService.addPictureToInappBrowser(n)},m)}function h(j){if(!e.isEmptyObject(e.jalios.smartPhone.MobileApp.contactInformation)){e.jalios.smartPhone.MobileApp.saveAction("addContact",function i(k){this.contactService.addContact(k)},e.jalios.smartPhone.MobileApp.contactInformation)}}var c=function(){e(document).on("vclick",function(l){if(e.jalios.smartPhone.isMobileApp()){var j=e(l.target);if(j.closest(".jmobile-disconnect").length){e.jalios.smartPhone.MobileApp.saveAction("disconnect",function k(){this.disconnect({showPrompt:true})})}if(j.closest(".upload-image-action-icon").length){if(j.closest(".microBlogging-galery").length){j.addClass("jmobile-action-in-progress").removeClass("jmobile-action-completed");l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();b(l)}if(j.closest(".microBlogging-camera").length){j.addClass("jmobile-action-in-progress").removeClass("jmobile-action-completed");l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();g(l)}}if(j.closest(".icon-close").length){j.addClass("jmobile-action-in-progress").removeClass("jmobile-action-completed");l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();var m=e(l.target).closest("form");m.removeData("jalios-form-file");m.removeClass("adding-picture-file");m.find(".imagepreview").remove();m.find(".microBlogging-galery").show();m.find(".microBlogging-camera").show()}if(j.closest(".pub-filedocument-file-details ~",".jmobile-download-action").length||(typeof j.attr("download")!==typeof undefined&&j.attr("download")!==false)){var i=j.data("jalios-document-info");if(typeof i!=="undefined"){j.addClass("jmobile-action-in-progress ui-disabled").removeClass("jmobile-action-completed");l.preventDefault();l.stopImmediatePropagation();e.mobile.loading("show",{textVisible:false});f(j.context.href,i.title,i.contentType)}}if(j.closest(".js-export-contact").length){j.addClass("jmobile-action-in-progress").removeClass("jmobile-action-completed");l.preventDefault();l.stopImmediatePropagation();h(l)}if(j.closest('[rel="external"]','[target="_blank"]').length||j.closest('[rel="external"], [target="_blank"]').length>0||j.attr("target")=="_blank"){if(j.data("jalios-jmobile-default")==null&&j.data("jalios-ctxmenu")==null&&j.closest("button").data("jalios-jmobile-default")==null&&j.closest("button").data("jalios-ctxmenu")==null){j.addClass("jmobile-action-in-progress").removeClass("jmobile-action-completed");l.preventDefault();l.stopImmediatePropagation();e.jalios.smartPhone.openExternalLinks(j.closest("a").attr("href"))}}}});e(".ui-mobile:not(.login-ajax-enabled) #login .login-form-header form, .ui-mobile:not(.login-ajax-enabled) #login .login-form-footer form").attr("data-ajax","false")};e(document).ready(c)})(window.jQuery);