(function(c,d,f,b){var e;var h=function(){e=new a(c(".mobile-portal-edition"));c(f).on("jalios:refresh",i)};const i=function(j){if(j.refresh.type==="before"){if(c(j.refresh.target).hasClass("portal-sidebar-wrapper")){c(".edition-sidebar").displayLoading()}return}};var a=function(j){this.$element=c(j);this.init();this.initEventHandling();this.initActionHandling()};a.prototype.init=function(){this.$editionBlocksBody=this.$element.find(".edition-blocks-body")};a.prototype.returnToSidebarHome=function(){let ajaxParameters={};ajaxParameters.returnToSidebarHome=true;ajaxParameters.smartphonePortalId=this.$element.data("jalios-portal-id");c.jalios.AjaxRefresh.refresh("plugins/SmartPhonePlugin/jsp/portalEditor/sidebar/doEditSmartPhonePortalSidebar.jsp",".portal-sidebar-wrapper",{params:ajaxParameters})};a.prototype.initActionHandling=function(){var j=this;c(f).on("click","[data-jalios-jmobile-portal-action]",function(k){k.stopPropagation();k.preventDefault();let $currentTarget=c(k.currentTarget);var l=$currentTarget.data("jalios-jmobile-portal-action");switch(l){case"cancelPortletOperation":if(c.plugin.SmartphonePortalApp.getActivePortlet()&&c.plugin.SmartphonePortalApp.getActivePortlet().isEmpty){c.plugin.SmartphonePortalApp.getActivePortlet().remove()}j.returnToSidebarHome();break;case"selectPortlet":let portletId=$currentTarget.data("jalios-data-id");let portletLabel=$currentTarget.data("jalios-jmobile-portlet-label");let portletImg=$currentTarget.find("IMG").attr("src");c.plugin.SmartphonePortalApp.getActivePortlet().updatePreview(portletId,portletLabel,portletImg);j.returnToSidebarHome();break;case"editPortlet":c.plugin.SmartphonePortalApp.getPortalEditor().setActivePortlet($currentTarget.closest(".portlet-block").data("smartphonePortlet"));setTimeout(function(){c(".edition-sidebar").displayLoading();c.jalios.AjaxRefresh.refresh("plugins/SmartPhonePlugin/jsp/portalEditor/sidebar/doEditSmartPhonePortletSidebar.jsp",".portal-sidebar-wrapper",{params:{id:$currentTarget.data("jalios-data-id")}})},10);break}})};a.prototype.initEventHandling=function(){var j=this;c(f).on("jalios.smartphone.portal",function(k){switch(k.portalEditorEvent){case"create":c.jalios.AjaxRefresh.refresh("plugins/SmartPhonePlugin/jsp/portalEditor/sidebar/doSmartPortalChoosePortletSidebar.jsp",".portal-sidebar-wrapper",{params:{smartphonePortalId:c.plugin.SmartphonePortalApp.getPortalEditor().id,portletClass:k.portalEditorData.portletType}});break;case"createPortlet":c.plugin.SmartphonePortalApp.getActivePortlet().updatePreview(k.portalEditorData.portletId,k.portalEditorData.portletLabel,k.portalEditorData.portletImage);setTimeout(function(){j.returnToSidebarHome()},100);break;case"cancelPortlet":setTimeout(function(){j.returnToSidebarHome()},100);break;case"updatePortlet":c.plugin.SmartphonePortalApp.getActivePortlet().updatePreview(k.portalEditorData.portletId,k.portalEditorData.portletLabel,k.portalEditorData.portletImage);break}})};var g=function(){};c(f).ready(function(){h()})})(jQuery,window,document);