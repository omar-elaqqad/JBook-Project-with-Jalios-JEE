!(function(a){a(document).on("input propertychange",".smartphone-wiki-area",function(j){var f=j.target;if(f.classList.contains("mention-disabled")){return}if(f.selectionStart>f.selectionEnd){return}var c=f.selectionStart;var h=f.selectionEnd;var m=f.value;if(c==h){c--}var i=m.charAt(c);while(c>=0&&i!=" "&&i!="\n"&&i!="\r"){c--;i=m.charAt(c)}var b=m.substring(c+1,h);if(b&&b.length>1&&b.indexOf(" ")<0&&b.indexOf("@")==0&&b.substring(1).indexOf("@")===-1){var g=false;var d=a(f).data("discarded-mention");var k=1;if(typeof d==="string"&&d.length>1&&b.length+k>=d.length){var l=b.substring(0,d.length-k);var n=d.substring(0,d.length-k);g=l===n}if(g){a(f).data("discarded-mention",b)}else{a.jalios.smartPhone.DataChooser.createChooser("mentions-chooser",b.substring(1));var o=a(".chooser-form");o.data("chooser-type","member");o.data("selection-end",h);o.data("caller-input",a(j.target));o.data("replaced-word",b);o.append('<input type="hidden" name="usage" value="0" />');o.append('<input type="hidden" name="isMention" value="true" />');a(".chooser-input").trigger("input")}}else{a(f).removeData("discarded-mention")}});a(document).on("click",".mentions-chooser .chooser-close",function(){var b=a(".chooser-form");var c=b.data("caller-input");c.data("discarded-mention",b.data("replaced-word"));var d=b.data("selection-end");if(c.length>=1){c.get(0).setSelectionRange(d,d);c.focus()}a.jalios.smartPhone.DataChooser.desactivateChooser()});a(document).on("click",".mentions-chooser .chooser-result",function(h){var l=a(".chooser-form");var i=l.data("caller-input");var b=a(h.target).closest(".chooser-result").data("mention-email-prefix");var f=l.data("replaced-word");var k=l.data("selection-end");var g=k-f.length+1;var i=l.data("caller-input");i.data("discarded-mention","@"+b);a.jalios.smartPhone.DataChooser.desactivateChooser();if(i.length>=1){if(typeof b==="string"&&b.length>0){if(i.get(0).setRangeText){i.get(0).setRangeText(b,g,k)}else{var c=i.val();var d=c.substring(0,g)+b+c.substring(k);i.val(d)}var j=k+(b.length-f.length+1);i.get(0).setSelectionRange(j,j);i.focus()}else{alert(jaliosSettings["lbl-mention-noemail"]);setTimeout(function(){i.get(0).setSelectionRange(k,k);i.focus()},300)}}})})(window.jQuery);