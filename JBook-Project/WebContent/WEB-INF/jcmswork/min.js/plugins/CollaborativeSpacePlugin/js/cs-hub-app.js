!function(e){var f=function(n){var m=e(".app-cs-hub .card-sortable-wrapper");if(!m.exists()||m.data("sortableInitialized")){return}e.console.debug("[cs-hub-app]","[initSortable]");m.sortable({containment:"parent",cursor:"move",delay:150,tolerance:"pointer",placeholder:{element:function(){return e("<div>").addClass("csp-custom-placeholder card").append(e("<div>").addClass("card"))},update:function(o,q){return}},update:function(q,s){var t=s.item;if(!t.exists()){return}var p=e(t[0]).find(".card").data("jalios-data-workspace-id");var o=[];var r=e(q.target);r.find(".ui-sortable-handle .card").each(function(u,v){var w=e(v).data("jalios-data-workspace-id");o[u]=w});e.ajax({url:"plugins/CollaborativeSpacePlugin/jsp/hub/reorderFavorites.jsp",method:"post",data:{favoriteIds:o,movedFavoriteId:p},traditional:true})}});m.data("sortableInitialized",true)};const c=function(m,n){m.stopImmediatePropagation();let $selectedCheckbox=e(n.find(":radio").first());$selectedCheckbox.prop("checked",!$selectedCheckbox.prop("checked"));$selectedCheckbox.data("ignore",true);if($selectedCheckbox.prop("checked")){let subList=e(":radio",n);subList.find(":radio").each(function(){let $that=e(this);if(!($that==n)){$that.attr("checked",false);$that.data("ignore",true)}})}let filterList=e(n.closest(".filter-exclusive"));filterList.find(":radio").each(function(){let $that=e(this);if(!$that.data("ignore")){$that.attr("checked",false)}});b(n)};const b=function(m){let $form=e(m.closest("form"));$form.refresh({isform:true})};const h=function(m){let $input=e(this);if($input.prop("checked")===false){$input.refresh();return}let closestContainer=$input.closest("UL");let sameLevelTypos=closestContainer.children("LI");sameLevelTypos.each(function(){let $itTypo=e(this);let $itInput=$itTypo.find("INPUT.type-filter-input");let notTheCurrentOne=$itInput.val()!==$input.val();if(notTheCurrentOne){g($itInput)}});let $parentLI=$input.closest("UL.typology-menu").closest("LI.js-type-menu-item");let $parentInput=$parentLI.find(" > LABEL INPUT.type-filter-input");g($parentInput);let $mainMenu=$input.closest("UL.cs-hub-type-root-filter");$mainMenu.find(" > LI.js-type-menu-item.active > LABEL INPUT.type-filter-input").each(function(n,o){g(e(o))});let $inputLI=$input.closest("LI.js-type-menu-item");$inputLI.find(" LI INPUT.type-filter-input").each(function(n,o){g(e(o))});if($input.attr("name")==="csHubType"&&$input.attr("value")==="ws"){let $csLI=$mainMenu.find("LI.js-type-menu-item.root-type-collaborative-spaces");$csLI.find(" LI INPUT.type-filter-input").each(function(n,o){g(e(o))})}$input.refresh()};var g=function(m){if(!m||!m.exists()){return}if(m.prop("checked")===true){m.prop("checked",false)}};var a=function(m){if(!e.jalios.a11y.isFocusedClick(m)){return}m.preventDefault();var n=e(m.currentTarget)?e(m.currentTarget).data("jalios-ws-id"):null;if(!n){return}e.ajax({url:"jcore/member/action/addFavoriteWorkspace.jsp",data:{ws:n}}).then(function(){let $hubForm=e(".app-cs-hub").closest("FORM");let $favInput=e("<input>").attr("name","csHubAddedFavorite").attr("type","hidden").val(n);$hubForm.append($favInput);e(".topbar-wrapper .Portlet.PortletNavigate").addClass("favorite-workspaces-updated");$hubForm.refresh({isform:true,nohistory:true,noscroll:true})})};var d=function(m){if(!e.jalios.a11y.isFocusedClick(m)){return}m.preventDefault();var n=e(m.currentTarget)?e(m.currentTarget).data("jalios-ws-id"):null;if(!n){return}e.ajax({url:"jcore/member/action/removeFavoriteWorkspace.jsp",data:{ws:n}}).then(function(){let $hubForm=e(".app-cs-hub").closest("FORM");let $favInput=e("<input>").attr("name","csHubRemovedFavorite").attr("type","hidden").val(n);$hubForm.append($favInput);e(".topbar-wrapper .Portlet.PortletNavigate").addClass("favorite-workspaces-updated");$hubForm.refresh({isform:true,nohistory:true,noscroll:true})})};var l=function(n){if(!e.jalios.a11y.isFocusedClick(n)){return}n.preventDefault();var m=e(n.currentTarget)?e(n.currentTarget).data("jalios-id"):null;if(!m){return}e.ajax({url:"plugins/CollaborativeSpacePlugin/jsp/hub/hubApp.jsp",data:{opIgnoreSuggestion:true,suggestionId:m}}).then(function(){e(".app-cs-hub").refresh({isform:true})})};var j=function(n){if(!e.jalios.a11y.isFocusedClick(n)){return}n.preventDefault();var m=e(n.currentTarget);if(!m||m.length===0){return}m.siblings(".meta-category-toggler.hide").toggleClass("hide")};var k=function(m){if(!m||!m.refresh||m.refresh.type!=="after"){return}e.console.debug("[cs-hub-app]","[handleRefresh]",m,e(m.refresh.target));if(m.refresh.target&&m.refresh.url==="plugins/CollaborativeSpacePlugin/jsp/hub/hubApp.jsp"){e.console.debug("[cs-hub-app]","[handleRefresh]","after HUB refresh");if(e(".topbar-wrapper .Portlet.PortletNavigate").hasClass("favorite-workspaces-updated")){e.console.debug("[cs-hub-app]","[handleRefresh]","after HUB refresh + topbar to be refreshed");e(".topbar-wrapper .Portlet.PortletNavigate").refresh()}}if(m.refresh.target&&e(m.refresh.target).length>0&&e(".topbar-wrapper .Portlet.PortletNavigate").length>0&&e(m.refresh.target).get(0)===e(".topbar-wrapper .Portlet.PortletNavigate").get(0)){e.console.debug("[cs-hub-app]","[handleRefresh]","after topbar refresh");if(e(".topbar-wrapper").hasClass("is-expanded")){e(".topbar-wrapper").removeClass("is-expanded")}}f()};var i=function(){e(document).on("jalios:refresh",k);e(document).on("change",".cs-hub-sidebar-type INPUT",h);e(document).on("click keydown",".js-add-favorite",a);e(document).on("click keydown",".js-remove-favorite",d);e(document).on("click keydown",".js-remove-suggestion",l);e(document).on("click keydown",".js-meta-category-toggler",j);e(document).on("click keydown",".app-cs-hub .app-sidebar-menu.cs-hub-access-policy-root-filter LI",function(m){c(m,e(this))})};e(document).ready(function(m){f();i()})}(window.jQuery);