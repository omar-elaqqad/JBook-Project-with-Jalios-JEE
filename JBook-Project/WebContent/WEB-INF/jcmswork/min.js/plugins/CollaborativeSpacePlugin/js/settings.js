!function(b){let _init=false;let $opacitySlider;let register=function(){if(_init){return}_init=true;if(b(".cs-settings-nav .info-tab").hasClass("active")){b.JCMS.jcmsplugin.cs.SettingsUtils.initAccessSignupCompatibility()}if(b(".cs-settings-nav .look-tab").hasClass("active")){b("INPUT:text[name=header]").on("change",b.JCMS.jcmsplugin.cs.SettingsUtils.refreshHeader);initOpacitySlider();initChoosers();b("INPUT:submit[name=opUpdate]").on("click",onOpUpdate)}d();b(document).on("jalios:refresh",function(e){if(e.refresh.type!=="after"||(!e.refresh.options||!e.refresh.options.params)){return}d()});b(document).on("change",'.cs-settings input[name="activateSync"]',function(e){b(".cs-settings .sync-mode-picker").toggleClass("hide");if(b(e.target).val()==="false"){b(".cs-settings .sync-mode-picker input:checkbox").prop("checked",false)}})};const d=function(){b(".mobile-portlets .mobile-portlet-delete").on("click",function(f){b(f.currentTarget).closest(".mobile-portlet").remove()});const e=b(".ajax-refresh-div >.mobile-portlet.added-portlet").detach();e&&b(".mobile-portlets").append(e);b(".mobile-portlets").sortable({handle:".mobile-portlet-drag",cancel:"",tolerance:"pointer",containment:"parent"})};let onOpUpdate=function(e){return submitForm()};let submitForm=function(){if(b("INPUT:radio[name=headerMirror]:checked").val()==="no-mirror"){return true}if(!b.JCMS.jcmsplugin.cs.HeaderUtils.canvas){return true}b.JCMS.jcmsplugin.cs.HeaderUtils.canvas.toBlob(function(e){let file=new File([e],"image.png");let formdata=new FormData(b(".cs-settings FORM#settingsForm")[0]);formdata.append("opUpdate","true");formdata.append("mirroredHeader",file);b.ajax({url:"plugins/CollaborativeSpacePlugin/jsp/settings.jsp",type:"POST",data:formdata,processData:false,contentType:false,complete:function(f){b.jalios.Browser.reload()}});return false});return false};let hexToRgb=function(e){let result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null};let initOpacitySlider=function(){$opacitySlider=b(".csp-tabs-opacity-slider").slider();$opacitySlider.on("change",function(e){let opacity=e&&e.value&&e.value.newValue?e.value.newValue:null;refreshTabsBgColor(null,opacity)})};let refreshTabsBgColor=function(e,f){let opacity=f;if(b.JCMS.jcmsplugin.cs.SettingsUtils.isCondensed()){b("#cs-header-tabs UL.nav-tabs").css("background-color","");return}if(!opacity){let $input=b("INPUT[name='headerTabsOpacity']");opacity=$input.val()}let bgColorHex=e;if(!bgColorHex){let $input=b("INPUT[name='headerTabsBgColor']");bgColorHex=$input.val()}if(!bgColorHex){bgColorHex="#000000"}let rgb=hexToRgb(bgColorHex);b("#cs-header-tabs UL.nav-tabs").css("background-color","rgba("+rgb.r+", "+rgb.g+", "+rgb.b+", "+opacity/100+")")};let initChoosers=function(){initBgColorChooser();initColorChooser();initTabsColorChooser();initTabsBgColorChooser();initImageChooser();initImagePositionChooser();initImageRepeatChooser();initImageMirrorChooser();initCondensedChooser()};let initBgColorChooser=function(){updateOnChooserChange(b(".cs-color-chooser.bgcolor-chooser .control-color"),function(){let color=b(this).val();let $header=b("#cs-header");if($header.css("background-color")==b("<div>").css("background-color",color).css("background-color")){return}$header.css("background-color",color)});b(".cs-color-chooser.bgcolor-chooser [data-jalios-action='widget:clear']").on("click",function(){b("#cs-style-bgColor").remove();let $header=b("#cs-header");$header.css("background-color","")})};let initColorChooser=function(){updateOnChooserChange(b(".cs-color-chooser.header-title-color-chooser .control-color"),function(){b("#cs-style-title-color").remove();let color=b(this).val();let $headerTitle=b("#cs-header-title");$headerTitle.css("color",color);$headerTitle.find("A").css("color",color)});b(".cs-color-chooser.header-title-color-chooser [data-jalios-action='widget:clear']").on("click",function(){b("#cs-style-title-color").remove();let $headerTitle=b("#cs-header-title");$headerTitle.css("color","");$headerTitle.find("A").css("color","")})};let initTabsColorChooser=function(){updateOnChooserChange(b(".cs-color-chooser.tabs-color-chooser .control-color"),function(){let color=b(this).val();let $tabsColor=b("#cs-header-tabs UL.nav-tabs > LI > A");if($tabsColor.css("color")==b("<div>").css("color",color).css("color")){return}$tabsColor.css("color",color)});b(".cs-color-chooser.tabs-color-chooser [data-jalios-action='widget:clear']").on("click",function(){b("#cs-style-tabs-color").remove();let $tabsColor=b("#cs-header-tabs UL.nav-tabs > LI > A");$tabsColor.css("color","")})};let initTabsBgColorChooser=function(){updateOnChooserChange(b(".cs-color-chooser.tabs-bgcolor-chooser .control-color"),function(){b("#cs-style-tabs-bgColor").remove();let color=b(this).val();let $tabs=b("#cs-header-tabs UL.nav-tabs");if($tabs.css("background-color")==b("<div>").css("background-color",color).css("background-color")){return}refreshTabsBgColor(color,null)});b(".cs-color-chooser.tabs-bgcolor-chooser [data-jalios-action='widget:clear']").on("click",function(){b("#cs-style-tabs-bgColor").remove();let $tabs=b("#cs-header-tabs UL.nav-tabs");$tabs.css("background-color","");refreshTabsBgColor("#FFFFFF",null)})};let initImageChooser=function(){b('.header-existing-background-image-chooser IMG[data-jalios-csp-settings-header-url]:not([data-jalios-csp-settings-header-url=""])').on("click",function(){let url=b(this).data("jalios-csp-settings-header-url");b.JCMS.jcmsplugin.cs.SettingsUtils.updateHeader(url)})};let initImagePositionChooser=function(){b(".csp-header-position").on("click",function(e){let $target=b(this);let posX=$target.data("jalios-csp-header-position-x");let posY=$target.data("jalios-csp-header-position-y");b("#cs-header").css("background-position-x",posX).css("background-position-y",posY);b(".csp-header-position").removeClass("active");$target.addClass("active");b("INPUT[name='headerPosX']").val(posX);b("INPUT[name='headerPosY']").val(posY)})};let initImageRepeatChooser=function(){b("INPUT:radio[name=headerRepeat]").on("change",updateHeaderRepeat)};let updateHeaderRepeat=function(){b("#cs-header").css("background-repeat",b("INPUT:radio[name=headerRepeat]:checked").val())};let initImageMirrorChooser=function(){b("INPUT:radio[name=headerMirror]").on("change",udpateHeaderMirror)};let udpateHeaderMirror=function(){let $target=b("INPUT:radio[name=headerMirror]:checked");let mirrorBoth=$target.val()==="mirror";let mirrorX=mirrorBoth||$target.val()==="mirror-x";let mirrorY=mirrorBoth||$target.val()==="mirror-y";b("#cs-header").removeClass("cs-header-mirror");b("#cs-header").removeClass("cs-header-mirror-x");b("#cs-header").removeClass("cs-header-mirror-y");let src=b.JCMS.jcmsplugin.cs.SettingsUtils.getHeader();if(!mirrorX&&!mirrorY){b("#cs-header").css({"background-image":"url("+src+")"});return}if(mirrorBoth){b("#cs-header").addClass("cs-header-mirror")}else{if(mirrorX){b("#cs-header").addClass("cs-header-mirror-x")}else{if(mirrorY){b("#cs-header").addClass("cs-header-mirror-y")}}}b.JCMS.jcmsplugin.cs.HeaderUtils.initMirror(src,{mirrorX:mirrorX,mirrorY:mirrorY});updateHeaderRepeat()};let initCondensedChooser=function(){b("INPUT:radio[name=headerCondensed]").on("change",function(e){let $target=b(this);refreshTabsBgColor(null,null);if($target.val()==="true"){b.JCMS.jcmsplugin.cs.SettingsUtils.refreshHeader();b(".cs-portal").addClass("cs-is-condensed");b(".settings-header-nav-tabs LI[role=presentation]:first A").trigger("click")}else{b(".cs-portal").removeClass("cs-is-condensed");b.JCMS.jcmsplugin.cs.SettingsUtils.refreshHeader()}})};let updateOnChooserChange=function(e,f){e.on("change",f)};if(!b.JCMS){b.JCMS={}}if(!b.JCMS.jcmsplugin){b.JCMS.jcmsplugin={}}if(!b.JCMS.jcmsplugin.cs){b.JCMS.jcmsplugin.cs={}}b.JCMS.jcmsplugin.cs.SettingsUtils={initAccessSignupCompatibility:function(){let accessPolicies=b("INPUT[name='accessPolicy']");let signupPolicies=b("INPUT[name='signupPolicy']");b.JCMS.jcmsplugin.cs.AccessSignupUtils.initAccessSignupCompatibility(accessPolicies,signupPolicies)},getHeader:function(){let src=b('.header-background-image-chooser INPUT:text[name="header"]').val();return src},updateTheme:function(e){b.JCMS.jcmsplugin.cs.SettingsUtils.resetBgColor();b.JCMS.jcmsplugin.cs.SettingsUtils.resetTitleColor();b.JCMS.jcmsplugin.cs.SettingsUtils.resetTabsColor();b.JCMS.jcmsplugin.cs.SettingsUtils.resetTabsBgColor();let $portal=b(".cs-portal");let classes=$portal[0].className.split(/\s+/);for(let i=0;i<classes.length;i++){if(classes[i].startsWith("cs-theme-")){$portal.removeClass(classes[i]);break}}$portal.addClass(e);b(".theme-color-list LI").each(function(){b(this).removeClass("active")});b(".theme-color-list LI."+e).addClass("active");b.JCMS.jcmsplugin.cs.SettingsUtils.setTabsOpacity(20)},refreshHeader:function(){let isNoImage=b("#header0").attr("checked")===true;let isCondensed=b.JCMS.jcmsplugin.cs.SettingsUtils.isCondensed();if(isNoImage||isCondensed){b.JCMS.jcmsplugin.cs.SettingsUtils.updateHeader(null);return}let src=b.JCMS.jcmsplugin.cs.SettingsUtils.getHeader();b.JCMS.jcmsplugin.cs.SettingsUtils.updateHeader(src)},updateHeader:function(e){let $header=b("#cs-header");if(!e){$header.css("background-image","");$header.removeClass("cs-custom-header");return}b(".cs-settings [name='header']").val(e);udpateHeaderMirror();$header.css("background-image","url("+e+")");$header.addClass("cs-custom-header")},resetBgColor:function(){let $input=b('[name="headerBgColor"]');$input.closest(".widget-content").find('[data-jalios-action="widget:clear"]').click()},resetTitleColor:function(){let $input=b('[name="headerTitleColor"]');$input.closest(".widget-content").find('[data-jalios-action="widget:clear"]').click()},resetTabsColor:function(){let $input=b('[name="headerTabsColor"]');$input.closest(".widget-content").find('[data-jalios-action="widget:clear"]').click()},resetTabsBgColor:function(){let $input=b('[name="headerTabsBgColor"]');$input.closest(".widget-content").find('[data-jalios-action="widget:clear"]').click()},setTabsOpacity:function(e){if($opacitySlider){$opacitySlider.slider("setValue",e);refreshTabsBgColor(null,null)}},isCondensed:function(){return b("INPUT:radio[name=headerCondensed]:checked").val()==="true"}};b(document).ready(function(e){register()});const a=function(){b.ajax({url:"plugins/CollaborativeSpacePlugin/jsp/portal/collaborativeSpaceActions.jsp",data:{opRemoveJMobileSessionAttribute:true}})};const c=function(){b("#mobile-preview-frame").on("load",a)};c();b(document).on("jalios:refresh",function(e){if(e.refresh.type!=="after"){return}if(!e.refresh||!e.refresh.options||!e.refresh.options.params.mobilePortlets){return}c()})}(window.jQuery);