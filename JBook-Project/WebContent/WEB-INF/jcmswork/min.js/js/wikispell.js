function setCaretTo(b,a){setSelectionRange(b,a,a)}function setSelectionRange(c,e,f){c.focus();if(c.setSelectionRange){c.setSelectionRange(e,e);try{var a=document.createEvent("KeyEvents");a.initKeyEvent("keypress",true,true,window,false,false,false,false,27,null);c.dispatchEvent(a)}catch(d){}c.setSelectionRange(e,f)}else{if(c.createTextRange){var b=c.createTextRange();b.move("character",e);b.moveEnd("character",f-e);b.select()}}}function getSelectionStart(a){if(a.setSelectionRange){return a.selectionStart}else{if(a.createTextRange){if(!a.ownerDocument){a.ownerDocument=document}var e=a.ownerDocument.selection.createRange();if(e.parentElement().tagName!="TEXTAREA"){return 0}else{if(e.text.length==0){var c=a.value;var d="~JCMSwikiSearchAndReplaceBookmark~";e.text=d;var b=a.value.search(d);a.value=c;b-=a.value.substr(0,b).split("\n").length-1;setCaretTo(a,b);return b}else{return ie_getSelectionBoundary(a,"Start")}}}}}function getSelectionEnd(a){if(a.setSelectionRange){return a.selectionEnd}else{if(a.createTextRange){if(!a.ownerDocument){a.ownerDocument=document}var b=a.ownerDocument.selection.createRange();if(b.text.length==0){return getSelectionStart(a)}else{return ie_getSelectionBoundary(a,"End")}}}}function ie_getSelectionBoundary(c,a){if(!c.ownerDocument){c.ownerDocument=document}var f=c.ownerDocument.selection.createRange();var b=c.createTextRange();var g=c.createTextRange();var e=f.getBookmark();g.moveToBookmark(e);b.setEndPoint("EndTo"+a,g);var d=b.text.length;d-=b.text.split("\n").length-1;f.select();return d}function getSelectionText(a,b){if(!b){b=0}if(a.setSelectionRange){return a.value.substring(a.selectionStart-b,a.selectionEnd+b)}else{if(document.selection){if(!a.ownerDocument){a.ownerDocument=document}range=a.ownerDocument.selection.createRange();range.moveStart("character",-b);range.moveEnd("character",b);return range.text}}}function replaceSelection(d,a){d.focus();if(d.setSelectionRange){var e=d.selectionStart;var f=d.selectionEnd;d.value=d.value.substring(0,e)+a+d.value.substring(f);if(e!=f){setSelectionRange(d,e,e+a.length)}else{setCaretTo(d,e+a.length)}}else{if(document.selection){if(!d.ownerDocument){d.ownerDocument=document}var c=d.ownerDocument.selection.createRange();var b=c.text.length==0;c.text=a;if(!b){c.moveStart("character",-a.length);c.select()}}}}function parsePattern(b){var a=new Array("\\","/","^","$","*","+","?","{","}",".","(",")","|","[","]");for(var c=0;c<a.length;c++){var d=new RegExp("\\"+a[c],"g");b=b.replace(d,"\\"+a[c])}return b}function search(q,g,a,d,l,r,p){if((!a)||a>q.value.length){a=0}if((!d)){if(r){d=0}else{d=q.value.length}}if(d<a){var f=d;d=a;a=f}else{if(d==a){if(r){a=0}else{d=q.value.length}}}if(document.selection){var c=q.value.substring(0,a).split("\n").length-1;a+=c;c=q.value.substring(0,d).split("\n").length-1;d+=c}if(p){var e="[^\\w\\xC0-\\xFF]";var o="(^|"+e+")("+parsePattern(g)+")($|"+e+")"}else{var o=parsePattern(g)}var b="g";if(!l){b+="i"}o=new RegExp(o,b);var k=q.value.substring(a,d);var h;if(r){while(f=o.exec(k)){h=f.index}}else{h=o.exec(k);if(h){h=h.index}}if(h!==null&&h>=0){if(p&&RegExp.lastMatch.substr(0,1)!=g.substr(0,1)){h++}if(document.selection){h-=q.value.substring(0,a+h).split("\n").length-1}setSelectionRange(q,a+h,a+h+g.length);return true}else{return false}}function searchIntoSelection(c,d,b,f,e){if(!c.ownerDocument){c.ownerDocument=document}if(document.selection&&c.ownerDocument.selection.createRange().text.length==0){var g=getSelectionStart(c);var a=g}else{var g=getSelectionStart(c);var a=getSelectionEnd(c)}return search(c,d,g,a,b,f,e)}function searchNext(b,c,a,e,d){if(search(b,c,e?getSelectionStart(b):getSelectionEnd(b),null,a,e,d)){return true}else{if((a&&getSelectionText(b)==c&&b.value.lastIndexOf(c)==b.value.indexOf(c))||(!a&&getSelectionText(b).toLowerCase()==c.toLowerCase()&&b.value.toLowerCase().lastIndexOf(c)==b.value.toLowerCase().indexOf(c))){alert(onlyOneOccurenceMessage)}else{if(confirm(e?loopSearchBackwardConfirmMessage:loopSearchForwardConfirmMessage)){return search(b,c,0,b.value.length,a,e,d)}}}}function clearSelection(b){if(b.setSelectionRange){var c=b.selectionStart;var d=b.selectionEnd;if(!(c<d)){return true}while(b.value.charAt(c)==" "){c++}while(b.value.charAt(d-1)==" "){d--}setSelectionRange(b,c,d);if(!(c<d)){return true}}else{if(document.selection){var a=document.selection.createRange();if(a.text==""){return true}while(a.text.length>0&&a.text.charAt(0)==" "){a.moveStart("character",1)}while(a.text.length>0&&a.text.charAt(a.text.length-1)==" "){a.moveEnd("character",-1)}a.select();if(a.text==""){return true}}}return false}function expandSelectionRange(a,b){if(!b){return}if(a.setSelectionRange){setSelectionRange(a,a.selectionStart-b,a.selectionEnd+b)}else{if(document.selection){range=document.selection.createRange();range.moveStart("character",-b);range.moveEnd("character",b);range.select()}}}function parseSelection(a,d,c){if(d.length<=0){return}if(clearSelection(a)){return}found=false;m=new Array(0,2,1);for(j=0;(j<m.length&&!found);j++){n=m[j];var b=getSelectionText(a,n);for(i=0;i<c.length;i++){if(b.substr(0,c[i].length)==c[i]&&b.substr(b.length-c[i].length,c[i].length)==c[i]){b=b.substring(c[i].length,b.length-c[i].length);found=true;if(c[i]==d){d=""}break}}}if(found){expandSelectionRange(a,n)}if(!found){b=getSelectionText(a)}replaceSelection(a,d+b+d)};