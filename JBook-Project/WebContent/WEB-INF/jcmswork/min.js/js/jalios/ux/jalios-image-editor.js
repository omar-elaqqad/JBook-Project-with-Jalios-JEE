!function(f){var e={minZoom:0.1,maxZoom:1,initialZoom:0.8,targetHeight:0.3};var b={viewMode:0,preview:".img-preview",responsive:true,aspectRatio:NaN,autoCropArea:1,checkOrientation:true,crop:function(j){f.console.log("No crop function declared in image editor")},zoom:function(j){let resetZoom=null;if(j.ratio<e.minZoom){resetZoom=e.minZoom}else{if(j.ratio>e.maxZoom){resetZoom=e.maxZoom}}if(resetZoom!=null){j.preventDefault();f(this).cropper("zoomTo",resetZoom)}},cropResultWrapper:".crop-results-wrapper"};var d=function(k){var j=f(".cropper-wrapper");j.imagesLoaded(function(){var n=f("#cropImgArea").data();var m=f.extend({},b,n);var o=f(m.cropResultWrapper);var l={crop:function(q){var p=f(q.target).data("cropper").getData(true);o.find(".image-editor-img-width").val(p.width);o.find(".image-editor-img-height").val(p.height);o.find("INPUT[name=x1]").val(p.x);o.find("INPUT[name=x2]").val(p.x+p.width);o.find("INPUT[name=y1]").val(p.y);o.find("INPUT[name=y2]").val(p.y+p.height);o.find("INPUT[name=scaleX]").val(p.scaleX);o.find("INPUT[name=scaleY]").val(p.scaleY);o.find("INPUT[name=rotate]").val(p.rotate)},built:function(){const s=f(this).data("cropper").options;if(typeof s.aspectRatio==="number"&&isNaN(s.aspectRatio)){const p=f(this).cropper("getCanvasData");const r=f(this).cropper("getCropBoxData");f(this).cropper("zoomTo",e.initialZoom*f(".cropper-container").height()/(p.naturalHeight+1));f(this).cropper("setCropBoxData",p)}const q=f(this).cropper("getCroppedCanvas");if(q!=null){f(this).data("jalios-cropped-image",q.toDataURL("image/jpeg"))}f(".image-editor-loader-wrapper").removeClass("in").addClass("hide")}};m=f.extend({},m,l);m=f.extend({},m,k);f("#cropImgArea").cropper(m)})};var a=function(k){var n=f(this);var l=n.data();if(n.prop("disabled")||n.hasClass("disabled")){return}var j=f("#cropImgArea");if(j.data("cropper")&&l.jaliosCropperMethod){l=f.extend({},l);if(typeof l.target!=="undefined"){$target=f(l.target);if(typeof l.jaliosOption==="undefined"){try{l.jaliosOption=JSON.parse($target.val())}catch(m){f.console.log(m.message)}}}result=j.cropper(l.jaliosCropperMethod,l.jaliosOption,l.jaliosOption2);switch(l.jaliosCropperMethod){case"scaleX":case"scaleY":f(this).data("jalios-option",-l.jaliosOption);break}}};var c=function(o){var q=f(this);var l=q.attr("name");var n=q.prop("type");var p;var k;var j={aspectRatio:NaN};var m=f("#cropImgArea");if(!m.data("cropper")){return}if(n==="checkbox"){j[l]=q.prop("checked");p=m.cropper("getCropBoxData");k=m.cropper("getCanvasData");j.built=function(){m.cropper("setCropBoxData",p);m.cropper("setCanvasData",k)}}else{if(n==="radio"){j[l]=q.val()}}f(".image-editor-loader-wrapper").removeClass("hide").addClass("in");m.cropper("destroy");d(j)};var h=function(m){var j=f(m.target);var k=j.data("jalios-image-title");var l=j.data("jalios-prompt-title");f.jalios.ui.Modal.prompt(l,function(q){if(q===false){return}var p=j.closest("FORM");var o=f("<input>").attr("type","hidden").attr("name","opCropNew").val("true");var n=f("<input>").attr("type","hidden").attr("name","title").val(q);p.append(f(o));p.append(f(n));p.submit()},k)};var g=function(k){var j=f.jalios.Event.match(k,"refresh","after");if(!j){return}d()};var i=function(){f(".image-editor").on("click","[data-jalios-cropper-method]",a);f(".image-editor").on("change","[name=aspectRatio]",c);f(".image-editor").on("click",".create-new-image",h);f(document).on("jalios:refresh",g);d()};f(document).ready(function(j){i()})}(window.jQuery);