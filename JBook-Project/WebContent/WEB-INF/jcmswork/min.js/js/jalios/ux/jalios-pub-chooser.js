Dropzone.autoDiscover=false;!(function(g){let PUB_ITEM_TEMPLATE;let isDropEnabled=false;var f;var a=function(){f=setInterval(function(){if(g(".upload-previews-body .explorer-item-data.dz-error").length===0&&g(".upload-previews-body .explorer-item-data:not(.dz-complete)").length===0){g(".upload-previews").removeClass("is-displayed");unbindUnload();clearInterval(f)}},3000)};const h={url:"jcore/pubchooser/handlePubChooserAction.jsp",paramName:"documents",clickable:false,autoQueue:false,params:{opUpload:true},uploadprogress:function(q,o,p){if(q.previewElement){var r=q.previewElement.querySelector(".dz-progress");r.querySelector(".dz-upload").style.width=o+"%";r.querySelector(".progress-text").textContent=Math.round(o)+"%"}},previewTemplate:document.querySelector("#template-container").innerHTML,previewsContainer:".upload-previews-body",init:function(){this.on("addedfile",function(o){o.accepted=true;this.enqueueFile(o);g(".upload-previews").addClass("is-displayed");a()});this.on("error",function(p,o,q){});this.on("queuecomplete",function(o){});this.on("sending",function(o,q,p){p.append("documentWorkspace",g(".chooser-navbar :input[name=chooserWorkspace]").val());p.append("documentSuperClass",g(".add-button-wrapper").data("jalios-pubchooser-supertype"))});this.on("success",function(q){window.scrollTo(0,0);g("[name=mids],[name=gids], [name=text]").val("");g(".pub-chooser-results").refresh({isform:true});g(".dropzone-full").addClass("hide");var p=JSON.parse(q.xhr.response);if(p.actionStatus==="ERROR"){g(q.previewElement).find(".dz-progress").remove();g(q.previewElement).find(".dz-error-message > SPAN").text(p.message);g(q.previewElement).removeClass("dz-success").removeClass("dz-complete").addClass("dz-error")}else{var o=JSON.parse(q.xhr.response).data.dataId;setTimeout(function(){g(q.previewElement).remove()},7000)}});this.on("dragover",function(o){});this.on("dragleave",function(o){g(".dropzone-full").addClass("hide");g(".dropzone-full-forbidden").addClass("hide")})}};const m=function(){window.addEventListener("dragenter",function(o){if(g(".modal.in").exists()){return}if(isDropEnabled){g(".dropzone-full").removeClass("hide")}else{g(".dropzone-full-forbidden").removeClass("hide")}});g(".dropzone-full-forbidden").on("drop",function(o){o.preventDefault();g(".dropzone-full-forbidden").addClass("hide")});g(".dropzone-full-forbidden").on("dragleave",function(o){g(".dropzone-full-forbidden").addClass("hide")});let fullDropzone=g(".dropzone-full").dropzone(h)[0].dropzone};const k=function(){g(".chooser-navbar").refresh({isform:true,callback:function(){g(".select2-enumerate").select2({theme:"bootstrap"});g(".pub-chooser-results .ajax-loading-component").remove()}})};const l=function(){let formData=g.jalios.Utils.formdata.getFormData(".pub-chooser FORM");let data=g.jalios.Utils.formdata.getFormDataAsJsonObject(formData);g(".add-button-wrapper").refresh({params:data,preventNextRefresh:true,callback:function(){isDropEnabled=!g(".add-button-wrapper").is(":empty")?g(".add-button-wrapper").data("jalios-pubchooser-drop-enabled"):false}})};const n=function(o){if(o.refresh.type==="serialize"){if(g(o.refresh.target).hasClass("pub-chooser-results")&&!o.refresh.options.showMore){g(".js-chooser-pager-start").val(0);window.scrollTo(0,0)}return}if(o.refresh.type==="before"){if(o.refresh.url==="jcore/pubchooser/pubChooserInner.jsp"){g(".pub-chooser-results").displayLoading()}if(o.refresh.options.fieldAutocomplete){o.refresh.options.params.start=0;g(".js-chooser-pager-start").val(0);window.scrollTo(0,0)}}if(o.refresh.type==="after"){if(!g(".pub-chooser").hasClass("has-hidden-filters")){g(".show-more-filter").addClass("dropup")}g(".select2-enumerate").select2({theme:"bootstrap"});if(g(o.refresh.target).hasClass("pub-chooser-results")){j();g(".pub-chooser-results .ajax-loading-component").remove();l()}if(o.refresh.url==="jcore/pubchooser/pubChooserInner.jsp"){if(g("TR.is-selectable").length>0){g(".table-chooser").removeClass("hide");g(".no-result-wrapper").addClass("hide")}else{g(".table-chooser").addClass("hide");g(".no-result-wrapper").removeClass("hide")}}return}};const j=function(){if("IntersectionObserver" in window){observer=new IntersectionObserver(d,c);g(".btn-show-more").each(function(o,p){observer.observe(p)})}};const c={rootMargin:"100px 0px",threshold:0.01};const d=function(o){o.forEach(function(p){if(p.intersectionRatio>0){observer.unobserve(p.target);g(p.target).refresh({showMore:true,callback:function(){j()}})}})};const b=function(o){let $tableItem=g(o.currentTarget).closest("TR");let action=g(o.currentTarget).data("jalios-chooser-action");let dataId=$tableItem.data("jalios-data-id");let dataLabel=$tableItem.find(".js-label").text();let dataUrl=$tableItem.find(".js-dataurl").prop("href");switch(action){case"toggleFilters":g(".pub-chooser").toggleClass("has-hidden-filters");g(".show-more-filter").toggleClass("dropup");break;case"pubChooserMultipleInsertCheckbox":o.stopPropagation();if($tableItem.hasClass("active")){$tableItem.removeClass("active");g(".multi-select-values-wrapper .pub-item[data-jalios-data-id="+dataId+"]").remove()}else{$tableItem.addClass("active");g(".multi-select-values-wrapper").append(PUB_ITEM_TEMPLATE({dataId:dataId,dataLabel:dataLabel}))}break;case"pubChooserMultipleInsert":o.preventDefault();if($tableItem.hasClass("active")){$tableItem.removeClass("active");$tableItem.find(".multiple-check").prop("checked",false);g(".multi-select-values-wrapper .pub-item[data-jalios-data-id="+dataId+"]").remove()}else{g(".multi-select-values-wrapper").append(PUB_ITEM_TEMPLATE({dataId:dataId,dataLabel:dataLabel}));$tableItem.addClass("active");$tableItem.find(".multiple-check").prop("checked",true)}break;case"multipleInsert":let ids=[];g(".multi-select-values-wrapper .pub-item").each(function(p,q){ids.push(g(q).data("jalios-data-id"))});g.jalios.Browser.callback(ids.join(" "),g(o.currentTarget).data("jalios-insert-label"),undefined,undefined);window.close();break;case"removeItem":dataId=g(o.currentTarget).data("jalios-data-id");g(o.currentTarget).closest(".pub-item").remove();g(".table-chooser tr[data-jalios-data-id="+dataId+"]").removeClass("active");g(".table-chooser tr[data-jalios-data-id="+dataId+"] .multiple-check").prop("checked",false);break;case"resetSearch":o.preventDefault();g(".pub-chooser-search").val("");window.scrollTo(0,0);g(".pub-chooser-results").refresh({isform:true});break;case"unifiedInsertSelect":o.preventDefault();g.jalios.UnifiedInsert.insertLink(dataId,true);break;case"jsFuncInsert":o.preventDefault();e(g(".js-func").val(),window.opener,dataId,dataLabel,dataUrl);window.close();break;case"pubChooserInsert":o.preventDefault();JcmsLogger.info("insertLink",dataId,dataLabel,dataUrl);g.jalios.Browser.callback(dataId,dataLabel,undefined,dataUrl);window.close();break;default:}};const e=function(t,q){var o=Array.prototype.slice.call(arguments,2);var s=t.split(".");var r=s.pop();for(var p=0;p<s.length;p++){q=q[s[p]]}return q[r].apply(q,o)};const i=function(){g(document).on("click","[data-jalios-chooser-action]",b);g(document).on("click",".pub-chooser-author",function(o){o.preventDefault()});g(".select2-enumerate").select2({theme:"bootstrap"});j();g(document).on("jalios:refresh",n);m();g(document).on("click",".close-preview",function(o){g(".upload-previews").removeClass("is-displayed")});isDropEnabled=g(".add-button-wrapper").exists()?g(".add-button-wrapper").data("jalios-pubchooser-drop-enabled"):false};g(document).ready(function(){i();if(g("#pub-item").exists()){PUB_ITEM_TEMPLATE=Handlebars.compile(g("#pub-item").html())}})})(window.jQuery);