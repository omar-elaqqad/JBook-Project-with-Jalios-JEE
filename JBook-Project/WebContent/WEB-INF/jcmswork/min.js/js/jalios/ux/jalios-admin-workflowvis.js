!(function(b){var c=function(C,h){var z={heightCompressionFactor:1.4,widthCompressionFactor:0.9,nodesCloserMaxNodes:7,nodesFartherMinNodes:10,arrowHeadSize:10,initialStateOffsetX:2,initialStateOffsetY:18,initialStateSize:"32px",controlButtonSize:"128px",controlButtonTop:"-400px",controlButtonLeft:"600px",mailActionSize:18,mailActionOffsetX:20,mailActionOffsetY:22,margin:{top:40,right:60,bottom:40,left:60},nodeLabelOffset:10,nodeRadius:30,nodeLabelFontSize:"12px",edgeArrowHeadColor:"#aaa",edgeDefaultColor:"#ccc",edgeHoverColor:"#000",edgeLabelColor:"#aaa",edgeLabelFontSize:"10px",edgeLabelOffsetY:15,canvasWidth:1440,canvasHeight:480};z=b.extend({},z,JSON.parse(h||"{}"));if(b(".browser-IE11").length){z.controlButtonTop="-100px"}var v=z.canvasWidth-z.margin.left-z.margin.right,p=z.canvasHeight-z.margin.top-z.margin.bottom;var t=C.states.map(function(x){return x.name});if(t.length<=z.nodesCloserMaxNodes){z.widthCompressionFactor=z.widthCompressionFactor*2}if(t.length>=z.nodesFartherMinNodes){z.widthCompressionFactor=z.widthCompressionFactor/1.5}var A=2*z.canvasWidth;var i=2*z.canvasHeight;var d=d3.zoom().scaleExtent([0.2,10]).translateExtent([[-A,-A],[A,i]]).on("zoom",o);var q=d3.select(".workflow-view").append("svg").style("height",z.canvasHeight).style("width",z.canvasWidth).attr("viewBox",[-z.margin.left*z.widthCompressionFactor,p/2,z.canvasWidth,z.canvasHeight]).style("background-color","rgba(255,255,255,0)");var k=d3.select(".workflow-view").append("div").attr("class","toolbar").style("position","relative").style("left",z.controlButtonLeft).style("top",z.controlButtonTop).style("pointer-events","none").style("z-index",0).append("svg").attr("width",128).attr("height",128).attr("viewBox",[0,0,512,512]).append("g").attr("transform","translate(0 128) scale(1)");k.append("text").attr("text-anchor","start").attr("x",0).attr("y",0).attr("class","workflow-control zoom-in").attr("style","font-family:FontAwesome;").attr("cursor","pointer").attr("pointer-events","all").attr("font-size",z.controlButtonSize).text(function(x){return"\uf00e"}).on("mouseover",function(x){}).on("click",function(x){y()});k.append("text").attr("text-anchor","start").attr("x",0).attr("y",128).attr("class","workflow-control zoom-out").attr("style","font-family:FontAwesome;").attr("cursor","pointer").attr("pointer-events","all").attr("font-size",z.controlButtonSize).on("mouseover",function(){}).text(function(x){return"\uf010"}).on("click",function(x){m()});d3.select("body").on("keydown",function(){if(d3.event.keyCode===27){e()}});var B=q.append("g").attr("transform","translate("+z.margin.left+","+z.margin.top+")");q.call(d).on("wheel.zoom",null);function o(){B.attr("transform",d3.event.transform)}function e(D){if(typeof D==="undefined"){D==700}var x;if(b(".browser-IE11").length){x=d3.zoomIdentity.scale(3).translate(-v/4,-p/2)}else{x=d3.zoomIdentity}q.transition().duration(D).call(d.transform,x,d3.zoomTransform(q.node()).invert([v/2,p/2]))}function y(){q.transition().call(d.scaleBy,1.5)}function m(){q.transition().call(d.scaleBy,0.5)}e(0);var j=d3.scalePoint().range([0,(v*1)/z.widthCompressionFactor]).domain(t);var n=function(U,S,x){var G=j(U.source),F=j(U.target),J=p-2*z.nodeRadius,L=F-G,O=F-G,K=J-J,Q=Math.sqrt(L*L+K*K);if(typeof x==="undefined"){x=false}var P=Q,N=Q,H=0,V=0,M=1;var I=[];if(G===F||U.wfLevel===0){H=-45;V=1;P=30;N=20;I=["M",G,J,"A",P,",",N,H,V,",",M,F+1,",",J+1].join(" ")}else{if(U.wfLevel===1){var E=J+Math.floor(0.5*z.nodeRadius*2);I=["M",G,E,"Q",G+10,E+10,F,E].join(" ")}else{var W;var X=G>F;var E=J;var T=F;var R=G;var D=L;if(!X){E=E+z.nodeRadius}W=X?1:0;if(X&&x){T=G;R=F;D=-L}else{if(X){W=0}}I=["M",R,E,"A",(-D/2)*z.heightCompressionFactor,",",(-D/2)*z.heightCompressionFactor,0,0,",",W,T,",",E].join(" ")}}return I};var w=function(){return location.href.replace(location.hash,"")};var f=B.selectAll(".links").data(C.transitions).enter().append("path").attr("pointer-events","none").style("fill","none").style("stroke-width","1px").attr("stroke",z.edgeDefaultColor).attr("d",function(D,x){return n(D,x,false)}).attr("id",function(D,x){return"edgeId"+x});var l=B.selectAll(".linksUni").data(C.transitions).enter().append("path").style("opacity","0").attr("d",function(D,x){return n(D,x,true)}).attr("id",function(D,x){return"edgeUniId"+x});var s=B.selectAll(".edgeArrowHead").data(C.transitions).enter().append("text").attr("pointer-events","none").attr("class","edge arrowhead").attr("dx",0).attr("dy",5).attr("style","font-family:Arial;").style("font-size","16px").style("text-anchor","middle").style("fill",z.edgeArrowHeadColor).append("textPath").attr("pointer-events","none").attr("startOffset","52%").attr("xlink:href",function(D,x){return w()+"#edgeId"+x}).text(function(D,x){return"\u25ba"});var u=B.selectAll(".wk-nodes").data(C.states).enter().append("circle").attr("id",function(D,x){return"nodeId"+x}).attr("cx",function(x){return j(x.name)}).attr("cy",p-z.nodeRadius).attr("r",z.nodeRadius).attr("class",function(x){return"wk-node"}).style("fill",function(x){return x.stateColor}).style("stroke","#000").style("stroke-width","0px").style("opacity",1);B.selectAll(".wk-nodes").data(C.states).enter().filter(function(D,x){return D.initState===true}).append("text").attr("style","font-family:FontAwesome;").style("pointer-events","none").attr("font-size",z.initialStateSize).attr("x",function(x){return j(x.name)-z.initialStateOffsetX}).attr("y",function(x){return p-z.initialStateOffsetY}).text(function(x){return"\uf0da"});var g=B.selectAll(".edgeLabel").data(C.transitions).enter().append("text").style("pointer-events","none").attr("class","label").attr("dx",0).attr("dy",z.edgeLabelOffsetY).attr("style","font-family:Arial;").style("fill",z.edgeLabelColor).style("font-size",z.edgeLabelFontSize).attr("font-weight",function(D,x){return 100}).style("text-anchor","middle").style("fill","#000").append("textPath").style("pointer-events","none").attr("startOffset","52%").attr("xlink:href",function(D,x){return w()+"#edgeUniId"+x}).text(function(D,x){return""||D.wfGroups});let labelRightBounds=[];let addHeightToPreventOverlapping=0;var r=B.selectAll(".nodeLabels").data(C.states).enter().append("text").style("pointer-events","none").attr("style","font-family:Arial;").style("font-size",z.nodeLabelFontSize).attr("font-weight",function(D,x){return 700}).text(function(x){return x.name}).attr("x",function(x){return j(x.name)}).attr("y",function(x){labelRightBounds.push(this.getBBox());if(labelRightBounds.length>1){let previousBBox=labelRightBounds[labelRightBounds.length-2];let previousBBoxEndX=previousBBox.x+previousBBox.width;if(previousBBoxEndX>this.getBBox().x){addHeightToPreventOverlapping=addHeightToPreventOverlapping===0?this.getBBox().height:0}else{addHeightToPreventOverlapping=0}}return p+z.nodeLabelOffset+addHeightToPreventOverlapping}).style("text-anchor","middle");u.on("mouseover",function(x){d3.select(this);s.style("opacity",function(D){return D.source===x.name||D.target===x.name?1:0.2});g.style("opacity",function(D){return D.source===x.name||D.target===x.name?1:0.2}).each(function(D){d3.select(this).raise()});f.style("opacity",function(D){return D.source===x.name||D.target===x.name?1:0.2}).style("stroke",function(D){return D.source===x.name||D.target===x.name?z.edgeHoverColor:z.edgeDefaultColor})}).on("mouseout",function(x){s.style("opacity","1");g.style("opacity","1");f.style("stroke",z.edgeDefaultColor).style("stroke-width","1").style("opacity","1")});B.selectAll(".wk-nodes").data(C.states).enter().filter(function(D,x){return(D.recUser===true||D.recWorker===true||D.recManager===true||D.sendUser===true||D.sendWorker===true||D.sendManager===true)}).append("image").attr("xlink:href",function(x){return"images/jalios/workflow/bell2.svg"}).attr("width",z.mailActionSize).attr("height",z.mailActionSize).attr("class","wk-icon").style("fill","#fff").attr("x",function(x){return j(x.name)+z.nodeRadius-z.mailActionOffsetX/2-z.mailActionSize/2}).attr("y",function(x){return p-z.mailActionOffsetY}).on("mouseover",function(D){var x=b(this).position();b(this).tooltip({title:D.info,container:".workflow-view",html:true,placement:"right",trigger:"manual"});b(".workflow-view .tooltip").tooltip("hide");b(this).tooltip("show");b(".workflow-view .tooltip .tooltip-arrow").attr("style","")}).on("mouseout",function(x){b(this).tooltip("hide")})};var a=function(){var d=function(f,g,e){d3.json(f+"?id="+encodeURIComponent(g),function(h){c(h,e)})};if(!b.jalios){b.jalios={}}if(!b.jalios.ui){b.jalios.ui={}}if(!b.jalios.ui.workflow){b.jalios.ui.workflow={}}b.jalios.ui.workflow.render=d};b(document).on("jalios:ready",a)})(window.jQuery);