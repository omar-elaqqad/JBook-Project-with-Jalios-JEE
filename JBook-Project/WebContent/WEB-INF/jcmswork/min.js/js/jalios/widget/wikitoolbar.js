if(!window.WikiToolbar){var WikiToolbar=new Object()}Object.extend(WikiToolbar,{_init:false,initWikiToolbar:function(){if(WikiToolbar._init){return}WikiToolbar._init=true;var b=new Date().getTime();Event.observe("wikitoolbar","mousedown",JCMS.form.Widget.dragStart);var a=new Date().getTime();JcmsLogger.info("WikiToolbar","Init WikiToolbar Manager"," in "+(a-b)+" ms")},_word:function(c){if(c.start>c.end){return}var e=c.start;var a=c.end;var d=c.input.value;if(e==a){e--}var b=d.charAt(e);while(e>=0&&b!=" "&&b!="\n"&&b!="\r"){e--;b=d.charAt(e)}return d.substring(e+1,c.end)},runLineBreak:function(b){JcmsLogger.debug("WikiToolbar","runLineBreak");var a=WikiToolbar.getContext(b);InputUtil.replaceSelection(a.input,"#\n",true);return false},runPublink:function(b){JcmsLogger.debug("WikiToolbar","runPublink");var a=WikiToolbar.getContext(b);this.currentSelection=InputUtil.getSelection(a.input,true);var c=Element.getJcmsId(document.body,"WS_");Popup.popupWindow(a.ctxPath+"/work/pubChooser.jsp?textFieldPubLink=true&jsFunc=WikiToolbar.insertPubLinkCallback&ws="+c,"pubChooser",1200,700,false,true,true,false);return false},runPubUrl:function(c){JcmsLogger.debug("WikiToolbar","runPubUrl");var b=WikiToolbar.getContext(c);this.currentSelection=InputUtil.getSelection(b.input,true);var a=this.currentSelection.value?encodeURIComponent(this.currentSelection.value):"";Popup.popupWindow(b.ctxPath+"/work/wikiLink.jsp?txt="+a+"&jsFunc=WikiToolbar.insertWikiLinkCallback","pubChooser",400,210,false,true,false,false);return false},runInsertMedia:function(b){JcmsLogger.debug("WikiToolbar","runInsertMedia");var a=WikiToolbar.getContext(b);this.currentSelection=InputUtil.getSelection(a.input,true);var c=Element.getJcmsId(document.body,"WS_");jQuery.jalios.ui.Widget.Chooser.openDataChooser("media",WikiToolbar.insertMediaUrlCallback,{params:{ws:c}});return false},runBold:function(b){JcmsLogger.debug("WikiToolbar","runBold");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^\*(.+)\*$/gm,"$1","*$1*",true);return false},runSnippet:function(f,a){JcmsLogger.debug("WikiToolbar","runSnippet");var b=a.fastChild("IMG");var d=b.alt.replace("{0}","$1");var c=WikiToolbar.getContext(f);var e=InputUtil.getSelection(c.input,true);InputUtil.replaceRegexp(e.input,/^(.+)$/g,d,d,true,true,e);return false},runItalic:function(b){JcmsLogger.debug("WikiToolbar","runItalic");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^_(.+)_$/gm,"$1","_$1_",true);return false},runBoldItalic:function(b){JcmsLogger.debug("WikiToolbar","runBoldItalic");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^__(.+)__$/gm,"$1","__$1__",true);return false},runFixed:function(b){JcmsLogger.debug("WikiToolbar","runFixed");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^=(.+)=$/gm,"$1","=$1=",true);return false},runBoldFixed:function(b){JcmsLogger.debug("WikiToolbar","runBoldFixed");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^==(.+)==$/gm,"$1","==$1==",true);return false},runOrderedList:function(b){JcmsLogger.debug("WikiToolbar","runOrderedList");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^(.+)$/gm,"   1 $1","   1 $1",false);return false},runUnorderedList:function(b){JcmsLogger.debug("WikiToolbar","runUnorderedList");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^(.+)$/gm,"   * $1","   * $1",false);return false},runOutdent:function(b){JcmsLogger.debug("WikiToolbar","runOutdent");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^[\n\r\t]*[ ]{3}([\d\*][ ])*(.+)$/gm,"$2","$1",false);return false},runIndent:function(b){JcmsLogger.debug("WikiToolbar","runIndent");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^(.+)$/gm,"   $1","   $1",false);return false},runHorizontalRule:function(b){JcmsLogger.debug("WikiToolbar","runHorizontalRule");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^\s*-{30}(.*)\n*$/g,"$1","\n------------------------------\n$1",false,true);return false},runHeading1:function(b){JcmsLogger.debug("WikiToolbar","runHeading1");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^\s*---\+\+\s(.+)$/gm,"$1","---++ $1",false);return false},runHeading2:function(b){JcmsLogger.debug("WikiToolbar","runHeading2");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^\s*---\+\+\+\s(.+)$/gm,"$1","---+++ $1",false);return false},runHeading3:function(b){JcmsLogger.debug("WikiToolbar","runHeading3");var a=WikiToolbar.getContext(b);InputUtil.replaceRegexp(a.input,/^\s*---\+\+\+\+\s(.+)$/gm,"$1","---++++ $1",false);return false},runSearch:function(b){JcmsLogger.debug("WikiToolbar","runSearch");var a=WikiToolbar.getContext(b);if(window.showModelessDialog){window.showModelessDialog(a.ctxPath+"/work/wikiSearchReplace.jsp",a.input,"help:no;status:no;scroll:no;dialogWidth:330px;dialogHeight:400px;")}else{Popup.popupWindow(a.ctxPath+"/work/wikiSearchReplace.jsp?targetInputId="+a.input.id,"Search",330,400,false,true,false,false)}return false},runSpell:function(b){JcmsLogger.debug("WikiToolbar","runSpell");var a=WikiToolbar.getContext(b);if(window.showModelessDialog){window.showModelessDialog(a.ctxPath+"/work/wikiSpellChecker.jsp?lang="+a.input.lang,a.input,"help:no;status:no;scroll:no;dialogWidth:400px;dialogHeight:500px;")}else{Popup.popupWindow(a.ctxPath+"/work/wikiSpellChecker.jsp?targetInputId="+a.input.id+"&lang="+a.input.lang,"SpellChecker",400,500,false,true,false,false)}return false},runQuery:function(b){JcmsLogger.debug("WikiToolbar","runQuery");var a=WikiToolbar.getContext(b);this.currentSelection=InputUtil.getSelection(a.input,true);jQuery.jalios.ui.Widget.Chooser.openDataChooser("query",WikiToolbar.insertQueryCallback);return false},getPreview:function(){var a=$("wikipreview");if(!a){a=document.createElement("IFRAME");a.id="wikipreview";a.className="wikipreview";document.body.appendChild(a);a=$(a);a.addClassName("hidden")}return a},hidePreview:function(c,a){a=a||WikiToolbar.getContext(c).input;var d=this.getPreview();if(d.hasClassName("show")){jQuery("#wikitoolbar button").prop("disabled",false);jQuery("#wikitoolbar").removeClass("preview-enabled");try{clearInterval(WikiToolbar.wikiPreviewResizeTimer)}catch(b){}d.addClassName("hidden");d.removeClassName("show");return true}return false},showPreview:function(c){var b=WikiToolbar.getContext(c);var a=b.input;var f=this.getPreview();jQuery("#wikitoolbar button").not(".wiki-preview").prop("disabled",true);jQuery("#wikitoolbar").addClass("preview-enabled");var d=2;f.style.height=(a.getHeight()-5-(2*d))+"px";f.style.width=(a.getWidth()-1-(2*d))+"px";f.style.margin=d+"px";f.innerHTML="";var e=function(){this.addClassName("show");this.removeClassName("hidden");f.scrollTop=(a.scrollTop*f.scrollHeight)/a.scrollHeight;WikiToolbar.wikiPreviewInputHeight=a.getHeight();WikiToolbar.wikiPreviewInputWidth=a.getWidth();try{clearInterval(WikiToolbar.wikiPreviewResizeTimer)}catch(g){}WikiToolbar.wikiPreviewResizeTimer=setInterval(function(){if(a.getHeight()!=WikiToolbar.wikiPreviewInputHeight){f.style.height=(a.getHeight()-5)+"px";WikiToolbar.wikiPreviewInputHeight=a.getHeight()}if(a.getWidth()!=WikiToolbar.wikiPreviewInputWidth){f.style.width=(a.getWidth()-1)+"px";WikiToolbar.wikiPreviewInputWidth=a.getWidth()}},100);jQuery(f).off("load",e)};jQuery(f).on("load",e);f.src="s.gif";f.src=JCMS.Security.getUrlWithCSRFToken("jcore/wiki/wiki2html.jsp?targetInputId="+a.id+"&time="+(new Date()).getTime());a.parentNode.insertBefore(f,a);return},runPreview:function(c){JcmsLogger.debug("WikiToolbar","runPreview");var b=WikiToolbar.getContext(c);var a=$(b.input);if(this.hidePreview(c)){return}this.showPreview(c);return false},runHelp:function(b){JcmsLogger.debug("WikiToolbar","runHelp");var a=WikiToolbar.getContext(b);Popup.popupWindow(a.ctxPath+"/work/howToTFR.jsp","JaliosTFR",900,500,false,true,true,false);return false},runExpandToolbar:function(a){JcmsLogger.debug("WikiToolbar","runExpandToolbar");jQuery("#wikitoolbar").toggleClass("full-toolbar");return false},runReduceToolbar:function(a){JcmsLogger.debug("WikiToolbar","runReduceToolbar");jQuery("#wikitoolbar").toggleClass("full-toolbar");return false},insertQueryCallback:function(c,b){var a=WikiToolbar.currentSelection;if((!a)||(!c)){return}InputUtil.replaceRegexp(a.input,/^(.+)$/g,"$1 "+c+" ",c,true,true,a);WikiToolbar._closeMenu()},insertPubLinkCallback:function(c,b){JcmsLogger.debug("WikiToolbar","insertPubLinkCallback");var a=WikiToolbar.currentSelection;if((!a)||(!c)){return}InputUtil.replaceRegexp(a.input,/^(.+)$/g,"[["+c+"][$1]]","[["+c+"]["+b+"]]",true,true,a)},insertPubURLCallback:function(c,b){JcmsLogger.debug("WikiToolbar","insertPubURLCallback");var a=WikiToolbar.currentSelection;if((!a)||(!c)){return}InputUtil.replaceRegexp(a.input,/^(.+)$/g,"display.jsp?id="+c,"display.jsp?id="+c,true,true,a)},insertWikiLinkCallback:function(b,a){JcmsLogger.debug("WikiToolbar","insertWikiLinkCallback");var c=WikiToolbar.currentSelection;if((!c)||(!b)){return}InputUtil.replaceRegexp(c.input,/^(.+)$/g,"[["+b+"]["+a+"]]","[["+b+"]["+a+"]]",true,true,c)},insertWikiURLCallback:function(b,a){JcmsLogger.debug("WikiToolbar","insertWikiURLCallback");var c=WikiToolbar.currentSelection;if((!c)||(!b)){return}InputUtil.replaceRegexp(c.input,/^(.+)$/g,b,b,true,true,c)},insertMediaUrlCallback:function(g,f,d,c,a,b){JcmsLogger.debug("WikiToolbar","insertMediaUrlCallback");var e=WikiToolbar.currentSelection;if((!e)||(!c)){return}if(d=="image"){InputUtil.replaceRegexp(e.input,/^(.+)$/g,"$1 "+c+" "," "+c+" ",true,true,e)}else{InputUtil.replaceRegexp(e.input,/^(.+)$/g,"$1 [media path='"+c+"'] "," [media path='"+c+"'] ",true,true,e)}},getContext:function(d){var b=new Object();b.x=Event.pointerX(d);b.y=Event.pointerY(d);b.ctxPath=JcmsJsContext.getContextPath();try{var c=Event.element(d);b.input=c.fastUp("DIV","wikitoolbar").fastPrevious("TEXTAREA");b.form=b.input.form;b.formName=b.form.attributes.name.value}catch(a){}if(!b.input){alert(I18N.glp("error.unknown"))}b.getInputPos=function(){if(this._inputPos||!this.form||!this.input){return this._inputPos}this._inputRel=-1;$A(this.form.elements).each(function(f,e){if(f.name==this.input.name){this._inputRel+=1}if(f==this.input){this._inputPos=e;throw $break}}.bind(this));return this._inputPos}.bind(b);b.getInputRel=function(){this.getInputPos();return this._inputRel};return b}});Event.observe(window,"load",function(){WikiToolbar.initWikiToolbar.defer()},false);if(document.isAjaxRefresh){WikiToolbar.initWikiToolbar()};