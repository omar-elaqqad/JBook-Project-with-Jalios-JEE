!(function(e){e.fn.initWysiwyg=function(){return this.each(function(){var j=e(this);if(j.hasClass("wysiwyg-editor-init-in-progress")){e.console.error("Concurrent wysiwyg initialization attempt for element",j[0]);return}j.addClass("wysiwyg-editor-init-in-progress");try{j.removeWysiwyg();var g=e(j[0].form);g.data("pending-wysiwyg-init",(g.data("pending-wysiwyg-init")||0)+1);g.addClass("wysiwyg-init-in-progress");j.wysiwyg({language_load:true,language:e.jalios.I18N.glp("lang.tinymce"),setup:f})}catch(i){e.console.error("An error occurred while initializing the wysiwyg editor on element #"+j.attr("id")+": "+i.stack?i.stack:i);var h=j.closest(".wysiwyg-editor");j.removeWysiwyg();c(h);h.append('<div class="wysiwyg-message wysiwyg-message-error"><p>'+I18N.glp("wysiwyg.error.msg")+"</p></div>");var g=e(j[0].form);g.data("pending-wysiwyg-init",(g.data("pending-wysiwyg-init")||0)-1);if(g.data("pending-wysiwyg-init")<=0){g.removeClass("wysiwyg-init-in-progress")}j.removeClass("wysiwyg-editor-init-in-progress")}});function f(n){if(!n.jalios){n.jalios={}}if(!n.jalios.plugins){n.jalios.plugins={}}var j=e(n.getElement());var m=j.closest(".wysiwyg-editor");d(m);var g=n?n.settings:null;if(g){if(g.resize&&g.statusbar===false){g.statusbar=true}if(g.extended_valid_elements){var o=g.extended_valid_elements.split(",");var h="";for(var l=0;l<o.length;l++){if(l>0){h+=","}var k=o[l];if(k.indexOf("jalios")!=-1){if(k.indexOf("contenteditable")<0){if(k.indexOf("[")!=-1){h+=k.replace("]","|contenteditable]")}else{h+=k+"[contenteditable]"}}}}g.extended_valid_elements=h}}n.settings=g;n.on("init",function(u){if(tinyMCE.majorVersion==4){m.find("IFRAME").css("width","calc(100% - 1px)")}if(tinyMCE.majorVersion==4&&n.settings.height<100&&n.settings.min_height<=n.settings.height){e("#"+n.id+"_ifr").css("height",n.settings.height)}var y=e(j[0].form);y.data("pending-wysiwyg-init",(y.data("pending-wysiwyg-init")||0)-1);if(y.data("pending-wysiwyg-init")<=0){y.removeClass("wysiwyg-init-in-progress")}if(j.prop("disabled")||j.prop("readonly")){n.setMode("readonly")}j.removeClass("wysiwyg-editor-init-in-progress");j.addClass("wysiwyg-initialized");c(m);var x=e(n.getContainer());var v=x.closest(".focus").exists()&&x.is(":visible");if(v){n.focus()}var w=0;tinymce.editors.each(function(i){if(n==i){w++}});while(w>1){for(var r=0;r<tinymce.editors.length;r++){if(tinymce.editors[r]==n){tinymce.editors.splice(r,1);break}}w--}var t=n.settings.scrollto;if(t){if(isNaN(t)){var q=e(n.getBody()).find(t);if(q.length){let $children=e(n.iframeElement).contents().children();if($children.length>0){$children.animate({scrollTop:q.get(0).offsetTop},200)}let $wysiwygInlineButtons=e(".wysiwyg-inline-buttons");if($wysiwygInlineButtons.exists()){let docScrollTop=e(".wysiwyg-inline-buttons").offset().top-e(".topbar").height()-20;e(window).scrollTop(docScrollTop)}}}else{var s=parseInt(t,10);if(!isNaN(s)){e(n.getWin()).scrollTop(s)}}}var p=e.Event("wysiwyg:ready");p.editor=n;j.trigger(p)})}};e.fn.removeWysiwyg=function(){return this.each(function(){var g=e(this);try{g.wysiwyg("destroy")}catch(f){e.console.error("An error occurred while removing the wysiwyg editor on element #"+g.attr("id")+": "+f.stack?f.stack:f)}})};const d=function(f){f.displayLoading()};const c=function(f){let $loading=f.find(".ajax-loading-component");$loading.fadeOut(function(){$loading.remove()})};var a=function(){if(typeof tinymce===undefined){return}var f=[];tinymce.editors.each(function(g){if(!e(g.getElement()).closest("html").exists()){f.push(g)}});f.each(function(g){g.destroy()})};var b=function(f){tinymce.baseURL=JcmsJsContext.getBaseUrl()+e.jalios.Properties.get("wysiwyg.path");e(".js-wysiwyg:not(.js-wysiwyg-skip-init):not(.wysiwyg-editor-init-in-progress):not(.wysiwyg-initialized)").initWysiwyg();e(document).on("click",'[data-jalios-action^="wysiwyg:"]',function(j){var h=e(this);var g=h.data("jalios-action");var i=e.Event(g);h.trigger(i)});e(document).on("wysiwyg:init",function(i){var g=e(i.target);var h=g.data("jalios-target");if(h){e(h).initWysiwyg()}});e(document).on("wysiwyg:remove",function(i){var g=e(i.target);var h=g.data("jalios-target");if(h){e(h).removeWysiwyg()}});a()};e(document).on("jalios:ready",function(f){b(f)});e(document).on("hide.bs.modal",function(f){e(".tox.tox-tinymce-aux").empty()});e(document).on("jalios:refresh",function(f){var g=e.jalios.Event.match(f,"refresh","after");if(g){a()}})})(window.jQuery);