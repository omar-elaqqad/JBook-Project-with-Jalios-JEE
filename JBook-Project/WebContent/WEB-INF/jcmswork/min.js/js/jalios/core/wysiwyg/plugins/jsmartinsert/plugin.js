!(function(a){tinymce.PluginManager.add("jsmartinsert",function(f,i){f.addShortcut("ctrl+"+tinymce.util.VK.SPACEBAR,"jsmartinsert.description",j);d(f);function j(){n();var O=f.selection,H=f.dom;if(O.isCollapsed()){var G="&#xFEFF;";var P="marker";try{var y='<span id="'+P+'">'+G+"</span>";O.setContent(y);var B=a(f.getBody()).find("#marker");var J=B.get(0);O.select(J);O.collapse();var z=O.getNode();var K=z.innerHTML;var A="\\u0030-\\u0039\\u0041-\\u007A\\u00C0-\\u00FF\\u0100-\\u017F\\u0180-\\u024F\\u0370-\\u03FF\\u0400-\\u04FF";var D="(["+A+"]+)(&nbsp;|\\s)*"+a.jalios.Common.escapeRegExp(y).replace(G,"[^<]*");var v=new RegExp(D,"i");z.innerHTML=K.replace(v,function(R,Q,S){return'<span class="mce-match-marker-selected">'+Q+"</span>"+(S?S:"")});var M=a(f.getBody()).find("SPAN.mce-match-marker-selected");if(M.length){var C=M.get(0);var L=C.firstChild;var N=C.firstChild;c(C);var x=H.createRng();x.setStart(L,0);x.setEnd(N,N.data.length);O.setRng(x)}}catch(I){a.console.log("Could not select the word: "+I.stack?I.stack:I)}finally{H.remove("marker")}}var E=O.getContent({format:"text"});if(!!a.trim(E)&&!E.match(/[\r\n]+/gi)){var F=a('<div class="jalios-smartinsert ajax-refresh-div typeahead-menu"><ul class="dropdown-menu"><li class="loading"></li></ul></div>');var w=f.inline?e():r();F.css({top:w.top+5,left:w.left});a("body").append(F);F.on("click",h);F.data("selectedText",E);l(F)}}function c(w){var v=w.parentNode;if(w.firstChild){v.insertBefore(w.firstChild,w)}w.parentNode.removeChild(w)}function r(){var x=a(f.getContainer()).offset();var v=a(f.getContentAreaContainer()).position();var w=t(f.selection);return{top:x.top+v.top+w.top+w.height,left:x.left+v.left+w.left}}function e(){const v=t(f.selection);return{top:v.top+a(document).scrollTop(),left:v.left}}function t(z){var v;var w=z.getRng(true);if(w.getClientRects){var y=w.getClientRects();if(y.length>0){v=y[0]}}if(!v){var x=a(z.getNode());var A=x.position();v={top:A.top,left:A.left,height:x.innerHeight,width:x.innerWidth}}return v}function l(v){a.ajax({url:"js/jalios/core/wysiwyg/plugins/jsmartinsert/jsp/smartinsert.jsp",data:{autocomplete:v.data("selectedText")},dataType:"html",cache:true,success:function(w){v.html(w)}})}function m(w){var v=a(w.target).closest(".jalios-smartinsert");if(!v.exists()){n()}}function n(){var v=a(".jalios-smartinsert");v.remove()}function h(v){var w=a(v.target).closest("LI");return k(w,v)}function k(x,w){if(x.length){var v=x.data();if(!a.isEmptyObject(v)){q(v);n()}else{if(x.hasClass("ajax-refresh")){x.find("A").refresh({noscroll:true,nohistory:true,callback:function(){}})}else{if(x.hasClass("nomatch")){n()}}}}if(w){w.stopPropagation();w.preventDefault()}}function q(w){var v='<jalios:link data-jalios-id="'+w.value+'" />&nbsp;';f.selection.setContent(v);f.focus()}function d(){f.on("keyup",o);f.on("keydown",u);f.on("click",m);f.on("init",function(){a(f.getWin()).on("scroll",n)});let editorIdSelector="#"+f.id;a(document).on("click",editorIdSelector,m);f.on("remove",function(){a(document).off("click",editorIdSelector,m)})}function o(x){var w=a(".jalios-smartinsert");if(w.length){switch(x.which||x.keyCode){case 40:case 38:case 16:case 17:case 18:case 32:break;case 9:case 13:var y=w.find("LI.active");k(y);break;case 37:g(w);break;case 8:var v=w.find(".dropdown-menu-main");if(v.length){n()}else{if(!g(w)){l(w)}}break;case 39:s(w);break;case 27:case 46:n();break;default:}}}function u(w){var v=a(".jalios-smartinsert");if(v.length){switch(w.which||w.keyCode){case 8:case 9:case 13:case 27:case 32:case 37:case 39:case 46:w.preventDefault();break;case 38:w.preventDefault();b();break;case 40:w.preventDefault();p();break}w.stopPropagation()}}function g(v){var w=false;var x=v.find("LI.previous");if(x.length){k(x);w=true}return w}function s(v){var w=false;var x=v.find("LI.next");if(x.length){k(x);w=true}return w}function b(){var x=a(".jalios-smartinsert");var v=x.find("li.active").index(),w=v===0?x.find("li").length-1:--v;x.find("li").removeClass("active").eq(w).addClass("active");if(x.find("li.active").hasClass("results")){b()}}function p(){var x=a(".jalios-smartinsert");var v=x.find("li.active").index(),w=v===x.find("li").length-1?0:++v;x.find("li").removeClass("active").eq(w).addClass("active");if(x.find("li.active").hasClass("results")){p()}}})})(window.jQuery);