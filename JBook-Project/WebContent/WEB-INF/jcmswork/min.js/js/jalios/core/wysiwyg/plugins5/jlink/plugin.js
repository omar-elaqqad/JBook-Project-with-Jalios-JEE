!function(a){tinymce.PluginManager.add("jlink",function(i,b){var p="jalios:link";var k="data-jalios-id";var d="a";var n="data-jalios-link-id";var f=i.getParam("link_template_block","<"+p+"@attributes@>@content@</"+p+">");var j=i.getParam("link_template_short","<"+p+"@attributes@ />");var m=i.getParam("link_placeholder","<"+d+"@attributes@>@content@</"+d+">");var l=a.wysiwyg.utils.getTagRegExp(p,k);var o=a.wysiwyg.utils.getTagRegExp(d,n);i.jalios.plugins.jlink={insertTag:function(t){var r={source:t};var q=i.selection.getContent();if(!!a.trim(q)&&!q.match(/[\r\n]+/gi)){r.content=q}var s=i.jalios.plugins.jlink.createTag(r);i.insertContent(s+"&nbsp;")},createTag:function(s){var r=" "+k+'="'+a.wysiwyg.utils.escape(s.source)+'"';r+=s.title?' data-jalios-title="'+a.wysiwyg.utils.escape(s.title)+'"':"";r+=s.style?' data-jalios-style="'+a.wysiwyg.utils.escape(s.style)+'"':"";r+=s.classes?' data-jalios-class="'+a.wysiwyg.utils.escape(s.classes)+'"':"";r+=s.target?' data-jalios-target="'+a.wysiwyg.utils.escape(s.target)+'"':"";r+=s.displayUrl?' data-jalios-url="'+a.wysiwyg.utils.escape(s.displayUrl)+'"':"";var q;if(s.content){q=f.replace(/@attributes@/g,r).replace(/@content@/g,s.content)}else{q=j.replace(/@attributes@/g,r)}return q},createHtmlTag:function(r){var s=r.displayUrl||r.url;var q=' href="'+s+'" '+n+'="'+a.wysiwyg.utils.escape(r.source)+'"';q+=r.title?' title="'+a.wysiwyg.utils.escape(r.title)+'"':"";q+=r.style?' style="'+a.wysiwyg.utils.escape(r.style)+'"':"";q+=r.classes?' class="'+a.wysiwyg.utils.escape(r.classes)+'"':"";q+=r.target?' target="'+a.wysiwyg.utils.escape(r.target)+'"':"";q+=r.displayUrl?' data-jalios-url="'+a.wysiwyg.utils.escape(r.url)+'"':"";return m.replace(/@attributes@/g,q).replace(/@content@/g,r.content)}};i.ui.registry.addIcon("jlink",'<span class="jalios-icon icomoon-file-text2"></span>');i.ui.registry.addToggleButton("jlink",{tooltip:tinymce.i18n.translate("jlink.btn.tooltip"),icon:"jlink",onAction:h,onSetup:function(q){const r=function(s){q.setActive(c(s.element))};i.on("NodeChange",r);return function(s){i.off("NodeChange",r)}}});i.addCommand("JaliosInsert-link",function(t,r){if(!r){return}var s=r["data-jalios-id"];var q=i.jcms.getMediaInfos(s);if(q&&q.source){i.jalios.plugins.jlink.insertTag(q.source)}});i.on("ResolveName",function(r){var q=r.target;if(c(q)){r.name="jalios:link"}});i.on("Click",function(r){var q=r.target;if(c(q)){i.selection.select(q)}});i.on("BeforeSetContent",function(q){q.content=g(q.content)});i.on("PostProcess",function(q){if(q.get){q.content=e(q.content)}});function c(q){return(q.nodeName.toUpperCase()===d.toUpperCase()&&i.dom.getAttrib(q,n))}function h(){a.jalios.ui.Widget.Chooser.openDataChooser("publication",q,{params:{ws:i.jcms.getContext().getWorkspace()}});function q(v,x,w,t,u,s){var r={source:v,content:a.wysiwyg.utils.escape(x),title:x,type:w,url:t,width:u,height:s};i.jcms.setMediaInfos(r);i.jalios.plugins.jlink.insertTag(v)}}function g(q){return q.replace(l,function(s){var u=a(s);var v=u.attr(k);var t=i.jcms.getMediaInfos(v);var w=/^\w+_\w+$/.match(v);var x=w&&(!t||t.source===t.url);if(t&&t.source&&!x){var r={source:v,content:u.html(),title:u.attr("data-jalios-title"),style:u.attr("data-jalios-style"),classes:u.attr("data-jalios-class"),target:u.attr("data-jalios-target"),url:t.url,displayUrl:t.displayUrl};if(a.wysiwyg.utils.validation.isHtmlBlank(r.content)){r.content=a.wysiwyg.utils.escape(t.title)||(w?"":a.wysiwyg.utils.escape(v))}return i.jalios.plugins.jlink.createHtmlTag(r)}else{return s}})}function e(q){q=q.replace(o,function(s){var v=a(s);var w=v.attr(n);var t=i.jcms.getMediaInfos(w);var u=v.attr("data-jalios-url")||v.attr("href");if(u===t.url){var r={source:w,content:(t.title||"").replaceAll(/\ +/g," ")!==a.wysiwyg.utils.unescape(v.html())?v.html():false,title:t.title!==v.attr("title")?v.attr("title"):false,style:v.attr("style"),classes:v.attr("class"),target:v.attr("target")};return i.jalios.plugins.jlink.createTag(r)}else{return v.attr(n,null).prop("outerHTML")}});return q}})}(window.jQuery);