(function(B,G,e,l){var x=function(Q){B.console.debug("[alert-topbar-menu]","markAsRead");Q.stopImmediatePropagation();var N;var P=B(Q.currentTarget).closest(".alert-menu-item");if(P.exists()){N=P.data("jalios-dataid")}if(!N){var M=B(Q.currentTarget).closest(".alert-preview");var L=M.find(".alert-card");if(L.exists()){N=L.data("jalios-alert-id")}}if(!N){return}if(!P||!P.exists()){P=B(".topbar-alert-menu .main-menu .alert-menu-item[data-jalios-dataid="+N+"]")}var O=P.data("jalios-alert-level");Q.isAutoRead=B.jalios.alert.topbar.isAutoRead(O);if(B(Q.currentTarget).hasClass("card-action-item-mark-as-unread")){B.jalios.alert.markAsUnread(N,Q)}else{B.jalios.alert.markAsRead(N,Q)}};var w=function(L){B.console.debug("[alert-topbar-menu]","confirmMarkAllRead");B.ajax({url:B.jalios.alert._ACTION_URL,dataType:"json"}).done(function(N){B.console.debug("[alert-topbar-menu]","after refreshUnreadInfo (by confirmMarkAllRead)");if(!N){return}if(N.count===0){B(e).click();var M=B.jalios.I18N.glp("alerts.no-unread-alerts");toastr.options.timeOut=2000;toastr.options.positionClass="toast-top-center";toastr.info(M)}else{if(N.count>0){var O=N.count==1?B.jalios.I18N.glp("alerts.mark-all-read.confirm",N.count):B.jalios.I18N.glp("alerts.mark-all-read.confirm-2",N.count);B.jalios.ui.Modal.confirm(O,B.jalios.alert.markAllAsRead)}}})};var I=function(P){if(!P||!P.alert){return}if(!P.alert.originalEvent){return}B.console.debug("[alert-topbar-menu]","afterRead","event.alert.type="+P.alert.type);var N=P.alert.originalEvent.isAutoRead;var O;if(N){O=B(P.alert.originalEvent.target).closest(".alert-menu-item")}else{O=B(P.alert.originalEvent.currentTarget).closest(".alert-menu-item")}if(O.exists()){i(O)}var M=B(P.alert.originalEvent.currentTarget).closest(".alert-preview");if(M.exists()){O=B(".topbar-alert-menu .list-group .alert-menu-item[data-jalios-dataid="+P.alert.alertId+"]");if(O.exists()){if(N){i(O)}else{O.addClass("has-been-read")}}var L=M.closest(".child-menu");C().returnToMainMenu(L)}};var o=function(N){if(!N||!N.alert){return}if(!N.alert.originalEvent){return}B.console.debug("[alert-topbar-menu]","afterUnread","event.alert.type="+N.alert.type);if(!N.alert.originalEvent.isAutoRead){return}var L=B(N.alert.originalEvent.target).closest(".child-menu");if(L.exists()){var M=s(L);if(M){h(M)}}var O=".topbar-alert-menu .child-menu .alert-preview [data-jalios-alert-id='"+M.data("jalios-dataid")+"']";B(O+" .js-alert-mark-as-read").toggleClass("hide")};var p=function(M){var L=M.dropdown&&M.dropdown.type==="done"&&M.dropdown.trigger&&M.dropdown.trigger.hasClass("topbar-alert-menu");if(L){a();u();g()}};var u=function(){var M=z();var L=B(".js-alert-mark-all-as-read");if(M===0){if(!L.hasClass("hide")){L.addClass("hide")}}else{if(M>0){if(L.hasClass("hide")){L.removeClass("hide")}}}};var a=function(){if(B.jalios&&B.jalios.alert&&B.jalios.alert.topbar&&B.jalios.alert.topbar.truncateItems){B.jalios.alert.topbar.truncateItems()}};var J=function(){var L=B(this);if(L.scrollTop()+parseInt(L.innerHeight(),10)>=L[0].scrollHeight-50){if(L.find(".js-show-alerts-more-items").exists()){L.find(".js-show-alerts-more-items").displayLoading();L.find(".js-show-alerts-more-items A")[0].click()}}};var n=function(L){if(z()===0){B(".topbar-alert-menu .topbar-ctxmenu-no-result").removeClass("is-hidden")}else{B(".topbar-alert-menu .topbar-ctxmenu-no-result").addClass("is-hidden")}B(".topbar-alert-menu .ajax-loading-component").remove();B(".topbar-alert-menu-dropdown").removeClass("is-loading");u()};var g=function(){if(B.jalios&&B.jalios.alert&&B.jalios.alert.topbar&&B.jalios.alert.topbar.recomputeMenuHeight){return B.jalios.alert.topbar.recomputeMenuHeight()}};var m=function(){var M=z();var L=B(".topbar-alert-menu .js-show-alerts-more-items");if(M<=5&&L.exists()){L.displayLoading();L.find("A")[0].click()}else{n();g()}};var f=function(M){var L=B.jalios.Event.match(M,"refresh","after");if(!L||!L.target){return}if(L.options.topbarAlertMore!==true){return}a();b();n();g();B(".topbar-alert-menu-dropdown .ajax-loading-component").remove();B(".topbar-alert-menu-dropdown").removeClass("is-loading")};var b=function(){var M=B(".topbar-alert-menu-dropdown .slide-wrapper");var L=M.find(".js-alert-previews");if(!L.exists()){return}M.append(L.html());L.remove()};var j=function(L){if(L.alert){if(L.alert.type==="action"){if(L.alert.action==="read"){I(L)}else{if(L.alert.action==="unread"){o(L)}}}else{if(L.alert.type==="read-all"){m();B("BODY > .alert-menu-moved").each(function(M,N){let $element=B(N);if(!$element.find("LI").exists()){$element.remove()}})}}}};var K=function(M){var L=d(M);if(!L||!L.exists()){return}B.console.debug("[alert-topbar-menu]","afterBackToMainMenu",M,L);y(L)};var A=function(M){var L=d(M);if(!L||!L.exists()){return}B.console.debug("[alert-topbar-menu]","afterReturnToMainMenu",M,L);y(L);if(L.hasClass("has-been-read")){i(L)}};var y=function(O){B.console.debug("[alert-topbar-menu]","restoreMainMenuScroll",O);var L=B(".topbar-alerts-item-wrapper");if(L.exists()){var N=O.offset().top;var P=B(".topbar-alert-menu-dropdown .slide-wrapper");var M=P.offset().top;var Q=N-M;B.console.debug("[alert-topbar-menu]","restoreMainMenuScroll","update scrollTop: "+Q);L[0].scrollTop=Q}};var i=function(M,L){B.console.debug("[alert-topbar-menu]","removeMainMenuAlert");M.hide("fast",function(){M.addClass("is-read");if(L){M.remove()}m()})};var h=function(L){B.console.debug("[alert-topbar-menu]","restoreMainMenuAlert");if(L&&L.exists()){L.removeClass("is-read");L.show();n();g()}};var F=function(O){B.console.debug("[alert-topbar-menu]","toggleSettings");var N=B(".topbar-alerts-menu .main-menu.list-group.is-active").exists();if(!N){var M=B(".topbar-alerts-menu .child-menu.is-active .alert-preview");if(M.exists()){var L=M.closest(".child-menu");C().returnToMainMenu(L)}}B(".topbar-alert-menu").toggleClass("is-settings-displayed");g()};var c=function(M){if(!B.jalios.a11y.isFocusedClick(M)){return}B.console.debug("[alert-topbar-menu]","backFromSettings");var L=B(".topbar-alerts-menu .main-menu.list-group.is-active").exists();if(!L){C().returnToMainMenu()}F()};var C=function(){if(B.jalios&&B.jalios.alert&&B.jalios.alert.topbar&&B.jalios.alert.topbar.getSlideMenuPlugin){var L=B.jalios.alert.topbar.getSlideMenuPlugin();return L}};var E=function(){return B(".topbar-alert-menu .main-menu .alert-menu-item:not(.is-read)")};var z=function(){return E().length};var d=function(L){if(!L.childMenu){return}B.console.debug("[alert-topbar-menu]","getMainMenuAlertFromSlideMenuEvent",L);return s(L.childMenu)};var s=function(M){if(!M){return}B.console.debug("[alert-topbar-menu]","getMainMenuAlertFromChildMenu",M);var L=M.data("bound");var O=B(".topbar-alert-menu-dropdown .slide-wrapper");var N=O.find(".list-group-item[data-bound='"+L+"']");return N};var t=function(M){var O=/settingsReadAuto/i;var L=B.jalios.Event.match(M,"broker",O,true);if(!L){return}var N=L.source.currentTarget;L.options._broked=true;B(N).refresh({params:{opUpdate:true},noresponse:true,callback:function(S){var Q=B(N)&&B(N).prop("checked");var P=B(N).data("jalios-menu-class");if(Q){B(".topbar .topbar-alert-menu").addClass(P)}else{B(".topbar .topbar-alert-menu").removeClass(P)}var R=B.jalios.I18N.glp("update.success");toastr.options.timeOut=1000;toastr.options.positionClass="toast-top-center";toastr.info(R)}})};var q=function(L){let $childMenu=L.childMenu;if(!$childMenu.exists()||!$childMenu.find("VIDEO").exists()){return}if(typeof(Event)==="function"){G.dispatchEvent(new Event("resize"))}};var H=function(M){if(!M){return}var L=B(M.target);if(!L.exists()||!L.hasClass("topbar-alert-menu")){return}L.removeClass("is-settings-displayed");var N=B(".topbar-alert-menu .topbar-ctxmenu-body");if(N.exists()){N.empty()}};var r=function(O){var N=B(O.currentTarget).closest(".alert-menu-item");if(!N){return}var M=N.data("jalios-alert-level");if(!B.jalios.alert.topbar.isAutoRead(M)){return}var L=N.data("jalios-dataid");O.isAutoRead=true;B.jalios.alert.markAsRead(L,O);var P=".topbar-alert-menu .child-menu .alert-preview [data-jalios-alert-id='"+N.data("jalios-dataid")+"']";B(P+" .js-alert-mark-as-read").toggleClass("hide")};var D=function(L){r(L);v(L)};var v=function(M){var R=B(M.currentTarget).closest(".alert-menu-item");if(!R||!R.exists()){return}var T=R.data("jalios-dataid");var O=".topbar-alert-menu .child-menu .alert-preview [data-jalios-alert-id='"+T+"']";var U=B(O+" .mejs-container");if(!U.exists()){return}var N=B(U[0]);if(N.data("alert-preview-media-resized")==="true"){return}var P=N.width();var V=N.height();N.attr("width","100%");N.css("width","100%");var S=P/V;var Q=N.width();var L=Q/S;N.height(L);N.data("alert-preview-media-resized","true")};var k=function(){B(e).on("click keydown",".topbar-alert-menu [data-jalios-topbar-menu-action]",function(L){if(!B.jalios.a11y.isFocusedClick(L)){return}L.preventDefault();var M=B(L.target).closest("[data-jalios-topbar-menu-action").data("jalios-topbar-menu-action");switch(M){case"markAsRead":x(L);break;case"confirmMarkAllRead":w(L);break;case"toggleSettings":L.stopImmediatePropagation();F(L);break;case"backFromSettings":c(L);break;case"onDisplayPreview":D(L);break}});B(".topbar-alert-menu-dropdown .topbar-ctxmenu-body").on("scroll",J);B(e).on("jalios:topbar-dropdown",p);B(e).on("click",".alert-menu-opener",function(M){M.stopImmediatePropagation();M.stopPropagation();var L=B(M.target).closest(".alert-menu-item").data("jalios-dataid");if(!B(M.target).closest(".dropdown").find(".dropdown-menu").exists()){var N=B(".alert-menu-moved[data-jalios-dataid="+L+"]");N.appendTo(".alert-menu-item[data-jalios-dataid="+L+"] .alert-menu-dropdown");N.removeClass("alert-menu-moved");N.removeClass("open");return}B("BODY > .alert-menu-moved").each(function(R,S){var Q=B(S);Q.appendTo(".alert-menu-item[data-jalios-dataid="+Q.data("jalios-dataid")+"] .alert-menu-dropdown");Q.removeClass("alert-menu-moved");Q.removeClass("open")});var P=B(M.target).closest(".dropdown").find(".dropdown-menu");P.addClass("alert-menu-moved");P.addClass("open");P.attr("data-jalios-dataid",P.closest(".alert-menu-item").data("jalios-dataid"));var O=Math.max(G.pageYOffset,e.documentElement.scrollTop,e.body.scrollTop);P.css({left:B(M.target)[0].getBoundingClientRect().left-P.width(),top:B(M.target)[0].getBoundingClientRect().top+O});P.closest(".topbar-ctxmenu-body")[0].addEventListener("ps-scroll-y",function(Q){P.appendTo(".alert-menu-item[data-jalios-dataid="+L+"] .alert-menu-dropdown");P.removeClass("alert-menu-moved");P.removeClass("open")});P.appendTo("BODY");P.one("hide.bs.dropdown",function(Q){P.appendTo(".alert-menu-item[data-jalios-dataid="+L+"] .alert-menu-dropdown");P.removeClass("alert-menu-moved");P.removeClass("open")})});B(e).on("jalios:refresh",f);B(e).on("jalios:alert",j);B(e).on("jalios.topbar.slidemenu.backToMainMenu",K);B(e).on("jalios.topbar.slidemenu.returnToMainMenu",A);B(e).on("jalios:broker",t);B(e).on("hide.bs.dropdown",H);B(e).on("jalios.topbar.slidemenu.transition.end",q)};B(e).ready(function(){k()})})(jQuery,window,document);