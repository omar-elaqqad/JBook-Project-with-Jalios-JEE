(function(e,d,b,f){var h;if(!e.jalios){e.jalios={}}if(!e.jalios.alert){e.jalios.alert={}}e.jalios.alert={_ACTION_URL:"jcore/alert/action/handleAlertAction.jsp",markAsRead:function(i,j){e.ajax({url:e.jalios.alert._ACTION_URL,data:{alerts:i,opRead:true},type:"post"}).then(function(l){var k=e.Event("jalios:alert");k.alert={};k.alert.type="action";k.alert.action="read";k.alert.alertId=i;if(j){k.alert.originalEvent=j}e.console.debug("[alert]","markAsRead: before trigger event");e(b).trigger(k);e.console.debug("[alert]","markAsRead: after trigger event");e.jalios.alert.refreshUnreadInfoFromParams(l.count,l.level)})},markAsUnread:function(i,j){e.ajax({url:e.jalios.alert._ACTION_URL,data:{alerts:i,opUnread:true},type:"post"}).done(function(l){var k=e.Event("jalios:alert");k.alert={};k.alert.type="action";k.alert.action="unread";k.alert.alertId=i;if(j){k.alert.originalEvent=j}e.console.debug("[alert]","markAsUnread: before trigger event");e(b).trigger(k);e.console.debug("[alert]","markAsUnread: after trigger event");e.jalios.alert.refreshUnreadInfoFromParams(l.count,l.level)})},markAllAsRead:function(j){var i=[{name:"opReadAll",value:"true"}];if(j){e.merge(i,j)}e.ajax({url:e.jalios.alert._ACTION_URL,type:"post",data:i}).done(function(m){var l=e.jalios.I18N.glp("alerts.mark-all-read.success");toastr.options.timeOut=2000;toastr.options.positionClass="toast-top-center";toastr.info(l);var k=e.Event("jalios:alert");k.alert={};k.alert.type="action";k.alert.action="all-read";e.console.debug("[alert]","markAllAsRead: before trigger event");e(b).trigger(k);e.console.debug("[alert]","markAllAsRead: after trigger event");e.jalios.alert.refreshUnreadInfoFromParams(m.count,m.level)})},refreshUnreadInfoFromParams:function(j,k){if(c(j,k)){var i=e.Event("jalios:alert");i.alert={};i.alert.type="refresh";i.alert.unreadInfo={count:j,level:k};e(b).trigger(i)}},refreshUnreadInfo:function(i){e.ajax({url:e.jalios.alert._ACTION_URL,dataType:"json",timeout:5000}).fail(function(j,k){if(k==="timeout"){e.console.debug("[alert]","Ajax has timed out")}}).done(function(l){var j=h;if(!l){return}if(!h||c(l.count,l.level)){h={count:l.count,level:l.level};var k=e.Event("jalios:alert");k.alert={};k.alert.type="refresh";k.alert.unreadInfo=l;k.alert.prevUnreadInfo=j;e(b).trigger(k)}})},handleAlertAction:function(i){i.stopPropagation();i.preventDefault();var k=e(i.currentTarget).data("jalios-alert-action");let $alertItem=e(i.currentTarget).closest("[data-jalios-dataid]");if(!$alertItem.exists()){return}let parentId=e(i.currentTarget).data("jalios-alert-parent-data-id");var l=e(i.currentTarget).closest(".dropdown-menu");var j={alerts:$alertItem.data("jalios-dataid")};j[k]=true;switch(k){case"opUnfollow":e.ajax({url:e.jalios.alert._ACTION_URL,method:"post",data:j}).done(function(m){l.find(".alert-unfollow-action").remove();l.find(".alert-unfollow-read-action").remove();toastr.options={positionClass:"toast-top-center"};toastr.info(I18N.glp("alert.action-unfollow-success.msg"))});break;case"opUnfollowRead":case"opReadAllPub":e.ajax({url:e.jalios.alert._ACTION_URL,method:"post",data:j}).done(function(n){e.jalios.alert.refreshUnreadInfoFromParams(n.count,n.level);if(parentId){e("[data-jalios-alert-parent-data-id="+parentId+"]").each(function(o,p){e(p).closest("LI").remove();e(p).remove()})}var m=e.Event("jalios:alert");m.alert={};m.alert.type="read-all";e(b).trigger(m);toastr.options={positionClass:"toast-top-center"};toastr.info(I18N.glp("alert.action-read-all-success.msg"))});default:}}};var c=function(k,l){if(!h){h={count:k,level:l};return false}var i=h.count!==k;var j=h.level!==l;if(i||j){h={count:k,level:l};return true}return false};var a=function(i){e.jalios.alert.refreshUnreadInfo()};var g=function(i){e.jalios.alert.handleAlertAction(i)};e(b).ready(function(){a();e(b).on("click","[data-jalios-alert-action]",g)})})(jQuery,window,document);