!function(a){tinymce.PluginManager.add("jtoc",function(g,i){const u=true;const q=3;const b=true;const w=6;const l=tinymce.i18n;var x="jalios:toc";var p="div";var t="jalios-toc";var v=g.getParam("toc_template","<"+x+"@attributes@ />");var k=g.getParam("toc_placeholder","<"+p+'@attributes@ class="'+t+'" contenteditable="false"><div class="jalios-toc-title">@title@</div><div class="jalios-toc-body"><ul><li>@autonumber@</li><li>@level@</li></ul></div></'+p+">");var s="<"+x+"[^>]*>(</"+x+">)?";var o=("<"+p+'[^>]*class="'+t+'[^"]*"[^>]*><div class="jalios-toc-title">([^<]+)</div><div class="jalios-toc-body"><ul><li>([^<]+)</li><li>([^<]+)</li></ul></div></'+p+">").replace(/></g,">[\\r\\n\\t\\s]*<");g.ui.registry.addIcon("jtoc",'<span class="jalios-icon icomoon-file-text"></span>');g.ui.registry.addToggleButton("jtoc",{tooltip:tinymce.i18n.translate("jtoc.btn.tooltip"),icon:"jtoc",onAction:function(y){n()},onSetup:function(y){const z=function(A){y.setActive(c(A.element))};g.on("NodeChange",z);return function(A){g.off("NodeChange",z)}}});g.on("ResolveName",function(z){var y=z.target;if(c(y)){z.name="jalios:toc"}});g.on("Click",function(z){var y=z.target;if(c(y)){g.selection.select(y)}});function c(y){return y.nodeName.toUpperCase()===p.toUpperCase()&&g.dom.hasClass(y,t)}g.on("BeforeSetContent",function(y){y.content=f(y.content)});g.on("PostProcess",function(y){if(y.get){y.content=m(y.content)}});function n(){var B=g.selection.getStart();var z=c(B);var y=u;var C=q;if(z){var A=a(B);y=j(A);C=d(A)}g.windowManager.open({title:"jtoc.form.title",body:{type:"panel",items:[{type:"checkbox",name:"autonumber",label:"jtoc.form.label.autonumber"},{type:"selectbox",name:"level",label:"jtoc.form.label.level",items:[{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"4",value:"4"},{text:"5",value:"5"},{text:"6",value:"6"}]}]},buttons:[{type:"cancel",name:"closeButton",text:"Cancel"},{type:"submit",name:"submitButton",text:"Save",primary:true}],initialData:{autonumber:y,level:""+C},onSubmit:function(D){var G=D.getData();var E=G.autonumber;var H=G.level;if(a.wysiwyg.utils.validation.isEmpty(E)){e.preventDefault();g.windowManager.alert(l.translate(["jtoc.form.error.required",l.translate("jtoc.form.label.autonumber")]));return}if(!a.wysiwyg.utils.validation.isBoolean(E)){e.preventDefault();g.windowManager.alert(l.translate(["jtoc.form.error.invalid-boolean",l.translate("jtoc.form.label.autonumber")]));return}if(a.wysiwyg.utils.validation.isEmpty(H)){e.preventDefault();g.windowManager.alert(l.translate(["jtoc.form.error.required",l.translate("jtoc.form.label.level")]));return}if(!a.wysiwyg.utils.validation.isInteger(H)){e.preventDefault();g.windowManager.alert(l.translate(["jtoc.form.error.invalid-integer",l.translate("jtoc.form.label.level")]));return}var F=r({autonumber:E,level:H});g.insertContent(F);D.close()}})}function f(z){var y=new RegExp(s,"gi");return z.replace(y,function(A){var B=a(A);return h({autonumber:j(B),level:d(B)})})}function m(z){var y=new RegExp(o,"gi");return z.replace(y,function(A){var B=a(A);return r({autonumber:j(B),level:d(B)})})}function r(z){var y="";y+=' data-jalios-autonumber="'+z.autonumber+'"';y+=z.level?' data-jalios-level="'+z.level+'"':"";return v.replace(/@attributes@/g,y).replace(/@content@/g,z.content)}function h(z){var y="";y+=' data-jalios-autonumber="'+z.autonumber+'"';y+=z.level?' data-jalios-level="'+z.level+'"':"";return k.replace(/@attributes@/g,y).replace("@title@",l.translate("jtoc.title")).replace(/@autonumber@/g,l.translate(["jtoc.autonumber",l.translate("jtoc.autonumber."+z.autonumber)])).replace(/@level@/g,l.translate(["jtoc.level",z.level]))}function j(z){var y=z.data("jalios-autonumber");if(y==undefined||y===""){y=b}return y}function d(y){var z=y.data("jalios-level");if(z==undefined||z===""){z=w}return z}})}(window.jQuery);