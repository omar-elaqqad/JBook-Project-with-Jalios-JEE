!function(f){var c=true;var e=function(){f(document).on("focusin","TEXTAREA.wikiarea",h);Typeahead.hooks.add(g);Typeahead.hooks.add(a);Typeahead.hooks.add(b)};var h=function(l){var j=f(l.currentTarget);if(j.data("typeahead")){return}var k=f('<div class="typeahead-menu ajax-refresh-div"></div>');var i="jcore/autocomplete/acwiki.jsp";j.typeahead({menu:k,ajax:i})};var d=false;var a=function(k){if(k.type!="select"){return}var j=k.typeahead.$element;if(j.prop("tagName")!="TEXTAREA"){return}var n=WikiToolbar._word(d);var m=k.$active.attr("data-value");var l=d.start-d.end;var o=k.$active.attr("data-placeholder");var i=k.$active.attr("data-mention-email-prefix");if(i){m="@"+i}else{if(o){m="[["+m+"]["+(o||n)+"]]"}}if(i&&n.lastIndexOf("@",0)!==0){InputUtil.replaceSelection(j[0],m,false,d,l?0:(-n.length+1))}else{InputUtil.replaceSelection(j[0],m,false,d,l?0:-n.length)}j.change();k.stop=true};var g=function(k){if(k.type!="lookup"){return}var j=k.typeahead;var i=j.$element;d=InputUtil.getSelection(i[0],false);var l=WikiToolbar._word(d);if(!i.hasClass("mention-disabled")&&c&&l&&l.length>1&&l.indexOf(" ")<0&&((l.indexOf("@")==0)||(l.indexOf("@")==1))){j.query=l;j.show()}else{if(k.explicit){j.query=l;j.show()}else{j.hide();k.stop=true}}};var b=function(m){var k=m.typeahead.$element;if(k.prop("tagName")!="TEXTAREA"){return}var l=m.typeahead.$menu;var i=k[0];var j=InputUtil.getCharacterCoords(i,d.start);var n=l.offset();l.css({top:n.top+j.top-i.offsetHeight+18,left:n.left+j.left})};f(document).ready(function(i){c=i("BODY").hasClass("jcms-mention-disabled")?false:true;e()})}(window.jQuery);