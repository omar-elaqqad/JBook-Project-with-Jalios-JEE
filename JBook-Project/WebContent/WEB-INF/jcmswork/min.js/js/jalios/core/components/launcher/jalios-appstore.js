(function(d,g,i,b){if(!d.jalios){d.jalios={}}if(!d.jalios.appstore){d.jalios.appstore={}}d.jalios.appstore.addTab=function(q,p){let counter=d(".application-default-chooser .application-nav-tab-item").length;let newTab=Handlebars.compile(d(".application-store-tab").html());let newTabHTML=newTab({counter:counter,tabName:q,tabNameML:JSON.stringify(p)});d(newTabHTML).insertAfter(d(".application-default-chooser .application-nav-tab-item").last());let newTabContent=Handlebars.compile(d(".application-store-tab-content").html());let newTabContentHTML=newTabContent({counter:counter});d(".application-default-chooser .tab-content").append(d(newTabContentHTML))};d.jalios.appstore.deleteTab=function(p){d(".application-nav-tab-item #application-tab_"+p).remove();d(".application-nav-tab-item #application-tab_"+p)};d.jalios.appstore.renameActiveTab=function(p){d(".app.app-appstore .application-default-chooser .application-nav-tab-item.active a").text(p)};const k=function(p){p.stopPropagation();p.preventDefault();d(p.currentTarget).find('[data-toggle="tooltip"]').tooltip("hide");let jsonObject=n(e());jsonObject.displayedApplication=d(p.currentTarget).closest(".card").data("jalios-data-id");d(p.currentTarget).closest(".card").refresh({params:jsonObject,callback:function(){g.history.replaceState(history.state,"","jcore/appstore/app/appStoreApp.jsp?displayedApplication="+jsonObject.displayedApplication)}})};const e=function(){var p=new FormData(d(".js-appstore-form").get(0));return p};const n=function(s){var q={};var r=s.entries(),p=r.next(),t;while(!p.done){t=p.value;q[t[0]]=t[1];p=r.next()}return q};const o="jcore/launcher/applicationLauncherActions.jsp";const a=function(p){let tabs=[];p.find(".nav-tabs .application-nav-tab-item > a").each(function(r,s){let tab={};let applications=[];tab.name=d(s).text().trim();let tabNameML=d(s).parent().data("jalios-tab-nameml");tab.nameML=tabNameML;let tabId=d(s).attr("href");p.find(tabId).find(".launcher-application-items .input-group").each(function(t,u){let application={};let shortcutId=d(u).find(":input.jalios-publication").val();if(shortcutId){application.shortcutId=shortcutId;applications[t]=application}});tab.applications=applications;tabs[r]=tab});var q=JSON.stringify({tabs:tabs});return q};const m=function(){l();j();if(d(".application-nav-tab-item").length<=1){d(".btn-tab-delete").addClass("hide")}d(i).on("click",".js-change-sort",function(p){let jsonObject=n(e());jsonObject.sortMode=d(p.currentTarget).data("jalios-appstore-sort");d(".js-appstore-form").refresh({params:jsonObject})});d(i).on("click",".application-hashtags .label",function(p){p.stopPropagation();p.preventDefault();let dataId=d(p.currentTarget).data("jalios-data-id");d(".app-sidebar-section-type INPUT[value="+dataId+"]").click()});d(i).on("keypress",".card-appstore-layout .card-title > A",function(p){if((p.key||p.which||(p.keyCode===32||p.keyCode===13))){k(p)}});d(i).on("click",".card-appstore-layout > .card",k);d(i).on("click",".btn-tab-add-validate",function(p){let tabNameML={};d(".js-tab-name-ml").each(function(q,r){let lang=d(r).attr("name");let value=d(r).val().trim();tabNameML[lang]=value});let siteLang=d("HTML").attr("lang");let tabName=tabNameML[siteLang];let defaultLang=d(".tab-main-site-lang").val();let defaultTabName=tabNameML[defaultLang];if(defaultTabName==null||defaultTabName==b||defaultTabName.trim()==""){d(".tab-langs-required-warning").removeClass("hide")}else{if(tabName==null||tabName==b||tabName.trim()==""){tabName=defaultTabName}d.jalios.appstore.addTab(tabName,tabNameML);d.jalios.ui.Modal.close(false)}f()});d(i).on("click",".btn-tab-rename-validate",function(p){let tabNameML={};d(".js-tab-name-ml").each(function(q,r){let lang=d(r).attr("name");let value=d(r).val().trim();tabNameML[lang]=value});let siteLang=d("HTML").attr("lang");let tabName=tabNameML[siteLang];let defaultLang=d(".tab-main-site-lang").val();let defaultTabName=tabNameML[defaultLang];if(defaultTabName==null||defaultTabName==b||defaultTabName.trim()==""){d(".tab-langs-required-warning").removeClass("hide")}else{let $activeTabLink=d(".app.app-appstore .application-default-chooser .application-nav-tab-item.active");$activeTabLink.data("jalios-tab-nameml",tabNameML);if(tabName==null||tabName==b||tabName.trim()==""){tabName=defaultTabName}$activeTabLink.find("a").first().text(tabName);d.jalios.ui.Modal.close(false)}});d(i).on("keypress","[data-jalios-appstore-action]",function(p){let $focused=d(":focus");if($focused.is("a")){p.stopPropagation();return false}if((p.key||p.which||(p.keyCode===32||p.keyCode===13))){c(p)}});d(i).on("click","[data-jalios-appstore-action]",c)};const c=function(p){let $link=d(p.currentTarget);let action=$link.data("jalios-appstore-action");let params=$link.data("jalios-appstore-action-params");let service=d.jalios.launcher.service.getInstance();p.stopPropagation();p.stopImmediatePropagation();switch(action){case"renameActiveTab":let $activeTabLink=$link.closest(".application-nav-tab-item");let tabNameML=$activeTabLink.data("jalios-tab-nameml");d.jalios.ui.Modal.open($link,{url:"jcore/appstore/app/modal/editTabModal.jsp?",params:{tabNameML:JSON.stringify(tabNameML)}});break;case"deleteActiveTab":d.jalios.ui.Modal.confirm(I18N.glp("msg.js.confirm"),function(q){let $activeTabLink=d(".app.app-appstore .application-default-chooser .application-nav-tab-item.active > a");if($activeTabLink.length==1){let tabId=$activeTabLink.attr("href");$activeTabLink.parent().remove();d(tabId).remove();if(toastr){toastr.options={positionClass:"toast-top-center"};toastr.info(d.jalios.appstore.i18n.tabDeleted)}d(".app.app-appstore .application-default-chooser .application-nav-tab-item").first().find("> a").click();f()}});break;case"addTab":d.jalios.ui.Modal.open($link,{url:"jcore/appstore/app/modal/addTabModal.jsp"});break;case"saveDefaultPreference":let json=a($link.closest(".application-default-chooser"));d.ajax({url:o,method:"post",data:{opSaveDefaultPreference:true,defaultPreferenceGroupId:$link.closest(".application-default-chooser").find(".departmentGroup").val(),defaultPreference:json},success:function(q){if(toastr){toastr.options={positionClass:"toast-top-center"};toastr.info(d.jalios.appstore.i18n.launcherSaved)}}});break;case"toggleApplicationInstall":let data={tabIndex:params.tabIndex,shortcutId:params.shortcutId};if($link.hasClass("is-installed")){service.removeApplication(data,function(){toastr.options={positionClass:"toast-top-center"};toastr.info(d.jalios.appstore.i18n.appRemovedFromTab)});$link.removeClass("is-installed");if($link.closest(".card").find(".appstore-add.is-installed").length===0){$link.closest(".card").removeClass("is-installed")}}else{service.addApplication(data,function(){toastr.options={positionClass:"toast-top-center"};toastr.info(d.jalios.appstore.i18n.appInstalledInTab)});$link.addClass("is-installed");$link.closest(".card").addClass("is-installed")}break;case"uninstallApplication":let data2={shortcutId:params.shortcutId};service.removeApplicationOnAllTabs(data2,function(){$link.closest(".card").find(".appstore-add.is-installed").removeClass("is-installed");$link.closest(".card").removeClass("is-installed");toastr.options={positionClass:"toast-top-center"};toastr.info(d.jalios.appstore.i18n.appRemovedFromAllTabs)});break;default:break}};const f=function(){if(d(".application-nav-tab-item").length<=1){d(".btn-tab-delete").addClass("hide")}else{d(".btn-tab-delete").removeClass("hide")}};const h=function(p){if(p.refresh.type==="after"){let $target=d(p.refresh.target);if($target.hasClass("appstore")||$target.hasClass("app-store-default-setup")){l();j();f()}}if(p.refresh.type==="before"){let $target=d(p.refresh.target);if($target.hasClass("appstore")||$target.hasClass("app-store-default-setup")){if(!p.refresh.options.params.sortMode){p.refresh.options.params.sortMode=d(".js-change-sort:checked").val()}}}};const l=function(){d('[data-toggle="tooltip"]').tooltip({container:"body"})};const j=function(){let $navTabs=d(".application-default-chooser .nav-tabs");if($navTabs.length>0){$navTabs.sortable({delay:150,items:".application-nav-tab-item",tolerance:"pointer",forceHelperSize:true,helper:"clone",containment:$navTabs,cursorAt:{left:30,top:24}})}};d(i).ready(function(){m();d(i).on("jalios:refresh",h)})})(jQuery,window,document);