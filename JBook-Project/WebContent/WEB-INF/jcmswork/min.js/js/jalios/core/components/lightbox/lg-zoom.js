!(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?(module.exports=b()):"function"==typeof define&&define.amd?define(b):((a="undefined"!=typeof globalThis?globalThis:a||self).lgJPlatformZoom=b())})(this,function(){var u=function(){return(u=Object.assign||function(c){for(var l,n=1,a=arguments.length;n<a;n++){for(var g in (l=arguments[n])){Object.prototype.hasOwnProperty.call(l,g)&&(c[g]=l[g])}}return c}).apply(this,arguments)},m={scale:1,zoom:!0,actualSize:!0,showZoomInOutIcons:!1,actualSizeIcons:{zoomIn:"lg-zoom-in",zoomOut:"lg-zoom-out"},enableZoomAfter:300,zoomPluginStrings:{zoomIn:"Zoom in",zoomOut:"Zoom out",viewActualSize:"View actual size"}},d="lgContainerResize",j="lgBeforeOpen",v="lgAfterOpen",q="lgSlideItemLoad",b="lgAfterSlide",f="lgRotateLeft",h="lgRotateRight",k="lgFlipHorizontal",p="lgFlipVertical";return(function(){function a(e,c){return(this.core=e),(this.$LG=c),(this.settings=u(u({},m),this.core.settings)),this}return((a.prototype.buildTemplates=function(){var c=this.settings.showZoomInOutIcons?'<button id="'+this.core.getIdName("lg-zoom-in")+'" type="button" aria-label="'+this.settings.zoomPluginStrings.zoomIn+'" class="lg-zoom-in lg-icon"></button><button id="'+this.core.getIdName("lg-zoom-out")+'" type="button" aria-label="'+this.settings.zoomPluginStrings.zoomIn+'" class="lg-zoom-out lg-icon"></button>':"";this.settings.actualSize&&(c+='<button id="'+this.core.getIdName("lg-actual-size")+'" type="button" aria-label="'+this.settings.zoomPluginStrings.viewActualSize+'" class="'+this.settings.actualSizeIcons.zoomIn+' lg-icon"></button>'),this.core.outer.addClass("lg-use-transition-for-zoom"),this.core.$toolbar.first().append(c)}),(a.prototype.enableZoom=function(c){var g=this,i=this.settings.enableZoomAfter+c.detail.delay;this.$LG("body").first().hasClass("lg-from-hash")&&c.detail.delay?(i=0):this.$LG("body").first().removeClass("lg-from-hash"),(this.zoomableTimeout=setTimeout(function(){g.isImageSlide()&&(g.core.getSlideItem(c.detail.index).addClass("lg-zoomable"),c.detail.index===g.core.index&&g.setZoomEssentials())},i+30))}),(a.prototype.enableZoomOnSlideItemLoad=function(){this.core.LGel.on(q+".zoom",this.enableZoom.bind(this))}),(a.prototype.getModifier=function(D,B,w){var z=D;D=Math.abs(D);var E=this.getCurrentTransform(w);if(!E){return 1}var C=1;if("X"===B){var c=Math.sign(parseFloat(E[0]));0===D||180===D?(C=1):90===D&&(C=(-90===z&&1===c)||(90===z&&-1===c)?-1:1),(C*=c)}else{var x=Math.sign(parseFloat(E[3]));if(0===D||180===D){C=1}else{if(90===D){var y=parseFloat(E[1]),A=parseFloat(E[2]);C=Math.sign(y*A*z*x)}}C*=x}return C}),(a.prototype.getImageSize=function(c,g,i){return 90===Math.abs(g)&&(i="x"===i?"y":"x"),c[{y:"offsetHeight",x:"offsetWidth"}[i]]}),(a.prototype.getDragCords=function(c,g){return 90===g?{x:c.pageY,y:c.pageX}:{x:c.pageX,y:c.pageY}}),(a.prototype.getSwipeCords=function(g,l){var n=g.targetTouches[0].pageX,c=g.targetTouches[0].pageY;return 90===l?{x:c,y:n}:{x:n,y:c}}),(a.prototype.getDragAllowedAxises=function(g,l){l=l||this.scale||1;var n=this.imageYSize*l>this.containerRect.height,c=this.imageXSize*l>this.containerRect.width;return 90===g?{allowX:n,allowY:c}:{allowX:c,allowY:n}}),(a.prototype.getCurrentTransform=function(c){if(c){var g=window.getComputedStyle(c,null),i=g.getPropertyValue("-webkit-transform")||g.getPropertyValue("-moz-transform")||g.getPropertyValue("-ms-transform")||g.getPropertyValue("-o-transform")||g.getPropertyValue("transform")||"none";return"none"!==i?i.split("(")[1].split(")")[0].split(","):void 0}}),(a.prototype.getCurrentRotation=function(c){if(!c){return 0}var g=this.getCurrentTransform(c);return g?Math.round(Math.atan2(parseFloat(g[1]),parseFloat(g[0]))*(180/Math.PI)):0}),(a.prototype.setZoomEssentials=function(){var c=this.core.getSlideItem(this.core.index).find(".lg-image").first(),g=this.core.getSlideItem(this.core.index).find(".lg-img-rotate").first().get();(this.rotateValue=this.getCurrentRotation(g)),(this.imageYSize=this.getImageSize(c.get(),this.rotateValue,"y")),(this.imageXSize=this.getImageSize(c.get(),this.rotateValue,"x")),(this.containerRect=this.core.outer.get().getBoundingClientRect()),(this.modifierX=this.getModifier(this.rotateValue,"X",g)),(this.modifierY=this.getModifier(this.rotateValue,"Y",g))}),(a.prototype.zoomImage=function(J){var E,x,B=(this.containerRect.width-this.imageXSize)/2+this.containerRect.left,K=this.core.mediaContainerPosition,H=K.top,w=K.bottom,y=Math.abs(H-w)/2,A=(this.containerRect.height-this.imageYSize-y*this.modifierX)/2+this.scrollTop+this.containerRect.top;1===J&&(this.positionChanged=!1);var D=this.getDragAllowedAxises(Math.abs(this.rotateValue),J),G=D.allowY,C=D.allowX;this.positionChanged&&((E=this.left/(this.scale-1)),(x=this.top/(this.scale-1)),(this.pageX=Math.abs(E)+B),(this.pageY=Math.abs(x)+A),(this.positionChanged=!1));var z=this.getPossibleSwipeDragCords(this.rotateValue,J),I=(J-1)*(B-this.pageX),F=(J-1)*(A-this.pageY);C?this.isBeyondPossibleLeft(I,z.minX)?(I=z.minX):this.isBeyondPossibleRight(I,z.maxX)&&(I=z.maxX):J>1&&(I<z.minX?(I=z.minX):I>z.maxX&&(I=z.maxX)),G?this.isBeyondPossibleTop(F,z.minY)?(F=z.minY):this.isBeyondPossibleBottom(F,z.maxY)&&(F=z.maxY):J>1&&(F<z.minY?(F=z.minY):F>z.maxY&&(F=z.maxY)),this.setZoomStyles({x:I,y:F,scale:J})}),(a.prototype.setZoomStyles=function(g){var n=this.core.getSlideItem(this.core.index).find(".lg-image").first(),r=this.core.outer.find(".lg-current .lg-dummy-img").first(),c=n.parent();(this.scale=g.scale),n.css("transform","scale3d("+g.scale+", "+g.scale+", 1)"),r.css("transform","scale3d("+g.scale+", "+g.scale+", 1)");var l="translate3d("+g.x+"px, "+g.y+"px, 0)";c.css("transform",l),(this.left=g.x),(this.top=g.y)}),(a.prototype.setActualSize=function(g,l){var n=this;if(this.isImageSlide()&&!this.core.outer.hasClass("lg-first-slide-loading")){var c=this.getCurrentImageActualSizeScale();this.core.outer.hasClass("lg-zoomed")?(this.scale=1):(this.scale=this.getScale(c)),this.setPageCords(l),this.beginZoom(this.scale),this.zoomImage(this.scale),setTimeout(function(){n.core.outer.removeClass("lg-grabbing").addClass("lg-grab")},10)}}),(a.prototype.getNaturalWidth=function(c){var g=this.core.getSlideItem(c).find(".lg-image").first(),i=this.core.galleryItems[c].width;return i?parseFloat(i):g.get().naturalWidth}),(a.prototype.getActualSizeScale=function(c,g){return c>g?c/g||2:1}),(a.prototype.getCurrentImageActualSizeScale=function(){var c=this.core.getSlideItem(this.core.index).find(".lg-image").first().get().offsetWidth,g=this.getNaturalWidth(this.core.index)||c;let actualSize=this.getActualSizeScale(g,c);return actualSize===1?2:actualSize}),(a.prototype.getPageCords=function(c){var g={};if(c){(g.x=c.pageX||c.targetTouches[0].pageX),(g.y=c.pageY||c.targetTouches[0].pageY)}else{var i=this.core.outer.get().getBoundingClientRect();(g.x=i.width/2+i.left),(g.y=i.height/2+this.scrollTop+i.top)}return g}),(a.prototype.setPageCords=function(c){var g=this.getPageCords(c);(this.pageX=g.x),(this.pageY=g.y)}),(a.prototype.beginZoom=function(c){(this.core.outer.removeClass("lg-zoom-drag-transition lg-zoom-dragging"),c>1)?(this.core.outer.addClass("lg-zoomed"),this.core.getElementById("lg-actual-size").removeClass(this.settings.actualSizeIcons.zoomIn).addClass(this.settings.actualSizeIcons.zoomOut)):this.resetZoom();return c>1}),(a.prototype.getScale=function(c){var g=this.getCurrentImageActualSizeScale();return c<1?(c=1):c>g&&(c=g),c}),(a.prototype.init=function(){var c=this;if(this.settings.zoom){this.buildTemplates(),this.enableZoomOnSlideItemLoad();var g=null;this.core.outer.on("dblclick.lg",function(i){c.$LG(i.target).hasClass("lg-image")&&c.setActualSize(c.core.index,i)}),this.core.outer.on("touchstart.lg",function(l){var e=c.$LG(l.target);1===l.targetTouches.length&&e.hasClass("lg-image")&&(g?(clearTimeout(g),(g=null),l.preventDefault(),c.setActualSize(c.core.index,l)):(g=setTimeout(function(){g=null},300)))}),this.core.LGel.on(d+".zoom "+h+".zoom "+f+".zoom "+k+".zoom "+p+".zoom",function(){c.core.lgOpened&&c.isImageSlide()&&(c.setPageCords(),c.setZoomEssentials(),c.zoomImage(c.scale))}),this.$LG(window).on("scroll.lg.zoom.global"+this.core.lgId,function(){c.core.lgOpened&&(c.scrollTop=c.$LG(window).scrollTop())}),this.core.getElementById("lg-zoom-out").on("click.lg",function(){c.core.outer.find(".lg-current .lg-image").get()&&((c.scale-=c.settings.scale),(c.scale=c.getScale(c.scale)),c.beginZoom(c.scale),c.zoomImage(c.scale))}),this.core.getElementById("lg-zoom-in").on("click.lg",function(){c.zoomIn()}),this.core.getElementById("lg-actual-size").on("click.lg",function(){c.setActualSize(c.core.index)}),this.core.LGel.on(j+".zoom",function(){c.core.outer.find(".lg-item").removeClass("lg-zoomable")}),this.core.LGel.on(v+".zoom",function(){(c.scrollTop=c.$LG(window).scrollTop()),(c.pageX=c.core.outer.width()/2),(c.pageY=c.core.outer.height()/2+c.scrollTop),(c.scale=1)}),this.core.LGel.on(b+".zoom",function(i){var l=i.detail.prevIndex;(c.scale=1),(c.positionChanged=!1),c.resetZoom(l),c.isImageSlide()&&c.setZoomEssentials()}),this.zoomDrag(),this.pinchZoom(),this.zoomSwipe(),(this.zoomableTimeout=!1),(this.positionChanged=!1)}}),(a.prototype.zoomIn=function(c){this.isImageSlide()&&(c?(this.scale=c):(this.scale+=this.settings.scale),(this.scale=this.getScale(this.scale)),this.beginZoom(this.scale),this.zoomImage(this.scale))}),(a.prototype.resetZoom=function(c){this.core.outer.removeClass("lg-zoomed lg-zoom-drag-transition");var g=this.core.getElementById("lg-actual-size"),i=this.core.getSlideItem(void 0!==c?c:this.core.index);g.removeClass(this.settings.actualSizeIcons.zoomOut).addClass(this.settings.actualSizeIcons.zoomIn),i.find(".lg-img-wrap").first().removeAttr("style"),i.find(".lg-image").first().removeAttr("style"),(this.scale=1),(this.left=0),(this.top=0),this.setPageCords()}),(a.prototype.getTouchDistance=function(c){return Math.sqrt((c.targetTouches[0].pageX-c.targetTouches[1].pageX)*(c.targetTouches[0].pageX-c.targetTouches[1].pageX)+(c.targetTouches[0].pageY-c.targetTouches[1].pageY)*(c.targetTouches[0].pageY-c.targetTouches[1].pageY))}),(a.prototype.pinchZoom=function(){var g=this,n=0,r=!1,c=1,l=this.core.getSlideItem(this.core.index);this.core.$inner.on("touchstart.lg",function(e){(l=g.core.getSlideItem(g.core.index)),g.isImageSlide()&&(2!==e.targetTouches.length||g.core.outer.hasClass("lg-first-slide-loading")||(!g.$LG(e.target).hasClass("lg-item")&&!l.get().contains(e.target))||((c=g.scale||1),g.core.outer.removeClass("lg-zoom-drag-transition lg-zoom-dragging"),(g.core.touchAction="pinch"),(n=g.getTouchDistance(e))))}),this.core.$inner.on("touchmove.lg",function(e){if(2===e.targetTouches.length&&"pinch"===g.core.touchAction&&(g.$LG(e.target).hasClass("lg-item")||l.get().contains(e.target))){e.preventDefault();var i=g.getTouchDistance(e),o=n-i;!r&&Math.abs(o)>5&&(r=!0),r&&((g.scale=Math.max(1,c+0.008*-o)),g.zoomImage(g.scale))}}),this.core.$inner.on("touchend.lg",function(e){"pinch"===g.core.touchAction&&(g.$LG(e.target).hasClass("lg-item")||l.get().contains(e.target))&&((r=!1),(n=0),g.scale<=1?g.resetZoom():((g.scale=g.getScale(g.scale)),g.zoomImage(g.scale),g.core.outer.addClass("lg-zoomed")),(g.core.touchAction=void 0))})}),(a.prototype.touchendZoom=function(H,E,x,B,I,G){var w=E.x-H.x,y=E.y-H.y,A=Math.abs(w)/I+1,D=Math.abs(y)/I+1;A>2&&(A+=1),D>2&&(D+=1),(w*=A),(y*=D);var F=this.core.getSlideItem(this.core.index).find(".lg-img-wrap").first(),C={};(C.x=this.left+w*this.modifierX),(C.y=this.top+y*this.modifierY);var z=this.getPossibleSwipeDragCords(G);(Math.abs(w)>15||Math.abs(y)>15)&&(B&&(this.isBeyondPossibleTop(C.y,z.minY)?(C.y=z.minY):this.isBeyondPossibleBottom(C.y,z.maxY)&&(C.y=z.maxY)),x&&(this.isBeyondPossibleLeft(C.x,z.minX)?(C.x=z.minX):this.isBeyondPossibleRight(C.x,z.maxX)&&(C.x=z.maxX)),B?(this.top=C.y):(C.y=this.top),x?(this.left=C.x):(C.x=this.left),this.setZoomSwipeStyles(F,C),(this.positionChanged=!0))}),(a.prototype.getZoomSwipeCords=function(D,B,w,z,E){var C={};if(z){if(((C.y=this.top+(B.y-D.y)*this.modifierY),this.isBeyondPossibleTop(C.y,E.minY))){var c=E.minY-C.y;C.y=E.minY-c/6}else{if(this.isBeyondPossibleBottom(C.y,E.maxY)){var x=C.y-E.maxY;C.y=E.maxY+x/6}}}else{C.y=this.top}if(w){if(((C.x=this.left+(B.x-D.x)*this.modifierX),this.isBeyondPossibleLeft(C.x,E.minX))){var y=E.minX-C.x;C.x=E.minX-y/6}else{if(this.isBeyondPossibleRight(C.x,E.maxX)){var A=C.x-E.maxX;C.x=E.maxX+A/6}}}else{C.x=this.left}return C}),(a.prototype.isBeyondPossibleLeft=function(c,g){return c>=g}),(a.prototype.isBeyondPossibleRight=function(c,g){return c<=g}),(a.prototype.isBeyondPossibleTop=function(c,g){return c>=g}),(a.prototype.isBeyondPossibleBottom=function(c,g){return c<=g}),(a.prototype.isImageSlide=function(){var c=this.core.galleryItems[this.core.index];return"image"===this.core.getSlideType(c)}),(a.prototype.getPossibleSwipeDragCords=function(H,E){var x=E||this.scale||1,B=Math.abs(x),I=this.core.mediaContainerPosition,G=I.top,w=I.bottom,y=Math.abs(G-w)/2,A=(this.imageYSize-this.containerRect.height)/2+y*this.modifierX,D=this.containerRect.height-this.imageYSize*B+A,F=(this.imageXSize-this.containerRect.width)/2,C=this.containerRect.width-this.imageXSize*B+F,z={minY:A,maxY:D,minX:F,maxX:C};return 90===Math.abs(H)&&(z={minY:F,maxY:C,minX:A,maxX:D}),z}),(a.prototype.setZoomSwipeStyles=function(c,g){c.css("transform","translate3d("+g.x+"px, "+g.y+"px, 0)")}),(a.prototype.zoomSwipe=function(){var D,B,w=this,z={},E={},C=!1,c=!1,x=!1,y=new Date(),A=(new Date(),this.core.getSlideItem(this.core.index));this.core.$inner.on("touchstart.lg",function(g){if(w.isImageSlide()&&((A=w.core.getSlideItem(w.core.index)),(w.$LG(g.target).hasClass("lg-item")||A.get().contains(g.target))&&1===g.targetTouches.length&&w.core.outer.hasClass("lg-zoomed"))){g.preventDefault(),(y=new Date()),(w.core.touchAction="zoomSwipe"),(B=w.core.getSlideItem(w.core.index).find(".lg-img-wrap").first());var e=w.getDragAllowedAxises(Math.abs(w.rotateValue));(x=e.allowY),((c=e.allowX)||x)&&(z=w.getSwipeCords(g,Math.abs(w.rotateValue))),(D=w.getPossibleSwipeDragCords(w.rotateValue)),w.core.outer.addClass("lg-zoom-dragging lg-zoom-drag-transition")}}),this.core.$inner.on("touchmove.lg",function(e){if(1===e.targetTouches.length&&"zoomSwipe"===w.core.touchAction&&(w.$LG(e.target).hasClass("lg-item")||A.get().contains(e.target))){e.preventDefault(),(w.core.touchAction="zoomSwipe"),(E=w.getSwipeCords(e,Math.abs(w.rotateValue)));var g=w.getZoomSwipeCords(z,E,c,x,D);(Math.abs(E.x-z.x)>15||Math.abs(E.y-z.y)>15)&&((C=!0),w.setZoomSwipeStyles(B,g))}}),this.core.$inner.on("touchend.lg",function(g){if("zoomSwipe"===w.core.touchAction&&(w.$LG(g.target).hasClass("lg-item")||A.get().contains(g.target))){if(((w.core.touchAction=void 0),w.core.outer.removeClass("lg-zoom-dragging"),!C)){return}C=!1;var i=new Date().valueOf()-y.valueOf();w.touchendZoom(z,E,c,x,i,w.rotateValue)}})}),(a.prototype.zoomDrag=function(){var F,C,x,A,G=this,E={},w={},y=!1,z=!1,B=!1,D=!1;this.core.outer.on("mousedown.lg.zoom",function(i){if(G.isImageSlide()){var g=G.core.getSlideItem(G.core.index);if(G.$LG(i.target).hasClass("lg-item")||g.get().contains(i.target)){(F=new Date()),(A=G.core.getSlideItem(G.core.index).find(".lg-img-wrap").first());var c=G.getDragAllowedAxises(Math.abs(G.rotateValue));(D=c.allowY),(B=c.allowX),G.core.outer.hasClass("lg-zoomed")&&G.$LG(i.target).hasClass("lg-object")&&(B||D)&&(i.preventDefault(),(E=G.getDragCords(i,Math.abs(G.rotateValue))),(x=G.getPossibleSwipeDragCords(G.rotateValue)),(y=!0),(G.core.outer.get().scrollLeft+=1),(G.core.outer.get().scrollLeft-=1),G.core.outer.removeClass("lg-grab").addClass("lg-grabbing lg-zoom-drag-transition lg-zoom-dragging"))}}}),this.$LG(window).on("mousemove.lg.zoom.global"+this.core.lgId,function(c){if(y){(z=!0),(w=G.getDragCords(c,Math.abs(G.rotateValue)));var g=G.getZoomSwipeCords(E,w,B,D,x);G.setZoomSwipeStyles(A,g)}}),this.$LG(window).on("mouseup.lg.zoom.global"+this.core.lgId,function(e){if(y){if(((C=new Date()),(y=!1),G.core.outer.removeClass("lg-zoom-dragging"),z&&(E.x!==w.x||E.y!==w.y))){w=G.getDragCords(e,Math.abs(G.rotateValue));var c=C.valueOf()-F.valueOf();G.touchendZoom(E,w,B,D,c,G.rotateValue)}z=!1}G.core.outer.removeClass("lg-grabbing").addClass("lg-grab")})}),(a.prototype.closeGallery=function(){this.resetZoom()}),(a.prototype.destroy=function(){this.$LG(window).off(".lg.zoom.global"+this.core.lgId),this.core.LGel.off(".lg.zoom"),this.core.LGel.off(".zoom"),clearTimeout(this.zoomableTimeout),(this.zoomableTimeout=!1)}),a)})()});