(function(){var r=function(O){var P=O;var N=function(){return P};var Q=function(R){P=R};return{get:N,set:Q}};var a=tinymce.util.Tools.resolve("tinymce.PluginManager");var L=function(N){if(N.hasPlugin("tinymcespellchecker",true)){return true}else{return false}};var e=Object.hasOwnProperty;var m=function(O){for(var N in O){if(e.call(O,N)){return false}}return true};var F=tinymce.util.Tools.resolve("tinymce.util.Tools");var E=tinymce.util.Tools.resolve("tinymce.util.URI");var D=tinymce.util.Tools.resolve("tinymce.util.XHR");var H=function(N){return N.fire("SpellcheckStart")};var A=function(N){return N.fire("SpellcheckEnd")};var z=function(O){var N="English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";return O.getParam("spellchecker_languages",N)};var j=function(N){var O=jQuery(N.getElement()).attr("xml:lang")||N.getParam("language","en");return N.getParam("spellchecker_language",O)};var f=function(N){return N.getParam("spellchecker_rpc_url")};var B=function(N){return N.getParam("spellchecker_callback")};var G=function(O){var N=new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\xA7\xA9\xAB\xAE\xB1\xB6\xB7\xB8\xBB\xBC\xBD\xBE\xBF\xD7\xF7\xA4\u201D\u201C\u201E\xA0\u2002\u2003\u2009]+',"g");return O.getParam("spellchecker_wordchar_pattern",N)};function q(N){return N&&N.nodeType===1&&N.contentEditable==="false"}var K=function(ah,S){var ag,Q=[];var al=S.dom;var ad=S.schema.getBlockElements();var Y=S.schema.getWhiteSpaceElements();var aj=S.schema.getShortEndedElements();function ak(ap,aq){if(!ap[0]){throw new Error("findAndReplaceDOMText cannot handle zero-length matches")}return{start:ap.index,end:ap.index+ap[0].length,text:ap[0],data:aq}}function N(aq){var ap;if(aq.nodeType===3){return aq.data}if(Y[aq.nodeName]&&!ad[aq.nodeName]){return""}if(q(aq)){return"\n"}ap="";if(ad[aq.nodeName]||aj[aq.nodeName]){ap+="\n"}if(aq=aq.firstChild){do{ap+=N(aq)}while(aq=aq.nextSibling)}return ap}function am(at,av,az){var aq,ay,aw,ar,aA=[],ax=0,au=at,ap,aB=0;av=av.slice(0);av.sort(function(aD,aC){return aD.start-aC.start});ap=av.shift();out:while(true){if(ad[au.nodeName]||aj[au.nodeName]||q(au)){ax++}if(au.nodeType===3){if(!ay&&au.length+ax>=ap.end){ay=au;ar=ap.end-ax}else{if(aq){aA.push(au)}}if(!aq&&au.length+ax>ap.start){aq=au;aw=ap.start-ax}ax+=au.length}if(aq&&ay){au=az({startNode:aq,startNodeIndex:aw,endNode:ay,endNodeIndex:ar,innerNodes:aA,match:ap.text,matchIndex:aB});ax-=ay.length-ar;aq=null;ay=null;aA=[];ap=av.shift();aB++;if(!ap){break}}else{if((!Y[au.nodeName]||ad[au.nodeName])&&au.firstChild){if(!q(au)){au=au.firstChild;continue}}else{if(au.nextSibling){au=au.nextSibling;continue}}}while(true){if(au.nextSibling){au=au.nextSibling;break}else{if(au.parentNode!==at){au=au.parentNode}else{break out}}}}}function aa(aq){function ap(au,ar){var at=Q[ar];if(!at.stencil){at.stencil=aq(at)}var av=at.stencil.cloneNode(false);av.setAttribute("data-mce-index",ar);if(au){av.appendChild(al.doc.createTextNode(au))}return av}return function(ax){var aE;var ar;var ay;var au=ax.startNode;var aA=ax.endNode;var aF=ax.matchIndex;var aG=al.doc;if(au===aA){var aD=au;ay=aD.parentNode;if(ax.startNodeIndex>0){aE=aG.createTextNode(aD.data.substring(0,ax.startNodeIndex));ay.insertBefore(aE,aD)}var at=ap(ax.match,aF);ay.insertBefore(at,aD);if(ax.endNodeIndex<aD.length){ar=aG.createTextNode(aD.data.substring(ax.endNodeIndex));ay.insertBefore(ar,aD)}aD.parentNode.removeChild(aD);return at}aE=aG.createTextNode(au.data.substring(0,ax.startNodeIndex));ar=aG.createTextNode(aA.data.substring(ax.endNodeIndex));var aB=ap(au.data.substring(ax.startNodeIndex),aF);for(var aw=0,av=ax.innerNodes.length;aw<av;++aw){var aH=ax.innerNodes[aw];var aC=ap(aH.data,aF);aH.parentNode.replaceChild(aC,aH)}var az=ap(aA.data.substring(0,ax.endNodeIndex),aF);ay=au.parentNode;ay.insertBefore(aE,au);ay.insertBefore(aB,au);ay.removeChild(au);ay=aA.parentNode;ay.insertBefore(az,aA);ay.insertBefore(ar,aA);ay.removeChild(aA);return az}}function T(aq){var ap=aq.parentNode;while(aq.childNodes.length>0){ap.insertBefore(aq.childNodes[0],aq)}ap.removeChild(aq)}function O(ap){return ap.className.indexOf("mce-spellchecker-word")!==-1}function ai(ap){var av=ah.getElementsByTagName("*"),au=[];ap=typeof ap==="number"?""+ap:null;for(var at=0;at<av.length;at++){var ar=av[at],aq=ar.getAttribute("data-mce-index");if(aq!==null&&aq.length&&O(ar)){if(aq===ap||ap===null){au.push(ar)}}}return au}function P(ap){var aq=Q.length;while(aq--){if(Q[aq]===ap){return aq}}return -1}function W(aq){var ap=[];R(function(ar,at){if(aq(ar,at)){ap.push(ar)}});Q=ap;return this}function R(ar){for(var aq=0,ap=Q.length;aq<ap;aq++){if(ar(Q[aq],aq)===false){break}}return this}function V(ap){if(Q.length){am(ah,Q,aa(ap))}return this}function ac(ap,aq){if(X&&ap.global){while(ag=ap.exec(X)){Q.push(ak(ag,aq))}}return this}function af(ap){var aq;var ar=ai(ap?P(ap):null);aq=ar.length;while(aq--){T(ar[aq])}return this}function ae(ap){return Q[ap.getAttribute("data-mce-index")]}function Z(ap){return ai(P(ap))[0]}function ab(ar,ap,aq){Q.push({start:ar,end:ar+ap,text:X.substr(ar,ap),data:aq});return this}function U(aq){var ar=ai(P(aq));var ap=S.dom.createRng();ap.setStartBefore(ar[0]);ap.setEndAfter(ar[ar.length-1]);return ap}function an(aq,ar){var ap=U(aq);ap.deleteContents();if(ar.length>0){ap.insertNode(S.dom.doc.createTextNode(ar))}return ap}function ao(){Q.splice(0,Q.length);af();return this}var X=N(ah);return{text:X,matches:Q,each:R,filter:W,reset:ao,matchFromElement:ae,elementFromMatch:Z,find:ac,add:ab,wrap:V,unwrap:af,replace:an,rangeFromMatch:U,indexOf:P}};var h=function(O,N){if(!N.get()){var P=K(O.getBody(),O);N.set(P)}return N.get()};var v=function(P,O,N){return function(V,U,R,S){var T={method:V,lang:N.get()};var Q="";T[V==="addToDictionary"?"word":"text"]=U;F.each(T,function(X,W){if(Q){Q+="&"}Q+=W+"="+encodeURIComponent(X)});D.send({url:new E(O).toAbsolute(f(P)),type:"post",content_type:"application/x-www-form-urlencoded",data:Q,success:function(W){var Y=JSON.parse(W);if(!Y){var X=P.translate("Server response wasn't proper JSON.");S(X)}else{if(Y.error){S(Y.error)}else{R(Y)}}},error:function(){var W=P.translate("The spelling service was not found: (")+f(P)+P.translate(")");S(W)}})}};var w=function(S,R,T,N,P,O,Q){S.focus(false);var V=B(S);var U=V?V:v(S,R,T);U.call(S.plugins.jspellchecker,N,P,O,Q)};var M=function(T,S,U,R,O,Q){if(k(T,U,R)){return}var P=function(V){T.notificationManager.open({text:V,type:"error"});T.setProgressState(false);k(T,U,R)};var N=function(V){b(T,U,R,O,V)};T.setProgressState(true);w(T,S,Q,"spellcheck",h(T,R).text,N,P);T.focus()};var C=function(O,P,N){if(!O.dom.select("span.mce-spellchecker-word").length){k(O,P,N)}};var i=function(R,Q,S,O,N,T,P){R.setProgressState(true);w(R,Q,N,"addToDictionary",T,function(){R.setProgressState(false);R.dom.remove(P,true);C(R,S,O)},function(U){R.notificationManager.open({text:U,type:"error"});R.setProgressState(false)})};var n=function(Q,R,N,S,O,P){Q.selection.collapse();if(P){F.each(Q.dom.select("span.mce-spellchecker-word"),function(T){if(T.getAttribute("data-mce-word")===S){Q.dom.remove(T,true)}})}else{Q.dom.remove(O,true)}C(Q,R,N)};var k=function(P,Q,N){var O=P.selection.getBookmark();h(P,N).reset();P.selection.moveToBookmark(O);N.set(null);if(Q.get()){Q.set(false);A(P);return true}};var x=function(O){var N=O.getAttribute("data-mce-index");if(typeof N==="number"){return""+N}return N};var c=function(R,O){var Q=[];var N=F.toArray(R.getBody().getElementsByTagName("span"));if(N.length){for(var P=0;P<N.length;P++){var S=x(N[P]);if(S===null||!S.length){continue}if(S===O.toString()){Q.push(N[P])}}}return Q};var b=function(R,O,N,U,Q){var P=!!Q.dictionary;var S=Q.words;R.setProgressState(false);if(m(S)){var V=R.translate("No misspellings found.");R.notificationManager.open({text:V,type:"info"});O.set(false);return}U.set({suggestions:S,hasDictionarySupport:P});var T=R.selection.getBookmark();h(R,N).find(G(R)).filter(function(W){return !!S[W.text]}).wrap(function(W){return R.dom.create("span",{"class":"mce-spellchecker-word","aria-invalid":"spelling","data-mce-bogus":1,"data-mce-word":W.text})});R.selection.moveToBookmark(T);O.set(true);H(R)};var J=function(S,O,W,N,U,P){var V=function(){return U.get()};var R=function(){return G(S)};var T=function(X){b(S,O,N,W,X)};var Q=function(){return N.get()};return{getTextMatcher:Q,getWordCharPattern:R,markErrors:T,getLanguage:V}};var g=function(R,Q,S,P,N,O){R.addCommand("mceSpellCheck",function(){M(R,Q,S,P,N,O)})};var t=function(){N=Object.assign||function N(P){for(var Q,O=1,S=arguments.length;O<S;O++){Q=arguments[O];for(var R in Q){if(Object.prototype.hasOwnProperty.call(Q,R)){P[R]=Q[R]}}}return P};return N.apply(this,arguments)};var o="SpellcheckStart SpellcheckEnd";var s=function(P,N){var O=[];F.each(N,function(Q){O.push({selectable:true,text:Q.name,data:Q.value})});return O};var l=function(N){return F.map(z(N).split(","),function(P){var O=P.split("=");return{name:O[0],value:O[1]}})};var u=function(S,Q,O,N,U,W){var T=s("Language",l(S));var V=function(){M(S,Q,O,N,W,U)};var R={tooltip:"Spellcheck",onAction:V,icon:"spell-check",onSetup:function(X){var Y=function(){X.setActive(O.get())};S.on(o,Y);return function(){S.off(o,Y)}}};var P=t(t({},R),{type:"splitbutton",select:function(X){return X===U.get()},fetch:function(Y){var X=F.map(T,function(Z){return{type:"choiceitem",value:Z.data,text:Z.text}});Y(X)},onItemAction:function(X,Y){U.set(Y)}});if(T.length>1){S.ui.registry.addSplitButton("jspellchecker",P)}else{S.ui.registry.addToggleButton("jspellchecker",R)}S.ui.registry.addToggleMenuItem("jspellchecker",{text:"Spellcheck",icon:"spell-check",onSetup:function(X){X.setActive(O.get());var Y=function(){X.setActive(O.get())};S.on(o,Y);return function(){S.off(o,Y)}},onAction:V})};var y=true;var I=function(T,R,X,P,O,W,N,U){var V=[];var S=X.get().suggestions[N];F.each(S,function(Y){V.push({text:Y,onAction:function(){T.insertContent(T.dom.encode(Y));T.dom.remove(U);C(T,P,O)}})});var Q=X.get().hasDictionarySupport;if(Q){V.push({type:"separator"});V.push({text:"Add to dictionary",onAction:function(){i(T,R,P,O,W,N,U)}})}V.push.apply(V,[{type:"separator"},{text:"Ignore",onAction:function(){n(T,P,O,N,U)}},{text:"Ignore all",onAction:function(){n(T,P,O,N,U,y)}}]);return V};var d=function(R,Q,N,S,P,O){var T=function(W){var X=W;if(X.className==="mce-spellchecker-word"){var V=c(R,x(X));if(V.length>0){var U=R.dom.createRng();U.setStartBefore(V[0]);U.setEndAfter(V[V.length-1]);R.selection.setRng(U);return I(R,Q,N,S,P,O,X.getAttribute("data-mce-word"),V)}}else{return[]}};R.ui.registry.addContextMenu("spellchecker",{update:T})};function p(){a.add("jspellchecker",function(R,Q){if(L(R)===false){var S=r(false);var P=r(j(R));var O=r(null);var N=r(null);u(R,Q,S,O,P,N);d(R,Q,N,S,O,P);g(R,Q,S,O,N,P);return J(R,S,N,O,P)}})}p()}());