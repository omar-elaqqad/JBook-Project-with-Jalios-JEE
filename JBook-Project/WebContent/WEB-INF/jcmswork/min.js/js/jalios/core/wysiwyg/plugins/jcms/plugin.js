!function(a){tinymce.PluginManager.add("jcms",function(g,d){var l=[];var n=[];var c=[];var f={};g.jcms={getContext:function(){return g.jcms.context||{}},getWysiwygEditorInfos:function(){if(g.jcms.wysiwygEditorInfos){return g.jcms.wysiwygEditorInfos}var t;try{let $textarea=a(g.getElement());if(!$textarea||!$textarea.exists()){t="{}"}else{var r=$textarea.closest(".wysiwyg-editor").find(".wysiwyg-editor-infos");var s=r.exists()?r[0].value:"{}";t=s===null||s===""?{}:a.parseJSON(s)}}catch(p){a.console.log("Could not parse wysiwyg-editor-infos",$textarea,s,p)}if(t){g.jcms.wysiwygEditorInfos=t;var u=t.dataInfos;if(u){for(var o=0;o<u.length;o++){var q=u[o];if(q.type==="Member"){g.jcms.setMemberInfos(q)}else{g.jcms.setMediaInfos(q)}}}}else{g.jcms.wysiwygEditorInfos={}}return g.jcms.wysiwygEditorInfos||{}},getPluginDataInfos:function(q,p){var o=f[q]||[];var r=o[p];if(!r){a.ajax({url:"js/jalios/core/wysiwyg/plugins/jcms/jsp/pluginInfos.jsp",data:{pluginId:q,dataId:p},async:false,dataType:"json",success:function(s){if(s&&s.dataId){r=s;g.jcms.setPluginDataInfos(q,p,r)}},error:function(u,v,s){var t=v+", "+s;a.console.log("Request Failed: "+t)}})}return r||{}},setPluginDataInfos:function(q,p,r){var o=f[q];if(!o){o=[];f[q]=o}o[p]=r},getMediaInfos:function(p){var o=n[p];if(!o){a.ajax({url:"js/jalios/core/wysiwyg/plugins/jcms/jsp/mediaInfos.jsp",data:{source:p},async:false,dataType:"json",success:function(q){if(q&&q.source){o=q;g.jcms.setMediaInfos(o)}},error:function(s,t,q){var r=t+", "+q;a.console.log("Request Failed: "+r)}})}return o||{}},setMediaInfos:function(o){n[o.source]=o},getMemberInfos:function(o){var p=c[o];if(!p){a.ajax({url:"jcore/autocomplete/acmention.jsp",data:{memberId:o},async:false,dataType:"json",success:function(q){if(q.length>0){p=q[0];g.jcms.setMemberInfos(p)}},error:function(s,t,q){var r=t+", "+q;a.console.log("Request Failed: "+r)}})}return p||{}},setMemberInfos:function(o){c[o.id]=o}};g.on("PreInit",function(){var q=a(g.getElement());var s=jQuery("html");var r=jQuery(g.getDoc()).find("html");r.attr("lang",s.attr("lang"));r.attr("xml:lang",s.attr("xml:lang"));var p=jQuery(g.getBody());p.attr("lang",q.attr("lang"));p.attr("xml:lang",q.attr("xml:lang"));var o=q.data();g.jcms.context=a.extend({},o,{getWorkspace:function(){var t=g.jcms.context.workspace;var v=q.closest(".edit-pub");if(v.exists()){var u=v.find(':input[name="ws"]');if(u.exists()){t=u.val()||t}}return t}});g.jcms.getWysiwygEditorInfos()});g.on("LoadContent",function(){let $editorBody=a(g.getBody());let block_formats=g.settings.block_formats;let block_formats_defined=block_formats&&block_formats!=="";let hasH1InConf=block_formats_defined&&block_formats.indexOf("h1")!==-1;let hasH2InConf=block_formats_defined&&block_formats.indexOf("h2")!==-1;let hasH1=$editorBody.find("H1").exists();let migrateHeaders=!hasH1InConf&&hasH2InConf&&hasH1;if(!migrateHeaders){return}for(var o=6;o>0;o--){let newHeaderLevel=o+1;let headers=$editorBody.find("H"+o);headers.each(function(){var q=a(this).get();var p=g.dom.create((newHeaderLevel<7)?"h"+(newHeaderLevel):"div",g.dom.getAttribs(q));g.dom.replace(p,q,true);if(newHeaderLevel>=7){g.dom.setAttribs(p,{role:"heading","aria-level":newHeaderLevel})}})}});var j=function(o){var p=function(v,w,s){var u=v||tinymce.activeEditor;if(!u.theme.panel){return null}var t=u.theme.panel.find("toolbar *");var r=false;tinymce.each(t,function(y,x){if(y.type=="button"&&typeof y.settings!=="undefined"&&y.settings.icon===w){r=y;return false}});return r};var q=p(g,"spellchecker");if(q&&q.disabled){q.disabled(!o)}};g.on("PostRender",function(){j(false)});g.on("Focus",function(){j(true)});g.on("Blur",function(){j(false)});g.on("PostProcess",function(o){if(o.get&&!o.selection){o.content=i(o.content)}});function i(p){if(!p){return""}if(p.match(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|<br \/>|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/)){return p}if(p.trim().match(/^<div class="[^"]*wysiwyg[^"]*"/)){return p}var o='<div class="wysiwyg">'+p+"</div>";return o}g.on("BeforeSetContent",function(o){if(o.set&&!o.selection){o.content=b(o.content)}});function b(o){if(!o){return""}var p=o.match(/^<div class="[^"]*wysiwyg[^"]*">([^]*)<\/div>$/);if(p){return p[1]}return o}function m(p){if(!p){return""}var o=new RegExp("<(jalios:[^\\s]+)(.*?)/>","gi");return p.replace(o,"<$1$2></$1>")}g.on("PastePreProcess",function(o){o.content=b(o.content);o.content=m(o.content)});g.on("BeforeSetContent",function(o){o.content=h(o.content)});function h(p){var o=new RegExp("(<jalios:[^\\s/>]+)([ />])","gi");return p.replace(o,function(r,q,s){if(k(r)){return r}return q+' contenteditable="false"'+s})}g.on("PostProcess",function(o){if(o.get){o.content=e(o.content)}});function e(p){var o=new RegExp('(<jalios:[^\\s/>]+)(.*) contenteditable="[^"]+"',"gi");return p.replace(o,function(r,q,s){if(k(r)){return r}return q+s})}function k(o){for(var p=0;p<l.length;p++){if(o.startsWith("<"+l[p])){return true}}return false}})}(window.jQuery);