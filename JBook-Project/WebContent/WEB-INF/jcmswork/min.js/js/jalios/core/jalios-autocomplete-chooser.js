!function(d){var g={publication:"jcore/autocomplete/acpublication.jsp?",member:"jcore/autocomplete/acmember.jsp?",group:"jcore/autocomplete/acgroup.jsp?",category:"jcore/autocomplete/accategory.jsp?",workspace:"jcore/autocomplete/acworkspace.jsp?",country:"jcore/autocomplete/accountry.jsp?",acl:"jcore/autocomplete/acacl.jsp?"};var i=function(){d(document).on("focusin",".form-control-autocomplete",j);Typeahead.hooks.add(h);d(document).on("click",".typeahead-container",c);d(document).mouseup(f)};var j=function(l){var k=d(l.currentTarget);e(k)};var e=function(n){if(n.data("typeahead")){return}var o=d('<div class="typeahead-menu ajax-refresh-div"></div>');var r=n.closest(".widget");if(!r.exists()){return}var q=r.find('INPUT[data-jalios-ac-action^="acChooser:"]').first();if(!q.exists()){return}var k=false;var p=q.attr("data-jalios-ac-action");p=p.substring(p.indexOf(":")+1);var m=q.attr("data-jalios-ac-options");var l=g[p]+m;if(p=="country"){k=function(s){var u=s.matchClass(/([A-Z]{2}-flag)/g);if(u.length>0){s.removeClass(u[0])}var t=s.next(".form-control").val();if(t){s.addClass(t+"-flag")}}}if(p=="publication"){k=function(s){var t=d.jalios.ui.Widget.Keyword.isInKeyword(s);if(!t){var u=s.parent();var v=u.find(".input-group-btn .dropdown-toggle");if(v.exists()){v.removeClass("hide");u.find(".input-group-btn .btn-remove").addClass("hide")}}}}if(r.hasClass("keyword")){k=function(s){JCMS.form.Widget.add(s[0])}}n.attr("autocomplete","off");n.typeahead({menu:o,ajax:l,selectCB:k})};var h=function(n){if(n.type!="select"){return}var m=n.typeahead.$element;if(!m.hasClass("form-control-autocomplete")){return}var l=n.$active;var p=l.attr("data-value");var o=l.attr("data-placeholder");m.data("autocomplete-update",false);m.val(o);m.next(".form-control").val(p).change();m.change();var k=n.typeahead.options.selectCB;if(k){k(m)}n.stop=true};var a=function(l){l.find(".typeahead-label").animate({opacity:"0"},100).hide();l.find(".typeahead-input").show().animate({opacity:"1"},100);l.addClass("active");var m=l.find("INPUT.typeahead");e(m);m.focus();var k=m.data("typeahead");if(k){if(m.data("ac-typeahead-menu")){k.show()}else{k.lookup()}}};var b=function(k){k.find(".typeahead-input").animate({opacity:"0"},100).hide();k.find(".typeahead-label").show().animate({opacity:"1"},100);k.removeClass("active")};var c=function(k){if(d(k.target).hasClass("typeahead")){return}var l=d(k.target).parents(".typeahead-container");if(d(k.target).hasClass("typeahead-close")){b(l);return}if(l.hasClass("active")){b(l)}else{a(l)}};var f=function(m){var k=d(m.target);if(k.hasClass("typeahead-input")||k.hasClass("typeahead-menu")||k.closest(".typeahead-container").exists()||k.closest(".dropdown-menu").exists()){return}var l=d(".typeahead-container");if(l.exists()){b(l)}};Typeahead.prototype.blur=function(l){var k=this;l.stopPropagation();l.preventDefault();if(!k.$element.hasClass("form-control-autocomplete")){return}setTimeout(function(){if(!k.$element.is(":focus")&&!k.$menu.is(":hover")){k.hide();k.clear()}},150)};Typeahead.prototype.clear=function(l){var k=this.$element;if(!k.hasClass("form-control-autocomplete")){return}if(k.data("autocomplete-update")){k.val("");k.next(".form-control").val("");k.data("autocomplete-update",false)}};d(document).ready(function(k){i()})}(window.jQuery);