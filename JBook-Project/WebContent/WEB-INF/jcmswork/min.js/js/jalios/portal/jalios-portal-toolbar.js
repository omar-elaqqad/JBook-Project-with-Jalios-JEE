!function(b){if(!b.jalios){b.jalios={}}if(!b.jalios.portalToolbar){b.jalios.portalToolbar={}}b.jalios.portalToolbar={pubChooserCallback:null,preview:function(f){var e=b(f);var d=e.closest("DIV.Portlet");if(e.hasClass("portletPreview")){e.removeClass("portletPreview");d.removeClass("portletPreview")}else{e.addClass("portletPreview");d.addClass("portletPreview")}b.ajax({url:e.prop("href")});return false},add:function(f,g,d){if(!f){return}var e="#"+b.jalios.portalToolbar.pubChooserCallback;if(!e){return}b.jalios.Sortable.Portal.add(e,f)},refresh:function(f){var d=b("#"+CtxMenuManager.latestElement);var e=d.closest(".Portlet");e.refresh()},update:function(f){var e=b("#"+CtxMenuManager.latestElement);var h=b(f.target).data("jalios-ctxmenu-update-params");var d=e.closest(".Portlet");var g="jcore/portal/ajaxHandlePortletAction.jsp";b.ajax({url:g,data:h}).done(function(){d.refresh()})},remove:function(f){var d=b("#"+CtxMenuManager.latestElement);var e=d.closest(".Portlet");var g=d.closest(".dnd-container");var h=g.eq(0);b.jalios.ui.Modal.confirm(b(f.target).text(),function(i){if(!i){return}jQuery.jalios.Sortable.Portal.remove(h,e.getJcmsId())});return false},openPubChooser:function(e){var d=b("#"+CtxMenuManager.latestElement);var f=d.closest(".Portlet");var g=f.find(".dnd-container");if(!g.exists()){JcmsLogger.warn("PortalManager.Toolbar","openPubChooser(): cannot find container",link,wrapper);return}b.jalios.portalToolbar.pubChooserCallback=g[0].id;return Popup.popupWindow(e,"pubChooser",900,500,false,true,true,false)}};var a=function(){b(document).on("click",".dropdown-menu .ctxmenu-portlet-action",c)};var c=function(f){f.preventDefault();var d=b(f.target);var e=d.prop("href");var g=d.data("jalios-ctxmenu-action");switch(g){case"add":b.jalios.portalToolbar.openPubChooser(e);break;case"remove":b.jalios.portalToolbar.remove(f);break;case"refresh":b.jalios.portalToolbar.refresh(f);break;case"update":b.jalios.portalToolbar.update(f);break}};b(document).ready(function(d){a()})}(window.jQuery);