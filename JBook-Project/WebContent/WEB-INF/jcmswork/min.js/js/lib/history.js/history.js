(function(i,a){var d=i.console||a,k=i.document,n=i.navigator,m=false,c=i.setTimeout,l=i.clearTimeout,f=i.setInterval,p=i.clearInterval,o=i.JSON,j=i.alert,b=i.History=i.History||{},h=i.history;try{m=i.sessionStorage;m.setItem("TEST","1");m.removeItem("TEST")}catch(g){m=false}o.stringify=o.stringify||o.encode;o.parse=o.parse||o.decode;if(typeof b.init!=="undefined"){throw new Error("History.js Core has already been loaded...")}b.init=function(e){if(typeof b.Adapter==="undefined"){return false}if(typeof b.initCore!=="undefined"){b.initCore()}if(typeof b.initHtml4!=="undefined"){b.initHtml4()}return true};b.initCore=function(e){if(typeof b.initCore.initialized!=="undefined"){return false}else{b.initCore.initialized=true}b.options=b.options||{};b.options.hashChangeInterval=b.options.hashChangeInterval||100;b.options.safariPollInterval=b.options.safariPollInterval||500;b.options.doubleCheckInterval=b.options.doubleCheckInterval||500;b.options.disableSuid=b.options.disableSuid||false;b.options.storeInterval=b.options.storeInterval||1000;b.options.busyDelay=b.options.busyDelay||250;b.options.debug=b.options.debug||false;b.options.initialTitle=b.options.initialTitle||k.title;b.options.html4Mode=b.options.html4Mode||false;b.options.delayInit=b.options.delayInit||false;b.intervalList=[];b.clearAllIntervals=function(){var t,s=b.intervalList;if(typeof s!=="undefined"&&s!==null){for(t=0;t<s.length;t++){p(s[t])}b.intervalList=null}};b.debug=function(){if((b.options.debug||false)){b.log.apply(b,arguments)}};b.log=function(){var y=!(typeof d==="undefined"||typeof d.log==="undefined"||typeof d.log.apply==="undefined"),t=k.getElementById("log"),x,w,z,u,s;if(y){u=Array.prototype.slice.call(arguments);x=u.shift();if(typeof d.debug!=="undefined"){d.debug.apply(d,[x,u])}else{d.log.apply(d,[x,u])}}else{x=("\n"+arguments[0]+"\n")}for(w=1,z=arguments.length;w<z;++w){s=arguments[w];if(typeof s==="object"&&typeof o!=="undefined"){try{s=o.stringify(s)}catch(v){}}x+="\n"+s+"\n"}if(t){t.value+=x+"\n-----\n";t.scrollTop=t.scrollHeight-t.clientHeight}else{if(!y){j(x)}}return true};b.getInternetExplorerMajorVersion=function(){var s=b.getInternetExplorerMajorVersion.cached=(typeof b.getInternetExplorerMajorVersion.cached!=="undefined")?b.getInternetExplorerMajorVersion.cached:(function(){var t=3,w=k.createElement("div"),u=w.getElementsByTagName("i");while((w.innerHTML="<!--[if gt IE "+(++t)+"]><i></i><![endif]-->")&&u[0]){}return(t>4)?t:false})();return s};b.isInternetExplorer=function(){var s=b.isInternetExplorer.cached=(typeof b.isInternetExplorer.cached!=="undefined")?b.isInternetExplorer.cached:Boolean(b.getInternetExplorerMajorVersion());return s};if(b.options.html4Mode){b.emulated={pushState:true,hashChange:true}}else{b.emulated={pushState:!Boolean(i.history&&i.history.pushState&&i.history.replaceState&&!((/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(n.userAgent)||(/AppleWebKit\/5([0-2]|3[0-2])/i).test(n.userAgent))),hashChange:Boolean(!(("onhashchange" in i)||("onhashchange" in k))||(b.isInternetExplorer()&&b.getInternetExplorerMajorVersion()<8))}}b.enabled=!b.emulated.pushState;b.bugs={setHash:Boolean(!b.emulated.pushState&&n.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),safariPoll:Boolean(!b.emulated.pushState&&n.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),ieDoubleCheck:Boolean(b.isInternetExplorer()&&b.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(b.isInternetExplorer()&&b.getInternetExplorerMajorVersion()<7)};b.isEmptyObject=function(t){for(var s in t){if(t.hasOwnProperty(s)){return false}}return true};b.cloneObject=function(u){var t,s;if(u){t=o.stringify(u);s=o.parse(t)}else{s={}}return s};b.getRootUrl=function(){var s=k.location.protocol+"//"+(k.location.hostname||k.location.host);if(k.location.port||false){s+=":"+k.location.port}s+="/";return s};b.getBaseHref=function(){var s=k.getElementsByTagName("base"),u=null,t="";if(s.length===1){u=s[0];t=u.href.replace(/[^\/]+$/,"")}t=t.replace(/\/+$/,"");if(t){t+="/"}return t};b.getBaseUrl=function(){var s=b.getBaseHref()||b.getBasePageUrl()||b.getRootUrl();return s};b.getPageUrl=function(){var s=b.getState(false,false),u=(s||{}).url||b.getLocationHref(),t;t=u.replace(/\/+$/,"").replace(/[^\/]+$/,function(x,w,v){return(/\./).test(x)?x:x+"/"});return t};b.getBasePageUrl=function(){var s=(b.getLocationHref()).replace(/[#\?].*/,"").replace(/[^\/]+$/,function(v,u,t){return(/[^\/]$/).test(v)?"":v}).replace(/\/+$/,"")+"/";return s};b.getFullUrl=function(t,v){var s=t,u=t.substring(0,1);v=(typeof v==="undefined")?true:v;if(/[a-z]+\:\/\//.test(t)){}else{if(u==="/"){s=b.getRootUrl()+t.replace(/^\/+/,"")}else{if(u==="#"){s=b.getPageUrl().replace(/#.*/,"")+t}else{if(u==="?"){s=b.getPageUrl().replace(/[\?#].*/,"")+t}else{if(v){s=b.getBaseUrl()+t.replace(/^(\.\/)+/,"")}else{s=b.getBasePageUrl()+t.replace(/^(\.\/)+/,"")}}}}}return s.replace(/\#$/,"")};b.getShortUrl=function(u){var t=u,v=b.getBaseUrl(),s=b.getRootUrl();if(b.emulated.pushState){t=t.replace(v,"")}t=t.replace(s,"/");if(b.isTraditionalAnchor(t)){t="./"+t}t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return t};b.getLocationHref=function(s){s=s||k;if(s.URL===s.location.href){return s.location.href}if(s.location.href===decodeURIComponent(s.URL)){return s.URL}if(s.location.hash&&decodeURIComponent(s.location.href.replace(/^[^#]+/,""))===s.location.hash){return s.location.href}if(s.URL.indexOf("#")==-1&&s.location.href.indexOf("#")!=-1){return s.location.href}return s.URL||s.location.href};b.store={};b.idToState=b.idToState||{};b.stateToId=b.stateToId||{};b.urlToId=b.urlToId||{};b.storedStates=b.storedStates||[];b.savedStates=b.savedStates||[];b.normalizeStore=function(){b.store.idToState=b.store.idToState||{};b.store.urlToId=b.store.urlToId||{};b.store.stateToId=b.store.stateToId||{}};b.getState=function(u,t){if(typeof u==="undefined"){u=true}if(typeof t==="undefined"){t=true}var s=b.getLastSavedState();if(!s&&t){s=b.createStateObject()}if(u){s=b.cloneObject(s);s.url=s.cleanUrl||s.url}return s};b.getIdByState=function(s){var u=b.extractId(s.url),t;if(!u){t=b.getStateString(s);if(typeof b.stateToId[t]!=="undefined"){u=b.stateToId[t]}else{if(typeof b.store.stateToId[t]!=="undefined"){u=b.store.stateToId[t]}else{while(true){u=(new Date()).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof b.idToState[u]==="undefined"&&typeof b.store.idToState[u]==="undefined"){break}}b.stateToId[t]=u;b.idToState[u]=s}}}return u};b.normalizeState=function(t){var u,s;if(!t||(typeof t!=="object")){t={}}if(typeof t.normalized!=="undefined"){return t}if(!t.data||(typeof t.data!=="object")){t.data={}}u={};u.normalized=true;u.title=t.title||"";u.url=b.getFullUrl(t.url?t.url:(b.getLocationHref()));u.hash=b.getShortUrl(u.url);u.data=b.cloneObject(t.data);u.id=b.getIdByState(u);u.cleanUrl=u.url.replace(/\??\&_suid.*/,"");u.url=u.cleanUrl;s=!b.isEmptyObject(u.data);if((u.title||s)&&b.options.disableSuid!==true){u.hash=b.getShortUrl(u.url).replace(/\??\&_suid.*/,"");if(!/\?/.test(u.hash)){u.hash+="?"}u.hash+="&_suid="+u.id}u.hashedUrl=b.getFullUrl(u.hash);if((b.emulated.pushState||b.bugs.safariPoll)&&b.hasUrlDuplicate(u)){u.url=u.hashedUrl}return u};b.createStateObject=function(u,v,t){var s={data:u,title:v,url:t};s=b.normalizeState(s);return s};b.getStateById=function(t){t=String(t);var s=b.idToState[t]||b.store.idToState[t]||a;return s};b.getStateString=function(t){var s,u,v;s=b.normalizeState(t);u={data:s.data,title:t.title,url:t.url};v=o.stringify(u);return v};b.getStateId=function(t){var s,u;s=b.normalizeState(t);u=s.id;return u};b.getHashByState=function(t){var s,u;s=b.normalizeState(t);u=s.hash;return u};b.extractId=function(v){var w,u,s,t;if(v.indexOf("#")!=-1){t=v.split("#")[0]}else{t=v}u=/(.*)\&_suid=([0-9]+)$/.exec(t);s=u?(u[1]||v):v;w=u?String(u[2]||""):"";return w||false};b.isTraditionalAnchor=function(t){var s=!(/[\/\?\.]/.test(t));return s};b.extractState=function(v,u){var s=null,w,t;u=u||false;w=b.extractId(v);if(w){s=b.getStateById(w)}if(!s){t=b.getFullUrl(v);w=b.getIdByUrl(t)||false;if(w){s=b.getStateById(w)}if(!s&&u&&!b.isTraditionalAnchor(v)){s=b.createStateObject(null,null,t)}}return s};b.getIdByUrl=function(s){var t=b.urlToId[s]||b.store.urlToId[s]||a;return t};b.getLastSavedState=function(){return b.savedStates[b.savedStates.length-1]||a};b.getLastStoredState=function(){return b.storedStates[b.storedStates.length-1]||a};b.hasUrlDuplicate=function(u){var t=false,s;s=b.extractState(u.url);t=s&&s.id!==u.id;return t};b.storeState=function(s){b.urlToId[s.url]=s.id;b.storedStates.push(b.cloneObject(s));return s};b.isLastSavedState=function(v){var u=false,t,s,w;if(b.savedStates.length){t=v.id;s=b.getLastSavedState();w=s.id;u=(t===w)}return u};b.saveState=function(s){if(b.isLastSavedState(s)){return false}b.savedStates.push(b.cloneObject(s));return true};b.getStateByIndex=function(t){var s=null;if(typeof t==="undefined"){s=b.savedStates[b.savedStates.length-1]}else{if(t<0){s=b.savedStates[b.savedStates.length+t]}else{s=b.savedStates[t]}}return s};b.getCurrentIndex=function(){var s=null;if(b.savedStates.length<1){s=0}else{s=b.savedStates.length-1}return s};b.getHash=function(u){var s=b.getLocationHref(u),t;t=b.getHashByUrl(s);return t};b.unescapeHash=function(t){var s=b.normalizeHash(t);s=decodeURIComponent(s);return s};b.normalizeHash=function(t){var s=t.replace(/[^#]*#/,"").replace(/#.*/,"");return s};b.setHash=function(v,s){var t,u;if(s!==false&&b.busy()){b.pushQueue({scope:b,callback:b.setHash,args:arguments,queue:s});return false}b.busy(true);t=b.extractState(v,true);if(t&&!b.emulated.pushState){b.pushState(t.data,t.title,t.url,false)}else{if(b.getHash()!==v){if(b.bugs.setHash){u=b.getPageUrl();b.pushState(null,null,u+"#"+v,false)}else{k.location.hash=v}}}return b};b.escapeHash=function(t){var s=b.normalizeHash(t);s=i.encodeURIComponent(s);if(!b.bugs.hashEscape){s=s.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")}return s};b.getHashByUrl=function(s){var t=String(s).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");t=b.unescapeHash(t);return t};b.setTitle=function(u){var v=u.title,t;if(!v){t=b.getStateByIndex(0);if(t&&t.url===u.url){v=t.title||b.options.initialTitle}}try{k.getElementsByTagName("title")[0].innerHTML=v.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(s){}k.title=v;return b};b.queues=[];b.busy=function(t){if(typeof t!=="undefined"){b.busy.flag=t}else{if(typeof b.busy.flag==="undefined"){b.busy.flag=false}}if(!b.busy.flag){l(b.busy.timeout);var s=function(){var v,u,w;if(b.busy.flag){return}for(v=b.queues.length-1;v>=0;--v){u=b.queues[v];if(u.length===0){continue}w=u.shift();b.fireQueueItem(w);b.busy.timeout=c(s,b.options.busyDelay)}};b.busy.timeout=c(s,b.options.busyDelay)}return b.busy.flag};b.busy.flag=false;b.fireQueueItem=function(s){return s.callback.apply(s.scope||b,s.args||[])};b.pushQueue=function(s){b.queues[s.queue||0]=b.queues[s.queue||0]||[];b.queues[s.queue||0].push(s);return b};b.queue=function(t,s){if(typeof t==="function"){t={callback:t}}if(typeof s!=="undefined"){t.queue=s}if(b.busy()){b.pushQueue(t)}else{b.fireQueueItem(t)}return b};b.clearQueue=function(){b.busy.flag=false;b.queues=[];return b};b.stateChanged=false;b.doubleChecker=false;b.doubleCheckComplete=function(){b.stateChanged=true;b.doubleCheckClear();return b};b.doubleCheckClear=function(){if(b.doubleChecker){l(b.doubleChecker);b.doubleChecker=false}return b};b.doubleCheck=function(s){b.stateChanged=false;b.doubleCheckClear();if(b.bugs.ieDoubleCheck){b.doubleChecker=c(function(){b.doubleCheckClear();if(!b.stateChanged){s()}return true},b.options.doubleCheckInterval)}return b};b.safariStatePoll=function(){var t=b.extractState(b.getLocationHref()),s;if(!b.isLastSavedState(t)){s=t}else{return}if(!s){s=b.createStateObject()}b.Adapter.trigger(i,"popstate");return b};b.back=function(s){if(s!==false&&b.busy()){b.pushQueue({scope:b,callback:b.back,args:arguments,queue:s});return false}b.busy(true);b.doubleCheck(function(){b.back(false)});h.go(-1);return true};b.forward=function(s){if(s!==false&&b.busy()){b.pushQueue({scope:b,callback:b.forward,args:arguments,queue:s});return false}b.busy(true);b.doubleCheck(function(){b.forward(false)});h.go(1);return true};b.go=function(t,s){var u;if(t>0){for(u=1;u<=t;++u){b.forward(s)}}else{if(t<0){for(u=-1;u>=t;--u){b.back(s)}}else{throw new Error("History.go: History.go requires a positive or negative integer passed.")}}return b};if(b.emulated.pushState){var r=function(){};b.pushState=b.pushState||r;b.replaceState=b.replaceState||r}else{b.onPopState=function(v,s){var x=false,w=false,u,t;b.doubleCheckComplete();u=b.getHash();if(u){t=b.extractState(u||b.getLocationHref(),true);if(t){b.replaceState(t.data,t.title,t.url,false)}else{b.Adapter.trigger(i,"anchorchange");b.busy(false)}b.expectedStateId=false;return false}x=b.Adapter.extractEventData("state",v,s)||false;if(x){w=b.getStateById(x)}else{if(b.expectedStateId){w=b.getStateById(b.expectedStateId)}else{w=b.extractState(b.getLocationHref())}}if(!w){w=b.createStateObject(null,null,b.getLocationHref())}b.expectedStateId=false;if(b.isLastSavedState(w)){b.busy(false);return false}b.storeState(w);b.saveState(w);b.setTitle(w);b.Adapter.trigger(i,"statechange");b.busy(false);return true};b.Adapter.bind(i,"popstate",b.onPopState);b.pushState=function(u,w,t,s){if(b.getHashByUrl(t)&&b.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(s!==false&&b.busy()){b.pushQueue({scope:b,callback:b.pushState,args:arguments,queue:s});return false}b.busy(true);var v=b.createStateObject(u,w,t);if(b.isLastSavedState(v)){b.busy(false)}else{b.storeState(v);b.expectedStateId=v.id;h.pushState(v.id,v.title,v.url);b.Adapter.trigger(i,"popstate")}return true};b.replaceState=function(u,w,t,s){if(b.getHashByUrl(t)&&b.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(s!==false&&b.busy()){b.pushQueue({scope:b,callback:b.replaceState,args:arguments,queue:s});return false}b.busy(true);var v=b.createStateObject(u,w,t);if(b.isLastSavedState(v)){b.busy(false)}else{b.storeState(v);b.expectedStateId=v.id;h.replaceState(v.id,v.title,v.url);b.Adapter.trigger(i,"popstate")}return true}}if(m){try{b.store=o.parse(m.getItem("History.store"))||{}}catch(q){b.store={}}b.normalizeStore()}else{b.store={};b.normalizeStore()}b.Adapter.bind(i,"unload",b.clearAllIntervals);b.saveState(b.storeState(b.extractState(b.getLocationHref(),true)));if(m){b.onUnload=function(){var s,u,w;try{s=o.parse(m.getItem("History.store"))||{}}catch(t){s={}}s.idToState=s.idToState||{};s.urlToId=s.urlToId||{};s.stateToId=s.stateToId||{};for(u in b.idToState){if(!b.idToState.hasOwnProperty(u)){continue}s.idToState[u]=b.idToState[u]}for(u in b.urlToId){if(!b.urlToId.hasOwnProperty(u)){continue}s.urlToId[u]=b.urlToId[u]}for(u in b.stateToId){if(!b.stateToId.hasOwnProperty(u)){continue}s.stateToId[u]=b.stateToId[u]}b.store=s;b.normalizeStore();w=o.stringify(s);try{m.setItem("History.store",w)}catch(v){if(v.code===DOMException.QUOTA_EXCEEDED_ERR){if(m.length){m.removeItem("History.store");m.setItem("History.store",w)}else{}}else{throw v}}};b.intervalList.push(f(b.onUnload,b.options.storeInterval));b.Adapter.bind(i,"beforeunload",b.onUnload);b.Adapter.bind(i,"unload",b.onUnload)}if(!b.emulated.pushState){if(b.bugs.safariPoll){b.intervalList.push(f(b.safariStatePoll,b.options.safariPollInterval))}if(n.vendor==="Apple Computer, Inc."||(n.appCodeName||"")==="Mozilla"){b.Adapter.bind(i,"hashchange",function(){b.Adapter.trigger(i,"popstate")});if(b.getHash()){b.Adapter.onDomLoad(function(){b.Adapter.trigger(i,"hashchange")})}}}};if(!b.options||!b.options.delayInit){b.init()}})(window);