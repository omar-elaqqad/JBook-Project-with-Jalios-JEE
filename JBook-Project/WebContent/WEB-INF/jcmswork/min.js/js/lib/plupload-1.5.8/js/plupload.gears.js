(function(){if(window.google&&google.gears){return}var d=null;if(typeof GearsFactory!="undefined"){d=new GearsFactory()}else{try{d=new ActiveXObject("Gears.Factory");if(d.getBuildInfo().indexOf("ie_mobile")!=-1){d.privateSetGlobalObject(this)}}catch(c){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){d=document.createElement("object");d.style.display="none";d.width=0;d.height=0;d.type="application/x-googlegears";document.documentElement.appendChild(d)}}}if(!d){return}if(!window.google){window.google={}}if(!google.gears){google.gears={factory:d}}})();(function(j,g,l,k){var i={};function h(f,d,b){var o,e,c,p;e=google.gears.factory.create("beta.canvas");try{e.decode(f);if(!d.width){d.width=e.width}if(!d.height){d.height=e.height}p=Math.min(d.width/e.width,d.height/e.height);if(p<1){e.resize(Math.round(e.width*p),Math.round(e.height*p))}else{if(!d.quality||b!=="image/jpeg"){return f}}if(d.quality){return e.encode(b,{quality:d.quality/100})}return e.encode(b)}catch(a){}return f}l.runtimes.Gears=l.addRuntime("gears",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(c,a){var b,f,n=false;if(!j.google||!google.gears){return a({success:false})}try{b=google.gears.factory.create("beta.desktop")}catch(d){return a({success:false})}function e(t){var u,v,s=[],m;for(v=0;v<t.length;v++){u=t[v];m=l.guid();i[m]=u.blob;s.push(new l.File(m,u.name,u.blob.length))}c.trigger("FilesAdded",s)}c.bind("PostInit",function(){var m=c.settings,p=g.getElementById(m.drop_element);if(p){l.addEvent(p,"dragover",function(o){b.setDropEffect(o,"copy");o.preventDefault()},c.id);l.addEvent(p,"drop",function(o){var r=b.getDragData(o,"application/x-gears-files");if(r){e(r.files)}o.preventDefault()},c.id);p=0}l.addEvent(g.getElementById(m.browse_button),"click",function(o){var u=[],w,x,v;o.preventDefault();if(n){return}no_type_restriction:for(w=0;w<m.filters.length;w++){v=m.filters[w].extensions.split(",");for(x=0;x<v.length;x++){if(v[x]==="*"){u=[];break no_type_restriction}u.push("."+v[x])}}b.openFiles(e,{singleFile:!m.multi_selection,filter:u})},c.id)});c.bind("CancelUpload",function(){if(f.abort){f.abort()}});c.bind("UploadFile",function(C,w){var A=0,B,m,D=0,x=C.settings.resize,z;if(x&&/\.(png|jpg|jpeg)$/i.test(w.name)){i[w.id]=h(i[w.id],x,/\.png$/i.test(w.name)?"image/png":"image/jpeg")}w.size=i[w.id].length;m=C.settings.chunk_size;z=m>0;B=Math.ceil(w.size/m);if(!z){m=w.size;B=1}function y(){var t,p=C.settings.multipart,q=0,o={name:w.target_name||w.name},s=C.settings.url;function r(M){var N,u="----pluploadboundary"+l.guid(),K="--",v="\r\n",L,J;if(p){f.setRequestHeader("Content-Type","multipart/form-data; boundary="+u);N=google.gears.factory.create("beta.blobbuilder");l.each(l.extend(o,C.settings.multipart_params),function(E,F){N.append(K+u+v+'Content-Disposition: form-data; name="'+F+'"'+v+v);N.append(E+v)});J=l.mimeTypes[w.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";N.append(K+u+v+'Content-Disposition: form-data; name="'+C.settings.file_data_name+'"; filename="'+w.name+'"'+v+"Content-Type: "+J+v+v);N.append(M);N.append(v+K+u+K+v);L=N.getAsBlob();q=L.length-M.length;M=L}f.send(M)}if(w.status==l.DONE||w.status==l.FAILED||C.state==l.STOPPED){return}if(z){o.chunk=A;o.chunks=B}t=Math.min(m,w.size-(A*m));if(!p){s=l.buildUrl(C.settings.url,o)}f=google.gears.factory.create("beta.httprequest");f.open("POST",s);if(!p){f.setRequestHeader("Content-Disposition",'attachment; filename="'+w.name+'"');f.setRequestHeader("Content-Type","application/octet-stream")}l.each(C.settings.headers,function(u,v){f.setRequestHeader(v,u)});f.upload.onprogress=function(u){w.loaded=D+u.loaded-q;C.trigger("UploadProgress",w)};f.onreadystatechange=function(){var u;if(f.readyState==4&&C.state!==l.STOPPED){if(f.status==200){u={chunk:A,chunks:B,response:f.responseText,status:f.status};C.trigger("ChunkUploaded",w,u);if(u.cancelled){w.status=l.FAILED;return}D+=t;if(++A>=B){w.status=l.DONE;C.trigger("FileUploaded",w,{response:f.responseText,status:f.status})}else{y()}}else{C.trigger("Error",{code:l.HTTP_ERROR,message:l.translate("HTTP Error."),file:w,chunk:A,chunks:B,status:f.status})}}};if(A<B){r(i[w.id].slice(A*m,t))}}y()});c.bind("DisableBrowse",function(p,m){n=m});c.bind("Destroy",function(t){var s,r,m={browseButton:t.settings.browse_button,dropElm:t.settings.drop_element};for(s in m){r=g.getElementById(m[s]);if(r){l.removeAllEvents(r,t.id)}}});a({success:true})}})})(window,document,plupload);