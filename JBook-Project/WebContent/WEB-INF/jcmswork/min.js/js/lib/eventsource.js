(function(z){var d=z.setTimeout;var g=z.clearTimeout;var A=function(){};function D(K,L,F,J,k){this._internal=new n(K,L,F,J,k)}D.prototype.open=function(F,k){this._internal.open(F,k)};D.prototype.cancel=function(){this._internal.cancel()};function n(K,L,F,J,k){this.onStartCallback=L;this.onProgressCallback=F;this.onFinishCallback=J;this.thisArg=k;this.xhr=K;this.state=0;this.charOffset=0;this.offset=0;this.url="";this.withCredentials=false;this.timeout=0}n.prototype.onStart=function(){if(this.state===1){this.state=2;var k=0;var J="";var K=undefined;if(!("contentType" in this.xhr)){try{k=this.xhr.status;J=this.xhr.statusText;K=this.xhr.getResponseHeader("Content-Type")}catch(F){k=0;J="";K=undefined}}else{k=200;J="OK";K=this.xhr.contentType}if(K==undefined){K=""}this.onStartCallback.call(this.thisArg,k,J,K)}};n.prototype.onProgress=function(){this.onStart();if(this.state===2||this.state===3){this.state=3;var M="";try{M=this.xhr.responseText}catch(J){}var k=this.charOffset;var L=M.length;for(var K=this.offset;K<L;K+=1){var N=M.charCodeAt(K);if(N==="\n".charCodeAt(0)||N==="\r".charCodeAt(0)){this.charOffset=K+1}}this.offset=L;var F=M.slice(k,this.charOffset);this.onProgressCallback.call(this.thisArg,F)}};n.prototype.onFinish=function(){this.onProgress();if(this.state===3){this.state=4;if(this.timeout!==0){g(this.timeout);this.timeout=0}this.onFinishCallback.call(this.thisArg)}};n.prototype.onReadyStateChange=function(){if(this.xhr!=undefined){if(this.xhr.readyState===4){if(this.xhr.status===0){this.onFinish()}else{this.onFinish()}}else{if(this.xhr.readyState===3){this.onProgress()}else{if(this.xhr.readyState===2){}}}}};n.prototype.onTimeout2=function(){this.timeout=0;var k=(/^data\:([^,]*?)(base64)?,([\S]*)$/).exec(this.url);var J=k[1];var F=k[2]==="base64"?z.atob(k[3]):decodeURIComponent(k[3]);if(this.state===1){this.state=2;this.onStartCallback.call(this.thisArg,200,"OK",J)}if(this.state===2||this.state===3){this.state=3;this.onProgressCallback.call(this.thisArg,F)}if(this.state===3){this.state=4;this.onFinishCallback.call(this.thisArg)}};n.prototype.onTimeout1=function(){this.timeout=0;this.open(this.url,this.withCredentials)};n.prototype.onTimeout0=function(){var k=this;this.timeout=d(function(){k.onTimeout0()},500);if(this.xhr.readyState===3){this.onProgress()}};n.prototype.handleEvent=function(k){if(k.type==="load"){this.onFinish()}else{if(k.type==="error"){this.onFinish()}else{if(k.type==="abort"){this.onFinish()}else{if(k.type==="progress"){this.onProgress()}else{if(k.type==="readystatechange"){this.onReadyStateChange()}}}}}};n.prototype.open=function(F,k){if(this.timeout!==0){g(this.timeout);this.timeout=0}this.url=F;this.withCredentials=k;this.state=1;this.charOffset=0;this.offset=0;var K=this;var J=(/^data\:([^,]*?)(?:;base64)?,[\S]*$/).exec(F);if(J!=undefined){this.timeout=d(function(){K.onTimeout2()},0);return}if((!("ontimeout" in this.xhr)||("sendAsBinary" in this.xhr)||("mozAnon" in this.xhr))&&z.document!=undefined&&z.document.readyState!=undefined&&z.document.readyState!=="complete"){this.timeout=d(function(){K.onTimeout1()},4);return}this.xhr.onload=function(M){K.handleEvent({type:"load"})};this.xhr.onerror=function(){K.handleEvent({type:"error"})};this.xhr.onabort=function(){K.handleEvent({type:"abort"})};this.xhr.onprogress=function(){K.handleEvent({type:"progress"})};this.xhr.onreadystatechange=function(){K.handleEvent({type:"readystatechange"})};this.xhr.open("GET",F,true);this.xhr.withCredentials=k;this.xhr.responseType="text";if("setRequestHeader" in this.xhr){this.xhr.setRequestHeader("Accept","text/event-stream")}try{this.xhr.send(undefined)}catch(L){throw L}if(("readyState" in this.xhr)&&z.opera!=undefined){this.timeout=d(function(){K.onTimeout0()},0)}};n.prototype.cancel=function(){if(this.state!==0&&this.state!==4){this.state=4;this.xhr.onload=A;this.xhr.onerror=A;this.xhr.onabort=A;this.xhr.onprogress=A;this.xhr.onreadystatechange=A;this.xhr.abort();if(this.timeout!==0){g(this.timeout);this.timeout=0}this.onFinishCallback.call(this.thisArg)}this.state=0};function h(){this._data={}}h.prototype.get=function(k){return this._data[k+"~"]};h.prototype.set=function(k,F){this._data[k+"~"]=F};h.prototype["delete"]=function(k){delete this._data[k+"~"]};function p(){this._listeners=new h()}function C(k){d(function(){throw k},0)}p.prototype.dispatchEvent=function(M){M.target=this;var K=M.type.toString();var J=this._listeners;var k=J.get(K);if(k==undefined){return}var L=k.length;var N=undefined;for(var F=0;F<L;F+=1){N=k[F];try{if(typeof N.handleEvent==="function"){N.handleEvent(M)}else{N.call(this,M)}}catch(O){C(O)}}};p.prototype.addEventListener=function(K,L){K=K.toString();var J=this._listeners;var k=J.get(K);if(k==undefined){k=[];J.set(K,k)}for(var F=k.length;F>=0;F-=1){if(k[F]===L){return}}k.push(L)};p.prototype.removeEventListener=function(L,N){L=L.toString();var K=this._listeners;var k=K.get(L);if(k==undefined){return}var M=k.length;var F=[];for(var J=0;J<M;J+=1){if(k[J]!==N){F.push(k[J])}}if(F.length===0){K["delete"](L)}else{K.set(L,F)}};function I(k){this.type=k;this.target=undefined}function o(F,k){I.call(this,F);this.data=k.data;this.lastEventId=k.lastEventId}o.prototype=I.prototype;var s=z.XMLHttpRequest;var e=z.XDomainRequest;var x=s!=undefined&&(new s()).withCredentials!=undefined;var G=x||(s!=undefined&&e==undefined)?s:e;var y=-1;var r=0;var B=1;var f=2;var v=3;var m=4;var w=5;var j=6;var i=7;var l=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i;var u=1000;var c=18000000;var H=function(F,k){var J=F;if(J!==J){J=k}return(J<u?u:(J>c?c:J))};var E=function(F,J,k){try{if(typeof J==="function"){J.call(F,k)}}catch(K){C(K)}};function a(F,k){p.call(this);this.onopen=undefined;this.onmessage=undefined;this.onerror=undefined;this.url="";this.readyState=r;this.withCredentials=false;this._internal=new b(this,F,k)}function b(L,J,F){this.url=J.toString();this.readyState=r;this.withCredentials=x&&F!=undefined&&Boolean(F.withCredentials);this.es=L;this.initialRetry=H(1000,0);this.heartbeatTimeout=H(45000,0);this.lastEventId="";this.retry=this.initialRetry;this.wasActivity=false;var k=F!=undefined&&F.Transport!=undefined?F.Transport:G;var K=new k();this.transport=new D(K,this.onStart,this.onProgress,this.onFinish,this);this.timeout=0;this.currentState=y;this.dataBuffer=[];this.lastEventIdBuffer="";this.eventTypeBuffer="";this.state=m;this.fieldStart=0;this.valueStart=0;this.es.url=this.url;this.es.readyState=this.readyState;this.es.withCredentials=this.withCredentials;this.onTimeout()}b.prototype.onStart=function(k,K,L){if(this.currentState===r){if(L==undefined){L=""}if(k===200&&l.test(L)){this.currentState=B;this.wasActivity=true;this.retry=this.initialRetry;this.readyState=B;this.es.readyState=B;var J=new I("open");this.es.dispatchEvent(J);E(this.es,this.es.onopen,J)}else{if(k!==0){var F="";if(k!==200){F="EventSource's response has a status "+k+" "+K.replace(/\s+/g," ")+" that is not 200. Aborting the connection."}else{F="EventSource's response has a Content-Type specifying an unsupported type: "+L.replace(/\s+/g," ")+". Aborting the connection."}C(new Error(F));this.close();var J=new I("error");this.es.dispatchEvent(J);E(this.es,this.es.onerror,J)}}}};b.prototype.onProgress=function(F){if(this.currentState===B){var L=F.length;if(L!==0){this.wasActivity=true}for(var k=0;k<L;k+=1){var O=F.charCodeAt(k);if(this.state===v&&O==="\n".charCodeAt(0)){this.state=m}else{if(this.state===v){this.state=m}if(O==="\r".charCodeAt(0)||O==="\n".charCodeAt(0)){if(this.state!==m){if(this.state===w){this.valueStart=k+1}var N=F.slice(this.fieldStart,this.valueStart-1);var M=F.slice(this.valueStart+(this.valueStart<k&&F.charCodeAt(this.valueStart)===" ".charCodeAt(0)?1:0),k);if(N==="data"){this.dataBuffer.push(M)}else{if(N==="id"){this.lastEventIdBuffer=M}else{if(N==="event"){this.eventTypeBuffer=M}else{if(N==="retry"){this.initialRetry=H(Number(M),this.initialRetry);this.retry=this.initialRetry}else{if(N==="heartbeatTimeout"){this.heartbeatTimeout=H(Number(M),this.heartbeatTimeout);if(this.timeout!==0){g(this.timeout);var K=this;this.timeout=d(function(){K.onTimeout()},this.heartbeatTimeout)}}}}}}}if(this.state===m){if(this.dataBuffer.length!==0){this.lastEventId=this.lastEventIdBuffer;if(this.eventTypeBuffer===""){this.eventTypeBuffer="message"}var J=new o(this.eventTypeBuffer,{data:this.dataBuffer.join("\n"),lastEventId:this.lastEventIdBuffer});this.es.dispatchEvent(J);if(this.eventTypeBuffer==="message"){E(this.es,this.es.onmessage,J)}if(this.currentState===f){return}}this.dataBuffer.length=0;this.eventTypeBuffer=""}this.state=O==="\r".charCodeAt(0)?v:m}else{if(this.state===m){this.fieldStart=k;this.state=w}if(this.state===w){if(O===":".charCodeAt(0)){this.valueStart=k+1;this.state=j}}else{if(this.state===j){this.state=i}}}}}}};b.prototype.onFinish=function(){if(this.currentState===B||this.currentState===r){this.currentState=y;if(this.timeout!==0){g(this.timeout);this.timeout=0}if(this.retry>this.initialRetry*16){this.retry=this.initialRetry*16}if(this.retry>c){this.retry=c}var F=this;this.timeout=d(function(){F.onTimeout()},this.retry);this.retry=this.retry*2+1;this.readyState=r;this.es.readyState=r;var k=new I("error");this.es.dispatchEvent(k);E(this.es,this.es.onerror,k)}};b.prototype.onTimeout=function(){this.timeout=0;if(this.currentState!==y){if(!this.wasActivity){C(new Error("No activity within "+this.heartbeatTimeout+" milliseconds. Reconnecting."));this.transport.cancel()}else{this.wasActivity=false;var J=this;this.timeout=d(function(){J.onTimeout()},this.heartbeatTimeout)}return}this.wasActivity=false;var J=this;this.timeout=d(function(){J.onTimeout()},this.heartbeatTimeout);this.currentState=r;this.dataBuffer.length=0;this.eventTypeBuffer="";this.lastEventIdBuffer=this.lastEventId;this.fieldStart=0;this.valueStart=0;this.state=m;var F=this.url.slice(0,5);if(F!=="data:"&&F!=="blob:"){F=this.url+((this.url.indexOf("?",0)===-1?"?":"&")+"lastEventId="+encodeURIComponent(this.lastEventId)+"&r="+(Math.random()+1).toString().slice(2))}else{F=this.url}try{this.transport.open(F,this.withCredentials)}catch(k){this.close();throw k}};b.prototype.close=function(){this.currentState=f;this.transport.cancel();if(this.timeout!==0){g(this.timeout);this.timeout=0}this.readyState=f;this.es.readyState=f};function t(){this.CONNECTING=r;this.OPEN=B;this.CLOSED=f}t.prototype=p.prototype;a.prototype=new t();a.prototype.close=function(){this._internal.close()};t.call(a);if(x){a.prototype.withCredentials=undefined}var q=function(){return z.EventSource!=undefined&&("withCredentials" in z.EventSource.prototype)};if(G!=undefined&&(z.EventSource==undefined||(x&&!q()))){z.NativeEventSource=z.EventSource;z.EventSource=a}}(typeof window!=="undefined"?window:this));